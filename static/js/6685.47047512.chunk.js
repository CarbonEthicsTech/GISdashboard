"use strict";(self.webpackChunkgis_dashboard=self.webpackChunkgis_dashboard||[]).push([[6685],{43244:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(37762),i=r(15671),a=r(43144),s=function(){function e(t){(0,i.Z)(this,e),this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}return(0,a.Z)(e,[{key:"entries",get:function(){return this._buffer}},{key:"enqueue",value:function(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}},{key:"dequeue",value:function(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}},{key:"peek",value:function(){return 0===this.size?null:this._buffer[this._start]}},{key:"find",value:function(e){if(0===this.size)return null;var t,r=(0,n.Z)(this._buffer);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(null!=i&&e(i))return i}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"clear",value:function(e){for(var t=this.dequeue();null!=t;)e&&e(t),t=this.dequeue()}}]),e}()},58971:function(e,t,r){r.d(t,{G6:function(){return Z},Ie:function(){return x},J9:function(){return k},RF:function(){return g},U1:function(){return w},vY:function(){return o},ym:function(){return b}});var n=r(29439),i=r(77981);var a=function(e,t,r){return[t,r]},s=function(e,t,r){return[t,r,e[2]]},u=function(e,t,r){return[t,r,e[2],e[3]]};function o(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l(e,t){var r=e.scale,n=e.translate;return Math.round((t-n[0])/r[0])}function c(e,t){var r=e.scale,n=e.translate;return Math.round((n[1]-t)/r[1])}function f(e,t,r){for(var n,i,a,s,u=[],o=0;o<r.length;o++){var f=r[o];o>0?(a=l(e,f[0]),s=c(e,f[1]),a===n&&s===i||(u.push(t(f,a-n,s-i)),n=a,i=s)):(n=l(e,f[0]),i=c(e,f[1]),u.push(t(f,n,i)))}return u.length>0?u:null}function h(e,t){var r=e.scale,n=e.translate;return t*r[0]+n[0]}function d(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function p(e,t,r){var i=new Array(r.length);if(!r.length)return i;var a=(0,n.Z)(e.scale,2),s=a[0],u=a[1],o=h(e,r[0][0]),l=d(e,r[0][1]);i[0]=t(r[0],o,l);for(var c=1;c<r.length;c++){var f=r[c];o+=f[0]*s,l-=f[1]*u,i[c]=t(f,o,l)}return i}function y(e,t,r){for(var n=new Array(r.length),i=0;i<r.length;i++)n[i]=p(e,t,r[i]);return n}function v(e,t,r,n,i){var o;return t.points=null!==(o=function(e,t,r,n){return f(e,r?n?u:s:n?s:a,t)}(e,r.points,n,i))&&void 0!==o?o:[],t}function g(e,t,r,n,i){return t.x=l(e,r.x),t.y=c(e,r.y),t!==r&&(n&&(t.z=r.z),i&&(t.m=r.m)),t}function _(e,t,r,n,i){var o=function(e,t,r,n){for(var i=[],o=r?n?u:s:n?s:a,l=0;l<t.length;l++){var c=f(e,o,t[l]);c&&c.length>=3&&i.push(c)}return i.length?i:null}(e,r.rings,n,i);return o?(t.rings=o,t):null}function m(e,t,r,n,i){var o=function(e,t,r,n){for(var i=[],o=r?n?u:s:n?s:a,l=0;l<t.length;l++){var c=f(e,o,t[l]);c&&c.length>=2&&i.push(c)}return i.length?i:null}(e,r.paths,n,i);return o?(t.paths=o,t):null}function b(e,t){return e&&t?(0,i.wp)(t)?g(e,{},t,!1,!1):(0,i.l9)(t)?m(e,{},t,!1,!1):(0,i.oU)(t)?_(e,{},t,!1,!1):(0,i.aW)(t)?v(e,{},t,!1,!1):(0,i.YX)(t)?function(e,t,r,n,i){return t.xmin=l(e,r.xmin),t.ymin=c(e,r.ymin),t.xmax=l(e,r.xmax),t.ymax=c(e,r.ymax),t!==r&&(n&&(t.zmin=r.zmin,t.zmax=r.zmax),i&&(t.mmin=r.mmin,t.mmax=r.mmax)),t}(e,{},t,!1,!1):null:null}function k(e,t,r,n,i){return null!=r&&(t.points=function(e,t,r,n){return p(e,r?n?u:s:n?s:a,t)}(e,r.points,n,i)),t}function w(e,t,r,n,i){return null==r||(t.x=h(e,r.x),t.y=d(e,r.y),t!==r&&(n&&(t.z=r.z),i&&(t.m=r.m))),t}function x(e,t,r,n,i){return null!=r&&(t.rings=function(e,t,r,n){return y(e,r?n?u:s:n?s:a,t)}(e,r.rings,n,i)),t}function Z(e,t,r,n,i){return null!=r&&(t.paths=function(e,t,r,n){return y(e,r?n?u:s:n?s:a,t)}(e,r.paths,n,i)),t}},83444:function(e,t,r){r.d(t,{Z:function(){return w}});var n,i=r(15671),a=r(43144),s=r(11752),u=r(61120),o=r(60136),l=r(29388),c=r(27366),f=r(10064),h=r(46784),d=r(18202),p=r(49861),y=(r(25243),r(63780),r(93169),r(69912)),v=r(60676),g=r(18661),_={read:{reader:v.ij},write:{writer:v.cW,overridePolicy:function(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},m={read:{reader:v.ij},write:{writer:v.cW,overridePolicy:function(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},b={name:"showExcludedLabels",default:!0},k=n=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).filter=null,n.includedEffect=null,n.excludedEffect=null,n.excludedLabelsVisible=!1,n}return(0,a.Z)(r,[{key:"write",value:function(e,t){var n=(0,s.Z)((0,u.Z)(r.prototype),"write",this).call(this,e,t);if(null!==t&&void 0!==t&&t.origin){var i;if(n.filter){var a,o=Object.keys(n.filter);if(o.length>1||"where"!==o[0])return null!==(a=t.messages)&&void 0!==a&&a.push(new f.Z("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in n)return null!==(i=t.messages)&&void 0!==i&&i.push(new f.Z("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return n}},{key:"clone",value:function(){return new n({filter:null!=this.filter?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}}]),r}(h.wq);(0,c._)([(0,p.Cb)({type:g.Z,json:{write:{allowNull:!0,writer:function(e,t,r,n){var i=null===e||void 0===e?void 0:e.write({},n);i&&0!==Object.keys(i).length?(0,d.RB)(r,i,t):(0,d.RB)(r,null,t)}}}})],k.prototype,"filter",void 0),(0,c._)([(0,p.Cb)({json:{write:!0,origins:{"web-map":_,"portal-item":_}}})],k.prototype,"includedEffect",void 0),(0,c._)([(0,p.Cb)({json:{write:!0,origins:{"web-map":m,"portal-item":m}}})],k.prototype,"excludedEffect",void 0),(0,c._)([(0,p.Cb)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":b,"portal-item":b}}})],k.prototype,"excludedLabelsVisible",void 0);var w=k=n=(0,c._)([(0,y.j)("esri.layers.support.FeatureEffect")],k)},18661:function(e,t,r){r.d(t,{Z:function(){return k}});var n,i=r(1413),a=r(15671),s=r(43144),u=r(60136),o=r(29388),l=r(27366),c=r(59486),f=r(62044),h=r(43404),d=r(46784),p=r(84652),y=r(49861),v=(r(25243),r(69912)),g=r(86638),_=new h.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),m=new h.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),b=n=function(e){(0,u.Z)(r,e);var t=(0,o.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e)).where=null,n.geometry=null,n.spatialRelationship="intersects",n.distance=void 0,n.objectIds=null,n.units=null,n.timeExtent=null,n}return(0,s.Z)(r,[{key:"createQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.where,r=this.geometry,n=this.spatialRelationship,a=this.timeExtent,s=this.objectIds,u=this.units,o=this.distance;return new g.Z((0,i.Z)({geometry:(0,p.d9)(r),objectIds:(0,p.d9)(s),spatialRelationship:n,timeExtent:(0,p.d9)(a),where:t,units:u,distance:o},e))}},{key:"clone",value:function(){var e=this.where,t=this.geometry,r=this.spatialRelationship,i=this.timeExtent,a=this.objectIds,s=this.units,u=this.distance;return new n({geometry:(0,p.d9)(t),objectIds:(0,p.d9)(a),spatialRelationship:r,timeExtent:(0,p.d9)(i),where:e,units:s,distance:u})}}]),r}(d.wq);(0,l._)([(0,y.Cb)({type:String,json:{write:!0}})],b.prototype,"where",void 0),(0,l._)([(0,y.Cb)({types:c.qM,json:{write:!0}})],b.prototype,"geometry",void 0),(0,l._)([(0,y.Cb)({type:_.apiValues,json:{name:"spatialRel",read:{reader:_.read},write:{allowNull:!1,writer:_.write,overridePolicy:function(){return{enabled:null!=this.geometry}}}}})],b.prototype,"spatialRelationship",void 0),(0,l._)([(0,y.Cb)({type:Number,json:{write:{overridePolicy:function(e){return{enabled:null!=e&&null!=this.geometry}}}}})],b.prototype,"distance",void 0),(0,l._)([(0,y.Cb)({type:[Number],json:{write:!0}})],b.prototype,"objectIds",void 0),(0,l._)([(0,y.Cb)({type:m.apiValues,json:{read:m.read,write:{writer:m.write,overridePolicy:function(e){return{enabled:null!=e&&null!=this.geometry}}}}})],b.prototype,"units",void 0),(0,l._)([(0,y.Cb)({type:f.Z,json:{write:!0}})],b.prototype,"timeExtent",void 0);var k=b=n=(0,l._)([(0,v.j)("esri.layers.support.FeatureFilter")],b)},83040:function(e,t,r){r.d(t,{Z:function(){return b}});var n,i=r(15671),a=r(43144),s=r(60136),u=r(29388),o=r(27366),l=r(43404),c=r(46784),f=r(49861),h=r(25243),d=(r(63780),r(93169),r(27135)),p=r(38511),y=r(69912),v=r(66591),g=r(85249),_=new l.X({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"}),m=n=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).alias=null,n.defaultValue=void 0,n.description=null,n.domain=null,n.editable=!0,n.length=-1,n.name=null,n.nullable=!0,n.type=null,n.valueType=null,n.visible=!0,n}return(0,a.Z)(r,[{key:"readDescription",value:function(e,t){var r,n,i=t.description,a=null;try{a=i?JSON.parse(i):null}catch(s){}return null!==(r=null===(n=a)||void 0===n?void 0:n.value)&&void 0!==r?r:null}},{key:"readValueType",value:function(e,t){var r=t.description,n=null;try{n=r?JSON.parse(r):null}catch(i){}return n?_.fromJSON(n.fieldValueType):null}},{key:"clone",value:function(){return new n({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}}]),r}(c.wq);(0,o._)([(0,f.Cb)({type:String,json:{write:!0}})],m.prototype,"alias",void 0),(0,o._)([(0,f.Cb)({type:[String,Number],json:{write:{allowNull:!0}}})],m.prototype,"defaultValue",void 0),(0,o._)([(0,f.Cb)()],m.prototype,"description",void 0),(0,o._)([(0,p.r)("description")],m.prototype,"readDescription",null),(0,o._)([(0,f.Cb)({types:v.V5,json:{read:{reader:v.im},write:!0}})],m.prototype,"domain",void 0),(0,o._)([(0,f.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"editable",void 0),(0,o._)([(0,f.Cb)({type:h.z8,json:{write:!0}})],m.prototype,"length",void 0),(0,o._)([(0,f.Cb)({type:String,json:{write:!0}})],m.prototype,"name",void 0),(0,o._)([(0,f.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"nullable",void 0),(0,o._)([(0,d.J)(g.v)],m.prototype,"type",void 0),(0,o._)([(0,f.Cb)()],m.prototype,"valueType",void 0),(0,o._)([(0,p.r)("valueType",["description"])],m.prototype,"readValueType",null),(0,o._)([(0,f.Cb)({type:Boolean,json:{read:!1}})],m.prototype,"visible",void 0);var b=m=n=(0,o._)([(0,y.j)("esri.layers.support.Field")],m)},45948:function(e,t,r){r.d(t,{qG:function(){return k},PV:function(){return v},id:function(){return x},iR:function(){return d},rn:function(){return y},rT:function(){return S},u1:function(){return R},rO:function(){return Z},Oh:function(){return m},bT:function(){return b},C_:function(){return h},Lx:function(){return g},vg:function(){return w},YI:function(){return f},HQ:function(){return p}});var n=r(1413),i=r(62044),a=r(53866),s=r(78952),u=r(53283),o=(r(63780),r(66978),r(86710));var l=r(64575),c=r(81219),f={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},h={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:function(e,t){return!t.disablePopup}},write:{enabled:!0,writer:function(e,t,r){t[r]=!e}}}},d={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},p={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:u.w}}},y={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},v={value:null,type:l.Z,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function g(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}var _={write:!0,read:!0},m={type:Number,json:{origins:{"web-document":_,"portal-item":{write:!0}}}},b=(0,n.Z)((0,n.Z)({},m),{},{json:(0,n.Z)((0,n.Z)({},m.json),{},{origins:{"web-document":(0,n.Z)((0,n.Z)({},_),{},{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:function(e,t,r){return r&&"service"!==r.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,c.b)(t.layerDefinition.drawingInfo.transparency):void 0:(0,c.b)(t.drawingInfo.transparency)}}})}),k={type:i.Z,readOnly:!0,get:function(){var e,t;if(null===(e=this.layer)||void 0===e||!e.timeInfo)return null;var r=this.layer,n=r.datesInUnknownTimezone,a=r.timeOffset,s=r.useViewTime,u=null===(t=this.view)||void 0===t?void 0:t.timeExtent,l=this.layer.timeExtent;n&&(l=function(e){if(!e)return e;var t=e.start,r=e.end;return new i.Z({start:null!=t?(0,o.Nm)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=r?(0,o.Nm)(r,r.getTimezoneOffset(),"minutes"):r})}(l));var c=s?u&&l?u.intersection(l):u||l:l;if(!c||c.isEmpty||c.isAllTime)return c;a&&(c=c.offset(-a.value,a.unit)),n&&(c=function(e){if(!e)return e;var t=e.start,r=e.end;return new i.Z({start:null!=t?(0,o.Nm)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=r?(0,o.Nm)(r,-r.getTimezoneOffset(),"minutes"):r})}(c));var f=this._get("timeExtent");return c.equals(f)?f:c}},w={type:a.Z,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:function(e,t){var r=a.Z.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(r.spatialReference=s.Z.fromJSON(t.spatialReference)),r}}}},read:!1}},x={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},Z={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},R={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},S={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}}},66591:function(e,t,r){r.d(t,{im:function(){return E},V5:function(){return C}});r(93169);var n,i=r(15671),a=r(43144),s=r(60136),u=r(29388),o=r(27366),l=r(84652),c=r(49861),f=(r(25243),r(27135)),h=r(69912),d=r(46784),p=(r(63780),n=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).name=null,n.code=null,n}return(0,a.Z)(r,[{key:"clone",value:function(){return new n({name:this.name,code:this.code})}}]),r}(d.wq));(0,o._)([(0,c.Cb)({type:String,json:{write:!0}})],p.prototype,"name",void 0),(0,o._)([(0,c.Cb)({type:[String,Number],json:{write:!0}})],p.prototype,"code",void 0),p=n=(0,o._)([(0,h.j)("esri.layers.support.CodedValue")],p);var y=new(r(43404).X)({inherited:"inherited",codedValue:"coded-value",range:"range"}),v=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).name=null,n.type=null,n}return(0,a.Z)(r)}(d.wq);(0,o._)([(0,c.Cb)({type:String,json:{write:!0}})],v.prototype,"name",void 0),(0,o._)([(0,f.J)(y)],v.prototype,"type",void 0);var g,_=v=(0,o._)([(0,h.j)("esri.layers.support.Domain")],v),m=g=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).codedValues=null,n.type="coded-value",n}return(0,a.Z)(r,[{key:"getName",value:function(e){var t=null;if(this.codedValues){var r=String(e);this.codedValues.some((function(e){return String(e.code)===r&&(t=e.name),!!t}))}return t}},{key:"clone",value:function(){return new g({codedValues:(0,l.d9)(this.codedValues),name:this.name})}}]),r}(_);(0,o._)([(0,c.Cb)({type:[p],json:{write:!0}})],m.prototype,"codedValues",void 0),(0,o._)([(0,f.J)({codedValue:"coded-value"})],m.prototype,"type",void 0);var b,k=m=g=(0,o._)([(0,h.j)("esri.layers.support.CodedValueDomain")],m),w=(r(32718),r(10064),b=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).type="inherited",n}return(0,a.Z)(r,[{key:"clone",value:function(){return new b}}]),r}(_));(0,o._)([(0,f.J)({inherited:"inherited"})],w.prototype,"type",void 0);var x,Z=w=b=(0,o._)([(0,h.j)("esri.layers.support.InheritedDomain")],w),R=x=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).maxValue=null,n.minValue=null,n.type="range",n}return(0,a.Z)(r,[{key:"clone",value:function(){return new x({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}}]),r}(_);(0,o._)([(0,c.Cb)({type:Number,json:{type:[Number],read:{source:"range",reader:function(e,t){return t.range&&t.range[1]}},write:{enabled:!1,overridePolicy:function(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer:function(e,t,r){t[r]=[this.minValue||0,e]}}}})],R.prototype,"maxValue",void 0),(0,o._)([(0,c.Cb)({type:Number,json:{type:[Number],read:{source:"range",reader:function(e,t){return t.range&&t.range[0]}},write:{target:"range",writer:function(e,t,r){t[r]=[e,this.maxValue||0]}}}})],R.prototype,"minValue",void 0),(0,o._)([(0,f.J)({range:"range"})],R.prototype,"type",void 0);var S=R=x=(0,o._)([(0,h.j)("esri.layers.support.RangeDomain")],R),C={key:"type",base:_,typeMap:{range:R,"coded-value":k,inherited:Z}};function E(e){if(!e||!e.type)return null;switch(e.type){case"range":return S.fromJSON(e);case"codedValue":return k.fromJSON(e);case"inherited":return Z.fromJSON(e)}return null}},85249:function(e,t,r){r.d(t,{v:function(){return n}});var n=new(r(43404).X)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"})},87072:function(e,t,r){function n(e){var t,r=e.layer;return"floorInfo"in r&&null!==(t=r.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?a(e.view.floors,r.floorInfo.floorField):null}function i(e,t){var r;return"floorInfo"in t&&null!==(r=t.floorInfo)&&void 0!==r&&r.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(null===e||void 0===e||!e.length)return null;var r=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return r.push("''"),"".concat(t," IN (").concat(r.join(","),") OR ").concat(t," IS NULL")}r.d(t,{c:function(){return n},f:function(){return i}})},49818:function(e,t,r){r.d(t,{Z:function(){return R}});var n,i=r(29439),a=r(37762),s=r(15671),u=r(43144),o=r(60136),l=r(29388),c=r(27366),f=r(59486),h=r(52639),d=r(43404),p=r(46784),y=r(84652),v=r(49861),g=(r(25243),r(38511)),_=r(69912),m=r(31201),b=r(78952),k=r(77981),w=r(83040),x=new d.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null}),Z=n=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).displayFieldName=null,n.exceededTransferLimit=!1,n.features=[],n.fields=null,n.geometryType=null,n.hasM=!1,n.hasZ=!1,n.queryGeometry=null,n.spatialReference=null,n}return(0,u.Z)(r,[{key:"readFeatures",value:function(e,t){for(var r=b.Z.fromJSON(t.spatialReference),n=[],i=0;i<e.length;i++){var a=e[i],s=h.Z.fromJSON(a),u=a.geometry&&a.geometry.spatialReference;null==s.geometry||u||(s.geometry.spatialReference=r);var o=a.aggregateGeometries,l=s.aggregateGeometries;if(o&&null!=l)for(var c in l){var f=l[c],d=o[c],p=null===d||void 0===d?void 0:d.spatialReference;null==f||p||(f.spatialReference=r)}n.push(s)}return n}},{key:"writeGeometryType",value:function(e,t,r,n){if(e)x.write(e,t,r,n);else{var i=this.features;if(i){var s,u=(0,a.Z)(i);try{for(u.s();!(s=u.n()).done;){var o=s.value;if(o&&null!=o.geometry)return void x.write(o.geometry.type,t,r,n)}}catch(l){u.e(l)}finally{u.f()}}}}},{key:"readQueryGeometry",value:function(e,t){if(!e)return null;var r=!!e.spatialReference,n=(0,k.im)(e);return n&&!r&&t.spatialReference&&(n.spatialReference=b.Z.fromJSON(t.spatialReference)),n}},{key:"writeSpatialReference",value:function(e,t){if(e)t.spatialReference=e.toJSON();else{var r=this.features;if(r){var n,i=(0,a.Z)(r);try{for(i.s();!(n=i.n()).done;){var s=n.value;if(s&&null!=s.geometry&&s.geometry.spatialReference)return void(t.spatialReference=s.geometry.spatialReference.toJSON())}}catch(u){i.e(u)}finally{i.f()}}}}},{key:"clone",value:function(){return new n(this.cloneProperties())}},{key:"cloneProperties",value:function(){return(0,y.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}},{key:"toJSON",value:function(e){var t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var n=t.features[r];if(n.geometry){var i=e&&e[r];n.geometry=i&&i.toJSON()||n.geometry}}return t}},{key:"quantize",value:function(e){for(var t=(0,i.Z)(e.scale,2),r=t[0],n=t[1],a=(0,i.Z)(e.translate,2),s=a[0],u=a[1],o=this.features,l=this._getQuantizationFunction(this.geometryType,(function(e){return Math.round((e-s)/r)}),(function(e){return Math.round((u-e)/n)})),c=0,f=o.length;c<f;c++)(null===l||void 0===l?void 0:l(o[c].geometry))||(o.splice(c,1),c--,f--);return this.transform=e,this}},{key:"unquantize",value:function(){var e,t,r=this.geometryType,n=this.features,s=this.transform;if(!s)return this;var u=(0,i.Z)(s.translate,2),o=u[0],l=u[1],c=(0,i.Z)(s.scale,2),f=c[0],h=c[1],d=null,p=null;if(this.hasZ&&null!=(null===s||void 0===s||null===(e=s.scale)||void 0===e?void 0:e[2])){var y=(0,i.Z)(s.translate,3)[2],v=(0,i.Z)(s.scale,3)[2];d=function(e){return e*v+y}}if(this.hasM&&null!=(null===s||void 0===s||null===(t=s.scale)||void 0===t?void 0:t[3])){var g=(0,i.Z)(s.translate,4)[3],_=(0,i.Z)(s.scale,4)[3];p=function(e){return null==e?e:e*_+g}}var m,b=this._getHydrationFunction(r,(function(e){return e*f+o}),(function(e){return l-e*h}),d,p),k=(0,a.Z)(n);try{for(k.s();!(m=k.n()).done;){var w=m.value.geometry;null!=w&&b&&b(w)}}catch(x){k.e(x)}finally{k.f()}return this.transform=null,this}},{key:"_quantizePoints",value:function(e,t,r){for(var n,i,a=[],s=0,u=e.length;s<u;s++){var o=e[s];if(s>0){var l=t(o[0]),c=r(o[1]);l===n&&c===i||(a.push([l-n,c-i]),n=l,i=c)}else n=t(o[0]),i=r(o[1]),a.push([n,i])}return a.length>0?a:null}},{key:"_getQuantizationFunction",value:function(e,t,r){var n=this;return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){for(var i=(0,k.oU)(e)?e.rings:e.paths,a=[],s=0,u=i.length;s<u;s++){var o=i[s],l=n._quantizePoints(o,t,r);l&&a.push(l)}return a.length>0?((0,k.oU)(e)?e.rings=a:e.paths=a,e):null}:"multipoint"===e?function(e){var i=n._quantizePoints(e.points,t,r);return i&&i.length>0?(e.points=i,e):null}:"extent"===e?function(e){return e}:null}},{key:"_getHydrationFunction",value:function(e,t,r,n,i){return"point"===e?function(e){e.x=t(e.x),e.y=r(e.y),n&&(e.z=n(e.z))}:"polyline"===e||"polygon"===e?function(e){for(var a,s,u=(0,k.oU)(e)?e.rings:e.paths,o=0,l=u.length;o<l;o++)for(var c=u[o],f=0,h=c.length;f<h;f++){var d=c[f];f>0?(a+=d[0],s+=d[1]):(a=d[0],s=d[1]),d[0]=t(a),d[1]=r(s)}if(n&&i)for(var p=0,y=u.length;p<y;p++)for(var v=u[p],g=0,_=v.length;g<_;g++){var m=v[g];m[2]=n(m[2]),m[3]=i(m[3])}else if(n)for(var b=0,w=u.length;b<w;b++)for(var x=u[b],Z=0,R=x.length;Z<R;Z++){var S=x[Z];S[2]=n(S[2])}else if(i)for(var C=0,E=u.length;C<E;C++)for(var I=u[C],T=0,V=I.length;T<V;T++){var F=I[T];F[2]=i(F[2])}}:"extent"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax),n&&null!=e.zmax&&null!=e.zmin&&(e.zmax=n(e.zmax),e.zmin=n(e.zmin)),i&&null!=e.mmax&&null!=e.mmin&&(e.mmax=i(e.mmax),e.mmin=i(e.mmin))}:"multipoint"===e?function(e){for(var a,s,u=e.points,o=0,l=u.length;o<l;o++){var c=u[o];o>0?(a+=c[0],s+=c[1]):(a=c[0],s=c[1]),c[0]=t(a),c[1]=r(s)}if(n&&i)for(var f=0,h=u.length;f<h;f++){var d=u[f];d[2]=n(d[2]),d[3]=i(d[3])}else if(n)for(var p=0,y=u.length;p<y;p++){var v=u[p];v[2]=n(v[2])}else if(i)for(var g=0,_=u.length;g<_;g++){var m=u[g];m[2]=i(m[2])}}:null}}]),r}(p.wq);(0,c._)([(0,v.Cb)({type:String,json:{write:!0}})],Z.prototype,"displayFieldName",void 0),(0,c._)([(0,v.Cb)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],Z.prototype,"exceededTransferLimit",void 0),(0,c._)([(0,v.Cb)({type:[h.Z],json:{write:!0}})],Z.prototype,"features",void 0),(0,c._)([(0,g.r)("features")],Z.prototype,"readFeatures",null),(0,c._)([(0,v.Cb)({type:[w.Z],json:{write:!0}})],Z.prototype,"fields",void 0),(0,c._)([(0,v.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:x.read}}})],Z.prototype,"geometryType",void 0),(0,c._)([(0,m.c)("geometryType")],Z.prototype,"writeGeometryType",null),(0,c._)([(0,v.Cb)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],Z.prototype,"hasM",void 0),(0,c._)([(0,v.Cb)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],Z.prototype,"hasZ",void 0),(0,c._)([(0,v.Cb)({types:f.qM,json:{write:!0}})],Z.prototype,"queryGeometry",void 0),(0,c._)([(0,g.r)("queryGeometry")],Z.prototype,"readQueryGeometry",null),(0,c._)([(0,v.Cb)({type:b.Z,json:{write:!0}})],Z.prototype,"spatialReference",void 0),(0,c._)([(0,m.c)("spatialReference")],Z.prototype,"writeSpatialReference",null),(0,c._)([(0,v.Cb)({json:{write:!0}})],Z.prototype,"transform",void 0),(Z=n=(0,c._)([(0,_.j)("esri.rest.support.FeatureSet")],Z)).prototype.toJSON.isDefaultToJSON=!0;var R=Z},39383:function(e,t,r){r.d(t,{T:function(){return S}});var n=r(37762),i=r(74165),a=r(15861),s=r(15671),u=r(43144),o=r(11752),l=r(61120),c=r(60136),f=r(29388),h=r(66978),d=r(43e3),p=r(26885),y=r(55067),v=r(1413),g=r(17842),_=r(68860),m=r(49229),b=r(84319),k=r(10435),w=r(98029),x=r(90316);function Z(e,t){var r=t.length;if(e<t[0].value||1===r)return t[0].size;for(var n=1;n<r;n++)if(e<t[n].value){var i=(e-t[n-1].value)/(t[n].value-t[n-1].value);return t[n-1].size+i*(t[n].size-t[n-1].size)}return t[r-1].size}var R=function(){function e(){(0,s.Z)(this,e),this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1},this._technique=k.v}return(0,u.Z)(e,[{key:"getSizeVVFieldStops",value:function(e){var t,r=this._vvSizeFieldStops;if(r)switch(r.type){case"static":return r;case"level-dependent":return null!==(t=r.levels[e])&&void 0!==t?t:function(){var t=1/0,n=0;for(var i in r.levels){var a=parseFloat(i),s=Math.abs(e-a);s<t&&(t=s,n=a)}if(t===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};var u=Math.pow(2,(e-n)/2),o=r.levels[n],l=new Float32Array(o.values);return l[2]*=u,l[3]*=u,{sizes:o.sizes,values:l}}();default:return}}},{key:"vvMaterialParameters",get:function(){return this._vvMaterialParameters}},{key:"update",value:function(e){null!=this._vvInfo&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}},{key:"setInfo",value:function(e,t,r){this._updateEffects(r),this._vvInfo=t,this._technique=(0,w.EJ)(e),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,e)}},{key:"getVariation",value:function(){return(0,v.Z)((0,v.Z)({},this._technique.getVariation(this.rendererSchema)),{},{outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:(0,x.hc)("2d").supportsTextureFloat})}},{key:"getVariationHash",value:function(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}},{key:"_updateEffects",value:function(e){this.outsideLabelsVisible=null!=e&&e.excludedLabelsVisible}},{key:"_updateVisualVariables",value:function(e,t){var r=this._vvMaterialParameters;if(r.vvOpacityEnabled=!1,r.vvSizeEnabled=!1,r.vvColorEnabled=!1,r.vvRotationEnabled=!1,e){var n=e.size;if(n){if(r.vvSizeEnabled=!0,n.minMaxValue){var i,a,s=n.minMaxValue;if((0,b.$K)(s.minSize)&&(0,b.$K)(s.maxSize))if((0,b.hj)(s.minSize)&&(0,b.hj)(s.maxSize))i=(0,g.F2)(s.minSize),a=(0,g.F2)(s.maxSize);else{var u=t.scale;i=(0,g.F2)(Z(u,s.minSize.stops)),a=(0,g.F2)(Z(u,s.maxSize.stops))}this.vvSizeMinMaxValue.set([s.minDataValue,s.maxDataValue,i,a])}if(n.scaleStops&&(this.vvSizeScaleStopsValue=(0,g.F2)(Z(t.scale,n.scaleStops.stops))),n.unitValue){var o=(0,_.c9)(t.spatialReference)/m.a[n.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=o/t.resolution}n.fieldStops&&(this._vvSizeFieldStops=n.fieldStops)}var l=e.color;l&&(r.vvColorEnabled=!0,this.vvColorValues.set(l.values),this.vvColors.set(l.colors));var c=e.opacity;c&&(r.vvOpacityEnabled=!0,this.vvOpacityValues.set(c.values),this.vvOpacities.set(c.opacities));var f=e.rotation;f&&(r.vvRotationEnabled=!0,r.vvRotationType=f.type)}}}]),e}(),S=function(e){(0,c.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e))._rendererInfo=new R,n._materialItemsRequestQueue=new d.Z,n.attributeView=new p.H((function(){return n.onAttributeStoreUpdate()})),n}return(0,u.Z)(r,[{key:"destroy",value:function(){this.children.forEach((function(e){return e.destroy()})),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}},{key:"setRendererInfo",value:function(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()}},{key:"getMaterialItems",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&0!==t.length){e.next=2;break}return e.abrupt("return",[]);case 2:return n=(0,h.hh)(),e.abrupt("return",(this._materialItemsRequestQueue.push({items:t,abortOptions:r,resolver:n}),this.requestRender(),n.promise));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"doRender",value:function(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0)for(var t=this._materialItemsRequestQueue.pop();t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop();(0,o.Z)((0,l.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"renderChildren",value:function(e){var t,i=(0,n.Z)(this.children);try{for(i.s();!(t=i.n()).done;){t.value.commit(e)}}catch(a){i.e(a)}finally{i.f()}this._rendererInfo.update(e.state),(0,o.Z)((0,l.Z)(r.prototype),"renderChildren",this).call(this,e)}},{key:"updateTransforms",value:function(e){if(this.children.some((function(e){return e.hasData}))){var t,r=(0,n.Z)(this.children);try{for(r.s();!(t=r.n()).done;){t.value.setTransform(e)}}catch(i){r.e(i)}finally{r.f()}}}},{key:"createRenderParams",value:function(e){var t=(0,o.Z)((0,l.Z)(r.prototype),"createRenderParams",this).call(this,e);return t.rendererInfo=this._rendererInfo,t.attributeView=this.attributeView,t}},{key:"onAttributeStoreUpdate",value:function(){}},{key:"_processMaterialItemRequest",value:function(e,t){var r=this,n=t.items,i=t.abortOptions,a=t.resolver,s=e.painter,u=e.pixelRatio,o=n.map((function(e){return s.textureManager.rasterizeItem(e.symbol,u,e.glyphIds,i)}));Promise.all(o).then((function(e){if(r.stage){var t=e.map((function(e,t){return{id:n[t].id,mosaicItem:e}}));a.resolve(t)}else a.reject()}),a.reject)}}]),r}(y.Z)},39484:function(e,t,r){r.d(t,{Q:function(){return h},g:function(){return c}});var n=r(37762),i=r(15671),a=r(43144),s=r(93169),u=r(92026),o=r(70734),l=(0,s.Z)("esri-2d-log-allocations"),c=function(){function e(t,r){(0,i.Z)(this,e),this._array=t,this._pool=r}return(0,a.Z)(e,[{key:"array",get:function(){return this._array}},{key:"length",get:function(){return this._array.length}},{key:"expand",value:function(e){var t=this._pool.acquire(e);t.set(this._array),this._pool.release(this._array),this._array=t}},{key:"destroy",value:function(){this._pool.release(this._array)}},{key:"set",value:function(e,t){this._array.set(e._array,t)}},{key:"slice",value:function(){var t=this._pool.acquire(this._array.byteLength);return t.set(this._array),new e(t,this._pool)}}],[{key:"create",value:function(t,r){return new e(r.acquire(t),r)}}]),e}(),f=function(){function e(){(0,i.Z)(this,e),this._data=new ArrayBuffer(e.BYTE_LENGTH),this._freeList=new o.m({start:0,end:this._data.byteLength})}return(0,a.Z)(e,[{key:"buffer",get:function(){return this._data}},{key:"allocate",value:function(e){var t=this._freeList.firstFit(e);return null==t?null:new Uint32Array(this._data,t,e/Uint32Array.BYTES_PER_ELEMENT)}},{key:"free",value:function(e){this._freeList.free(e.byteOffset,e.byteLength)}}],[{key:"BYTE_LENGTH",get:function(){return 64e6}}]),e}(),h=function(){function e(){(0,i.Z)(this,e),this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}return(0,a.Z)(e,[{key:"destroy",value:function(){this._pages=[],this._pagesByBuffer=null}},{key:"_bytesTotal",get:function(){return this._pages.length*f.BYTE_LENGTH}},{key:"acquire",value:function(e){if(this._bytesAllocated+=e,l&&console.log("Allocating ".concat(e,", (").concat(this._bytesAllocated," / ").concat(this._bytesTotal,")")),e>f.BYTE_LENGTH)return new Uint32Array(e/Uint32Array.BYTES_PER_ELEMENT);var t,r=(0,n.Z)(this._pages);try{for(r.s();!(t=r.n()).done;){var i=t.value.allocate(e);if(null!=i)return i}}catch(a){r.e(a)}finally{r.f()}return(0,u.s3)(this._addPage().allocate(e),"Expected to allocate page")}},{key:"release",value:function(e){this._bytesAllocated-=e.byteLength,l&&console.log("Freeing ".concat(e.byteLength,", (").concat(this._bytesAllocated," / ").concat(this._bytesTotal,")"));var t=this._pagesByBuffer.get(e.buffer);t&&t.free(e)}},{key:"_addPage",value:function(){var e=new f;return this._pages.push(e),this._pagesByBuffer.set(e.buffer,e),e}}]),e}()},55067:function(e,t,r){r.d(t,{Z:function(){return v}});var n=r(37762),i=r(15671),a=r(43144),s=r(11752),u=r(61120),o=r(60136),l=r(29388),c=r(93169),f=r(80613),h=r(64510),d=r(52424),p=r(40655),y=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},v=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this))._tileInfoView=e,n}return(0,a.Z)(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(y),this.setStencilReference(e),(0,s.Z)((0,u.Z)(r.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,n=(0,s.Z)((0,u.Z)(r.prototype),"createRenderParams",this).call(this,e);return n.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,n.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),n}},{key:"prepareRenderPasses",value:function(e){var t=this,n=(0,s.Z)((0,u.Z)(r.prototype),"prepareRenderPasses",this).call(this,e);return n.push(e.registerRenderPass({name:"stencil",brushes:[p.Z],drawPhase:f.jx.DEBUG|f.jx.MAP|f.jx.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),(0,c.Z)("esri-tiles-debug")&&n.push(e.registerRenderPass({name:"tileInfo",brushes:[d.Z],drawPhase:f.jx.DEBUG,target:function(){return t.children}})),n}},{key:"getStencilTarget",value:function(){return this.children}},{key:"setStencilReference",value:function(e){var t,r=1,i=(0,n.Z)(this.children);try{for(i.s();!(t=i.n()).done;){t.value.stencilRef=r++}}catch(a){i.e(a)}finally{i.f()}}}]),r}(h.Z)},20089:function(e,t,r){r.r(t),r.d(t,{default:function(){return lt}});var n=r(1413),i=r(74165),a=r(15861),s=r(15671),u=r(43144),o=r(60136),l=r(29388),c=r(93433),f=r(37762),h=r(27366),d=r(52639),p=r(49861),y=(r(25243),r(63780)),v=r(93169),g=r(69912),_=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).isAggregate=!0,e}return(0,u.Z)(r,[{key:"getEffectivePopupTemplate",value:function(){if(this.popupTemplate)return this.popupTemplate;var e=this.sourceLayer&&this.sourceLayer.featureReduction;return e&&"popupTemplate"in e&&e.popupEnabled?e.popupTemplate:null}},{key:"getObjectId",value:function(){return this.attributes.aggregateId}}]),r}(d.Z);(0,h._)([(0,p.Cb)({type:Boolean})],_.prototype,"isAggregate",void 0);var m=_=(0,h._)([(0,g.j)("esri.AggregateGraphic")],_),b=(r(59486),r(40281)),k=r(10064),w=r(84652),x=r(32718),Z=r(92026),R=r(66978),S=r(94172),C=r(17842),E=r(7138),I=r(41978),T=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e))._filter=null,n.duration=(0,v.Z)("mapview-transitions-duration"),n._excludedEffectView=new I.AM(e),n._includedEffectView=new I.AM(e),n}return(0,u.Z)(r,[{key:"excludedEffects",get:function(){return this._excludedEffectView.effects}},{key:"featureEffect",set:function(e){this._get("featureEffect")!==e&&this._transitionTo(e)}},{key:"filter",get:function(){var e;return this._filter||(null===(e=this.featureEffect)||void 0===e?void 0:e.filter)||null}},{key:"hasEffects",get:function(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}},{key:"includedEffects",get:function(){return this._includedEffectView.effects}},{key:"scale",set:function(e){this._set("scale",e),this._excludedEffectView.scale=e,this._includedEffectView.scale=e}},{key:"transitioning",get:function(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}},{key:"transitionStep",value:function(e,t){this._set("scale",t),this.transitioning?(this._includedEffectView.transitionStep(e,t),this._excludedEffectView.transitionStep(e,t),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=t,this._includedEffectView.scale=t)}},{key:"endTransitions",value:function(){this._includedEffectView.endTransitions(),this._excludedEffectView.endTransitions(),this._filter=null}},{key:"_transitionTo",value:function(e){var t=this._get("featureEffect"),r=e,n=null===r||void 0===r?void 0:r.includedEffect,i=null===r||void 0===r?void 0:r.excludedEffect,a=this._includedEffectView.canTransitionTo(n)&&this._excludedEffectView.canTransitionTo(i);this._includedEffectView.effect=n,this._excludedEffectView.effect=i,this._set("featureEffect",r),this._filter=(null===r||void 0===r?void 0:r.filter)||(null===t||void 0===t?void 0:t.filter)||null,a||this.endTransitions()}}]),r}(E.Z);(0,h._)([(0,p.Cb)()],T.prototype,"_filter",void 0),(0,h._)([(0,p.Cb)()],T.prototype,"_excludedEffectView",void 0),(0,h._)([(0,p.Cb)()],T.prototype,"_includedEffectView",void 0),(0,h._)([(0,p.Cb)()],T.prototype,"duration",void 0),(0,h._)([(0,p.Cb)()],T.prototype,"excludedEffects",null),(0,h._)([(0,p.Cb)()],T.prototype,"featureEffect",null),(0,h._)([(0,p.Cb)()],T.prototype,"filter",null),(0,h._)([(0,p.Cb)()],T.prototype,"hasEffects",null),(0,h._)([(0,p.Cb)()],T.prototype,"includedEffects",null),(0,h._)([(0,p.Cb)({value:0})],T.prototype,"scale",null),(0,h._)([(0,p.Cb)()],T.prototype,"transitioning",null);var V=T=(0,h._)([(0,g.j)("esri.layers.effects.FeatureEffectView")],T),F=r(18661),q=r(37933),U=r(38511),O=r(49818),A=r(78952),P=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).features=[],e}return(0,u.Z)(r,[{key:"readFeatures",value:function(e,t){for(var r=A.Z.fromJSON(t.spatialReference),n=[],i=0;i<e.length;i++){var a=e[i],s=m.fromJSON(a),u=a.geometry&&a.geometry.spatialReference;null==s.geometry||u||(s.geometry.spatialReference=r);var o=a.aggregateGeometries,l=s.aggregateGeometries;if(o&&null!=l)for(var c in l){var f=l[c],h=o[c],d=null===h||void 0===h?void 0:h.spatialReference;null==f||d||(f.spatialReference=r)}n.push(s)}return n}}]),r}(O.Z);(0,h._)([(0,p.Cb)({type:[m],json:{write:!0}})],P.prototype,"features",void 0),(0,h._)([(0,U.r)("features")],P.prototype,"readFeatures",null);var L=P=(0,h._)([(0,g.j)("esri.rest.support.AggregateFeatureSet")],P),z=r(86638),B=r(94109),N=r(95986),j=r(69534),M=r(27811),D=r(9849),J=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).tiles=new Map,n}return(0,u.Z)(r,[{key:"destroy",value:function(){this.tiles.clear(),this.layer=this.layerView=this.tileInfoView=this.tiles=null}},{key:"updating",get:function(){return this.isUpdating()}},{key:"acquireTile",value:function(e){var t=this,r=this.createTile(e);return r.once("isReady",(function(){return t.notifyChange("updating")})),this.tiles.set(e.id,r),this.notifyChange("updating"),r}},{key:"forceAttributeTextureUpload",value:function(){}},{key:"forEachTile",value:function(e){this.tiles.forEach(e)}},{key:"releaseTile",value:function(e){this.tiles.delete(e.key.id),this.notifyChange("updating"),this.disposeTile(e)}},{key:"isUpdating",value:function(){var e=!0;this.tiles.forEach((function(t){e=e&&t.isReady}));var t=!e;if((0,v.Z)("esri-2d-log-updating")){var r="";this.tiles.forEach((function(t){var n=t.updateStatus;r+="-> ".concat(t.key.id,": isReady: ").concat(t.isReady," status: ").concat(n,"\n"),e=e&&t.isReady})),console.log("Updating BaseTileRenderer ".concat(t,"\n").concat(r))}return t}},{key:"setHighlight",value:function(){}},{key:"invalidateLabels",value:function(){}},{key:"requestUpdate",value:function(){this.layerView.requestUpdate()}}]),r}(r(41691).r);(0,h._)([(0,p.Cb)()],J.prototype,"layer",void 0),(0,h._)([(0,p.Cb)()],J.prototype,"layerView",void 0),(0,h._)([(0,p.Cb)()],J.prototype,"tileInfoView",void 0),(0,h._)([(0,p.Cb)()],J.prototype,"updating",null);var G=J=(0,h._)([(0,g.j)("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],J),H=function(){function e(){(0,s.Z)(this,e),this.gradient=null,this.height=512,this.intensities=null,this.width=512}return(0,u.Z)(e,[{key:"render",value:function(e){(0,M.hy)(e,512,this.intensities,this.gradient,this.minDensity,this.maxDensity)}}]),e}(),Q=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e))._intensityInfo={minDensity:0,maxDensity:0},n.type="heatmap",n.featuresView={attributeView:{initialize:function(){},requestUpdate:function(){}},requestRender:function(){}},n._container=new D.s(e.tileInfoView),n}return(0,u.Z)(r,[{key:"createTile",value:function(e){var t=this._container.createTile(e);return this.tileInfoView.getTileCoords(t.bitmap,e),t.bitmap.resolution=this.tileInfoView.getTileResolution(e),t}},{key:"onConfigUpdate",value:function(){var e=this,t=this.layer.renderer;if("heatmap"===t.type){var r=t.minDensity,n=t.maxDensity,i=t.colorStops;this._intensityInfo.minDensity=r,this._intensityInfo.maxDensity=n,this._gradient=(0,M.uI)(i),this.tiles.forEach((function(t){var i=t.bitmap.source;i&&(i.minDensity=r,i.maxDensity=n,i.gradient=e._gradient,t.bitmap.invalidateTexture(),t.bitmap.requestRender())}))}}},{key:"hitTest",value:function(){return Promise.resolve([])}},{key:"install",value:function(e){e.addChild(this._container)}},{key:"uninstall",value:function(e){this._container.removeAllChildren(),e.removeChild(this._container)}},{key:"disposeTile",value:function(e){this._container.removeChild(e),e.destroy()}},{key:"supportsRenderer",value:function(e){return e&&"heatmap"===e.type}},{key:"onTileData",value:function(e){var t=this.tiles.get(e.tileKey);if(t){var r=e.intensityInfo,n=this._intensityInfo,i=n.minDensity,a=n.maxDensity,s=t.bitmap.source||new H;s.intensities=r&&r.matrix||null,s.minDensity=i,s.maxDensity=a,s.gradient=this._gradient,t.bitmap.source=s,this._container.addChild(t),this._container.requestRender(),this.requestUpdate()}}},{key:"onTileError",value:function(e){console.error(e)}},{key:"lockGPUUploads",value:function(){}},{key:"unlockGPUUploads",value:function(){}},{key:"fetchResource",value:function(e,t){return console.error(e),Promise.reject()}}]),r}(G);Q=(0,h._)([(0,g.j)("esri.views.2d.layers.features.tileRenderers.HeatmapTileRenderer")],Q);var Y=r(11752),X=r(61120),K=r(65156),W=r(43244),$=r(11245),ee=r(80613),te=r(84319),re=r(98774),ne=4294967296,ie=function(){function e(t){(0,s.Z)(this,e),this._savedCursor=null,this._savedOffset=null,this._head=t,this._cursor=t}return(0,u.Z)(e,[{key:"id",get:function(){return this._cursor.id}},{key:"baseZoom",get:function(){return this._cursor.baseZoom}},{key:"anchorX",get:function(){return this._cursor.anchorX}},{key:"anchorY",get:function(){return this._cursor.anchorY}},{key:"directionX",get:function(){return this._cursor.directionX}},{key:"directionY",get:function(){return this._cursor.directionY}},{key:"size",get:function(){return this._cursor.size}},{key:"materialKey",get:function(){return this._cursor.materialKey}},{key:"boundsCount",get:function(){return this._cursor.boundsCount}},{key:"computedMinZoom",value:function(){return this._cursor.computedMinZoom()}},{key:"setComputedMinZoom",value:function(e){return this._cursor.setComputedMinZoom(e)}},{key:"boundsComputedAnchorX",value:function(e){return this._cursor.boundsComputedAnchorX(e)}},{key:"boundsComputedAnchorY",value:function(e){return this._cursor.boundsComputedAnchorY(e)}},{key:"setBoundsComputedAnchorX",value:function(e,t){return this._cursor.setBoundsComputedAnchorX(e,t)}},{key:"setBoundsComputedAnchorY",value:function(e,t){return this._cursor.setBoundsComputedAnchorY(e,t)}},{key:"boundsX",value:function(e){return this._cursor.boundsX(e)}},{key:"boundsY",value:function(e){return this._cursor.boundsY(e)}},{key:"boundsWidth",value:function(e){return this._cursor.boundsWidth(e)}},{key:"boundsHeight",value:function(e){return this._cursor.boundsHeight(e)}},{key:"link",value:function(e){if(null!=e._head)return this._cursor.link(e._head)}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var t,r=new e(null===(t=this._head)||void 0===t?void 0:t.copy());if(!r._head)return r;for(var n=r._head,i=r._head._link;i;)n._link=i.copy(),i=(n=i)._link;return r}},{key:"peekId",value:function(){var e;return null!==(e=this._cursor.peekId())&&void 0!==e?e:this._cursor._link.peekId()}},{key:"nextId",value:function(){for(var e=this.id;e===this.id;)if(!this.next())return!1;return!0}},{key:"save",value:function(){this._savedCursor=this._cursor,this._savedOffset=this._cursor._offset}},{key:"restore",value:function(){this._savedCursor&&(this._cursor=this._savedCursor),null!=this._savedOffset&&(this._cursor._offset=this._savedOffset)}},{key:"next",value:function(){if(!this._cursor)return!1;if(!this._cursor.next()){if(!this._cursor._link)return!1;this._cursor=this._cursor._link,this._cursor._offset=0}return!0}},{key:"lookup",value:function(e){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(e);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}},{key:"delete",value:function(e){for(var t=this._head,r=null;t;){if(t.delete(e))return t.isEmpty()&&null!=r&&(r._link=t._link),!0;r=t,t=t._link}return!1}}],[{key:"from",value:function(t){return new e(ae.from(new Float32Array(t)))}}]),e}(),ae=function(){function e(t){(0,s.Z)(this,e),this._offset=-1,this._link=null,this._count=0,this._deletedCount=0,this._offsets={instance:null},this._buffer=t}return(0,u.Z)(e,[{key:"isEmpty",value:function(){return this._deletedCount===this.count}},{key:"count",get:function(){return this._count||(this._count=this._computeCount()),this._count}},{key:"id",get:function(){return this._buffer[this._offset]},set:function(e){this._buffer[this._offset]=e}},{key:"baseZoom",get:function(){return this._buffer[this._offset+1]}},{key:"anchorX",get:function(){return this._buffer[this._offset+2]}},{key:"anchorY",get:function(){return this._buffer[this._offset+3]}},{key:"directionX",get:function(){return this._buffer[this._offset+4]}},{key:"directionY",get:function(){return this._buffer[this._offset+5]}},{key:"size",get:function(){return this._buffer[this._offset+6]}},{key:"materialKey",get:function(){return this._buffer[this._offset+7]}},{key:"computedMinZoom",value:function(){return this._buffer[this._offset+8]}},{key:"setComputedMinZoom",value:function(e){this._buffer[this._offset+8]=e}},{key:"boundsCount",get:function(){return this._buffer[this._offset+9]}},{key:"boundsComputedAnchorX",value:function(e){return this._buffer[this._offset+10+6*e]}},{key:"boundsComputedAnchorY",value:function(e){return this._buffer[this._offset+10+6*e+1]}},{key:"setBoundsComputedAnchorX",value:function(e,t){this._buffer[this._offset+10+6*e]=t}},{key:"setBoundsComputedAnchorY",value:function(e,t){this._buffer[this._offset+10+6*e+1]=t}},{key:"boundsX",value:function(e){return this._buffer[this._offset+10+6*e+2]}},{key:"boundsY",value:function(e){return this._buffer[this._offset+10+6*e+3]}},{key:"boundsWidth",value:function(e){return this._buffer[this._offset+10+6*e+4]}},{key:"boundsHeight",value:function(e){return this._buffer[this._offset+10+6*e+5]}},{key:"link",value:function(e){for(var t=this;t._link;)t=t._link;t._link=e}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this._buffer);return t._link=this._link,t._offset=this._offset,t._deletedCount=this._deletedCount,t._offsets=this._offsets,t._count=this._count,t}},{key:"peekId",value:function(){var e=this._offset+10+6*this.boundsCount+0;return e>=this._buffer.length?0:this._buffer[e]}},{key:"next",value:function(){for(var e=0;this._offset<this._buffer.length&&e++<100&&(-1===this._offset?this._offset=0:this._offset+=10+6*this.boundsCount,this.id===ne););return this.id!==ne&&this._offset<this._buffer.length}},{key:"delete",value:function(e){var t=this._offset,r=this.lookup(e);if(r)for(this.id=4294967295,++this._deletedCount;this.next()&&this.id===e;)this.id=4294967295,++this._deletedCount;return this._offset=t,r}},{key:"lookup",value:function(e){var t=this._offset;if(null==this._offsets.instance){this._offsets.instance=new Map;var r=this.copy();r._offset=-1;for(var n=0;r.next();)r.id!==n&&(this._offsets.instance.set(r.id,r._offset),n=r.id)}return!!this._offsets.instance.has(e)&&(this._offset=this._offsets.instance.get(e),this.id!==ne||(this._offset=t,!1))}},{key:"_computeCount",value:function(){var e=this._offset,t=0;for(this._offset=-1;this.next();)t++;return this._offset=e,t}}],[{key:"from",value:function(t){return new e(new Float32Array(t))}}]),e}(),se=r(29439),ue=r(39694),oe=r(39484),le=r(70734),ce=r(44070),fe=r(8548),he=function(){function e(t,r,n,i){(0,s.Z)(this,e);var a=oe.g.create(r*n*Uint32Array.BYTES_PER_ELEMENT,i);this.size=r,this.strideInt=n,this.bufferType=t,this.dirty={start:1/0,end:0},this._gpu=null,this._cpu=a,this.clear()}return(0,u.Z)(e,[{key:"elementSize",get:function(){return this._cpu.length/this.strideInt}},{key:"invalidated",get:function(){return this.bufferSize>0&&!this._gpu}},{key:"invalidatedComputeBuffer",get:function(){return this.bufferSize>0&&!this._gpuComputeTriangles}},{key:"invalidate",value:function(){this._invalidateTriangleBuffer(),(0,Z.yw)(this._gpu,(function(e){return e.dispose()})),this._gpu=null}},{key:"_invalidateTriangleBuffer",value:function(){(0,Z.yw)(this._gpuComputeTriangles,(function(e){return e.dispose()})),this._gpuComputeTriangles=null}},{key:"destroy",value:function(){(0,Z.yw)(this._gpu,(function(e){return e.dispose()})),(0,Z.yw)(this._gpuComputeTriangles,(function(e){return e.dispose()})),(0,Z.yw)(this._cpu,(function(e){return e.destroy()})),(0,Z.yw)(this._cpu2,(function(e){return e.destroy()}))}},{key:"clear",value:function(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new le.m({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}},{key:"ensure",value:function(e){if(!(this.maxAvailableSpace()>=e)&&e*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();var t=this._cpu.length/this.strideInt,r=Math.round(1.25*(t+e)),n=r*this.strideInt;this._cpu.expand(n*Uint32Array.BYTES_PER_ELEMENT),this.freeList.free(t,r-t)}}},{key:"set",value:function(e,t){this._cpu.array[e]!==t&&(this._cpu.array[e]=t,this.dirty.start=Math.min(e,this.dirty.start),this.dirty.end=Math.max(e,this.dirty.end))}},{key:"getGPUBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.bufferSize)return null;if(t){if("index"!==this.bufferType)throw new Error("Tired to get triangle buffer, but target is not an index buffer");return null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(e)),this._gpuComputeTriangles}return null==this._gpu&&(this._gpu=this._createBuffer(e)),this._gpu}},{key:"getCPUBuffer",value:function(){if(!this._cpu2){var e=this._cpu.slice();this._cpu2=e}return this._cpu2.length!==this._cpu.length&&this._cpu2.expand(this._cpu.length*this._cpu.array.BYTES_PER_ELEMENT),this._cpu2.set(this._cpu),this._cpu2}},{key:"bufferSize",get:function(){return this._cpu.length/this.strideInt}},{key:"maxAvailableSpace",value:function(){return this.freeList.maxAvailableSpace()}},{key:"insert",value:function(e,t,r,n){var i=r*this.strideInt;if(!i)return 0;var a=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,s=new Uint32Array(e,a,i),u=(0,Z.s3)(this.freeList.firstFit(r),"First fit region must be defined")*this.strideInt,o=i,l=u/this.strideInt-t;if(0!==n)for(var c=0;c<s.length;c++)s[c]+=n;return this._cpu.array.set(s,u),this.dirty.start=Math.min(this.dirty.start,u),this.dirty.end=Math.max(this.dirty.end,u+o),this.fillPointer=Math.max(this.fillPointer,u+o),l}},{key:"free",value:function(e,t,r){var n=e*this.strideInt,i=(e+t)*this.strideInt;if(!0===r)for(var a=e;a!==e+t;a++)this._cpu.array[a*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,n),this.dirty.end=Math.max(this.dirty.end,i),this.freeList.free(e,t)}},{key:"upload",value:function(){if(this.dirty.end){if(this._invalidateTriangleBuffer(),null==this._gpu)return this.dirty.start=1/0,void(this.dirty.end=0);this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}},{key:"_createBuffer",value:function(e){var t=fe.l1.DYNAMIC_DRAW;return"index"===this.bufferType?ce.f.createIndex(e,t,this._cpu.array):ce.f.createVertex(e,t,this._cpu.array)}},{key:"_createComputeBuffer",value:function(e){for(var t=fe.l1.DYNAMIC_DRAW,r=new Uint32Array(this.fillPointer/3),n=0;n<this.fillPointer;n+=3)r[n/3]=this._cpu.array[n];return ce.f.createIndex(e,t,r)}}]),e}(),de=r(50477),pe=r(45412),ye=function(){function e(t,r){(0,s.Z)(this,e),this._vaos=new Map,this._indicesInvalid=!1,this.geometryType=t,this._stage=r}return(0,u.Z)(e,[{key:"destroy",value:function(){var e,t=(0,f.Z)(this._vaos);try{for(t.s();!(e=t.n()).done;){var r=(0,se.Z)(e.value,2),n=(r[0],r[1]);null===n||void 0===n||n.disposeVAOOnly()}}catch(i){t.e(i)}finally{t.f()}this._indexBuffer=(0,Z.SC)(this._indexBuffer),this._vertexBuffer=(0,Z.SC)(this._vertexBuffer)}},{key:"records",get:function(){return this._records}},{key:"insert",value:function(e,t,r){if(e.records.byteLength){var n=e.stride;if(this._vertexBuffer&&this._indexBuffer){var i=e.indices.byteLength/4,a=e.vertices.byteLength/n;this._indexBuffer.ensure(i),this._vertexBuffer.ensure(a);var s=e.vertices,u=e.indices,o=de.$.from(e.records),l=this._vertexBuffer.insert(s,0,s.byteLength/n,0),c=this._indexBuffer.insert(u,0,u.byteLength/4,l);if(o.forEach((function(e){e.indexFrom+=c,e.vertexFrom+=l})),(0,Z.s3)(this._records,"Expected records to be defined").link(o),t)this._indicesInvalid=!0;else if(this._displayList)for(var f=o.getCursor();f.next();)this._displayList.addRecord(f)}else{var h=e.indices.byteLength/4,d=e.vertices.byteLength/n,p=n/Uint32Array.BYTES_PER_ELEMENT,y=this._stage.bufferPool;this._records=de.$.from(e.records),this._indexBuffer=new he("index",h,1,y),this._vertexBuffer=new he("vertex",d,p,y),this._indexBuffer.insert(e.indices,0,e.indices.byteLength/4,0),this._vertexBuffer.insert(e.vertices,0,e.vertices.byteLength/n,0),t&&(this._indicesInvalid=!0)}}}},{key:"remove",value:function(e){if(null!=this._records){var t,r=(0,f.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,i=this._records.getCursor();if(i.lookup(n)){for(var a=i.indexFrom,s=i.vertexFrom,u=i.indexCount,o=i.vertexCount;i.next()&&i.id===n;)u+=i.indexCount,o+=i.vertexCount;this._indexBuffer.free(a,u),this._vertexBuffer.free(s,o,!0),this._records.delete(n)}}}catch(l){r.e(l)}finally{r.f()}}}},{key:"getVAO",value:function(e,t,r,n){var i;if(!this._vertexBuffer||!this._indexBuffer||null==this._records||!this._vertexBuffer.bufferSize)return null;var a=n?1:0,s=this._vaos.get(a);(this._vertexBuffer.invalidated||this._indexBuffer.invalidated||n&&this._indexBuffer.invalidatedComputeBuffer)&&(null!==(i=s)&&void 0!==i&&i.disposeVAOOnly(),s=null),this._vertexBuffer.upload(),this._indexBuffer.upload();var u=this._indexBuffer.getGPUBuffer(e,1===a),o=this._vertexBuffer.getGPUBuffer(e);return s||(s=new pe.U(e,r,t,{geometry:o},u),this._vaos.set(a,s)),s}},{key:"forEachCommand",value:function(e){if(null!=this._records){if(this._sortIndices(this._records),!this._displayList){var t=this._cursorIndexOrder;this._displayList=ue.S.from(this,this.geometryType,this._records.getCursor(),t)}this._displayList.forEach(e)}}},{key:"_sortIndices",value:function(e){var t=!!this._indexBuffer.bufferSize;if(this._indicesInvalid){this._indicesInvalid=!1;for(var r=0,n=e.getCursor(),i=[],a=[],s=[];n.next();)a.push(n.index),s.push(n.sortKey),i.push(n.id);a.sort((function(e,t){var r=s[t],n=s[e];return n===r?i[t]-i[e]:r-n}));for(var u=e.getCursor(),o=t?this._indexBuffer.getCPUBuffer():this._vertexBuffer.getCPUBuffer(),l=0,c=a;l<c.length;l++){var f=c[l];if(!u.seekIndex(f))throw new Error("Expected to find index");if(t){var h=u.indexFrom,d=u.indexCount;u.indexFrom=r;for(var p=0;p<d;p++)this._indexBuffer.set(r++,o.array[h+p])}else{var y=u.vertexFrom,v=u.vertexCount,g=this._vertexBuffer.strideInt,_=y*g,m=_+v*g;u.vertexFrom=r/g;for(var b=_;b<m;b++)this._vertexBuffer.set(r++,o.array[b])}}this._cursorIndexOrder=a,this._displayList=null}}}]),e}(),ve=0,ge=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(e,n,i,a,u,o){var l;return(0,s.Z)(this,r),(l=t.call(this,e,n,i,a)).instanceId=ve++,l.patchCount=0,l._renderState={current:{geometry:new Map,metrics:null},next:null,swap:!1,swapFrames:0,locked:!1},l._patches=new W.Z(100),l._bufferPatches=new W.Z(100),l._lastCommitTime=0,l.transforms.labelMat2d=(0,$.c)(),l._store=u,l._requestLabelUpdate=o,l}return(0,u.Z)(r,[{key:"destroy",value:function(){(0,Y.Z)((0,X.Z)(r.prototype),"destroy",this).call(this),this._renderState.current.geometry.forEach((function(e){return e.destroy()})),null!=this._renderState.next&&this._renderState.next.geometry.forEach((function(e){return e.destroy()})),this._renderState.current=null,this._renderState.next=null}},{key:"labelMetrics",get:function(){return this._renderState.current.metrics}},{key:"hasData",get:function(){return!!this._renderState.current.geometry.size}},{key:"updateStatus",get:function(){return"renderState:".concat(!!this._renderState.current,", ").concat(!!this._renderState.next,", hasData:").concat(this.hasData,", queue:").concat(this._patches.size)}},{key:"getGeometry",value:function(e){return this._renderState.current.geometry.get(e)}},{key:"patch",value:function(e,t){this.patchCount++,e.clear&&this._patches.size>=50&&this._dropPatches();var r=e,n=r.addOrUpdate&&this.key.id!==r.addOrUpdate.tileKeyOrigin;t&&n?this._bufferPatches.enqueue(r):(r.sort=r.sort&&!t,this._patches.enqueue(r)),this.requestRender()}},{key:"commit",value:function(e){if(this._lastCommitTime!==e.time){this._lastCommitTime=e.time;for(var t=0;t<4;t++)this._updateMesh(),this.isReady&&this._updateBufferMesh();this._renderState.swap&&(this._swapRenderStates(),this.requestRender())}}},{key:"lock",value:function(){this._renderState.locked=!0}},{key:"unlock",value:function(){this._renderState.locked=!1,this._flushUpdates(),this._swap()}},{key:"_swapRenderStates",value:function(){if(this._renderState.next){if(this._renderState.locked)return this._renderState.swap=!0,void this.requestRender();this._renderState.swap=!0,this._swap()}}},{key:"_swap",value:function(){this._renderState.swap&&(this._renderState.swap=!1,null!=this._renderState.next&&(this._renderState.current.geometry.forEach((function(e){return e.destroy()})),this._renderState.current=this._renderState.next,this._renderState.next=null,this._requestLabelUpdate()))}},{key:"_flushUpdates",value:function(){for(var e=this._patches.maxSize;this._patches.size&&e--;)this._updateMesh(),this._swap()}},{key:"_updateBufferMesh",value:function(){var e=this._bufferPatches.peek();if(null==e||!e.clear||null===this._renderState.next)for(;this._bufferPatches.size;){var t=this._bufferPatches.dequeue();null!=t&&this._patchBuffer(t)}}},{key:"_updateMesh",value:function(){var e=this._patches.dequeue();if(null!=e){if((0,v.Z)("esri-2d-update-debug")){for(var t,r=e,n=null===(t=r.addOrUpdate)||void 0===t?void 0:t.tileKeyOrigin,i=this.key.id===n?"SELF":n,a="",s=0;s<5;s++){var u;a+=null!==(u=r.addOrUpdate)&&void 0!==u&&null!==(u=u.data[s])&&void 0!==u&&null!==(u=u.records)&&void 0!==u&&u.byteLength?1:0}console.debug(this.key.id,"FeatureTile:patch","[clear: ".concat(r.clear," origin: ").concat(i,", end:").concat(r.end," data:").concat(a,"]"))}!0===e.clear&&(null!=this._renderState.next&&(this._renderState.next.geometry.forEach((function(e){return e.destroy()})),this._renderState.next=null),this._renderState.next={geometry:new Map,metrics:null},(0,v.Z)("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Creating new renderState")),this.requestRender(),this._patch(e),e.end&&((0,v.Z)("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_updateMesh - Encountered end message"),this.ready(),this._swapRenderStates())}}},{key:"_patch",value:function(e){var t=this;(0,te.Z_)((function(r){t._remove(r,e.remove),t._insert(r,e,!1)}))}},{key:"_patchBuffer",value:function(e){var t=this;(0,te.Z_)((function(r){t._insert(r,e,!0)}))}},{key:"_insert",value:function(e,t,r){try{var n,i,a,s=null!==(n=this._renderState.next)&&void 0!==n?n:this._renderState.current,u=null===(i=t.addOrUpdate)||void 0===i?void 0:i.data[e],o=s.geometry;if(null==u)return;o.has(e)||((0,v.Z)("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_insert - Creating geometry buffer ".concat(e)),o.set(e,new ye(e,this.stage))),(0,v.Z)("esri-2d-update-debug")&&console.debug(this.key.id,"FeatureTile:_insert - Inserting into ".concat(e,", version=").concat(null===(a=t.addOrUpdate)||void 0===a?void 0:a.version," stride=").concat(u.stride)),o.get(e).insert(u,t.sort,r),e===ee.LW.LABEL&&this._insertLabelMetrics(t.type,u.metrics,t.clear)}catch(Ce){}}},{key:"_insertLabelMetrics",value:function(e,t,r){var n,i=null!==(n=this._renderState.next)&&void 0!==n?n:this._renderState.current;if(null!=t){var a=ie.from(t);if(null!=i.metrics){if("update"===e)for(var s=a.getCursor();s.next();)i.metrics.delete(s.id);i.metrics.link(a)}else i.metrics=a}}},{key:"_remove",value:function(e,t){var r,n=(null!==(r=this._renderState.next)&&void 0!==r?r:this._renderState.current).geometry.get(e);t&&t.length&&n&&(n.remove(t),this._removeLabelMetrics(t))}},{key:"_removeLabelMetrics",value:function(e){var t,r=(null!==(t=this._renderState.next)&&void 0!==t?t:this._renderState.current).metrics;if(null!=r&&e.length){var n,i=(0,f.Z)(e);try{for(i.s();!(n=i.n()).done;)for(var a=n.value;r.delete(a););}catch(s){i.e(s)}finally{i.f()}}}},{key:"_dropPatches",value:function(){for(var e=this,t=new Array,r=!1;this._patches.size;){var n=this._patches.dequeue();if(null==n)break;if(n.clear){if(r)break;r=!0}t.push(n)}this._patches.clear(),t.forEach((function(t){return e._patches.enqueue(t)}))}}]),r}(re.o),_e=r(65760),me=r(98290),be=r(62272),ke=r(39383),we=(0,v.Z)("featurelayer-order-by-server-enabled"),xe=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(e,n,i,a){var u;return(0,s.Z)(this,r),(u=t.call(this,e))._hitTestsRequests=[],u._layer=i,u._layerView=n,u._onUpdate=a,u}return(0,u.Z)(r,[{key:"renderChildren",value:function(e){this.attributeView.update(),this.hasAnimation&&e.painter.effects.integrate.draw(e,e.attributeView),(0,Y.Z)((0,X.Z)(r.prototype),"renderChildren",this).call(this,e)}},{key:"hasEmptyAttributeView",value:function(){return this.attributeView.isEmpty()}},{key:"isUpdating",value:function(){return this.attributeView.isUpdating()}},{key:"hitTest",value:function(e){var t=this._hitTestsRequests.find((function(t){var r=t.x,n=t.y;return r===e.x&&n===e.y})),r=(0,R.hh)();return t?t.resolvers.push(r):(t={x:e.x,y:e.y,resolvers:[r]},this._hitTestsRequests.push(t)),this.requestRender(),r.promise}},{key:"onTileData",value:function(e,t){var r=we&&"orderBy"in this._layer&&this._layer.orderBy,n=r&&(null===r||void 0===r?void 0:r.length)&&!r[0].valueExpression&&r[0].field,i=!!r&&this._layerView.orderByFields===n;e.patch(t,i),this.contains(e)||this.addChild(e),this.requestRender()}},{key:"onTileError",value:function(e){this.contains(e)||this.addChild(e)}},{key:"updateTransitionProperties",value:function(e,t){(0,Y.Z)((0,X.Z)(r.prototype),"updateTransitionProperties",this).call(this,e,t),this._layerView.featureEffectView.transitionStep(e,t),this._layerView.featureEffectView.transitioning&&this.requestRender()}},{key:"doRender",value:function(e){var t=this._layer.effectiveScaleRange,n=t.minScale,i=t.maxScale,a=e.state.scale;a<=(n||1/0)&&a>=i&&(0,Y.Z)((0,X.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"afterRender",value:function(e){(0,Y.Z)((0,X.Z)(r.prototype),"afterRender",this).call(this,e),this._hitTestsRequests.length&&this.requestRender()}},{key:"onAttributeStoreUpdate",value:function(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this._onUpdate()}},{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"setStencilReference",value:function(e){var t=e.rendererInfo.rendererSchema;if("dot-density"===(null===t||void 0===t?void 0:t.type)&&(null===t||void 0===t?void 0:t.dotSize)>1||"heatmap"===(null===t||void 0===t?void 0:t.type)){var n,i=(0,f.Z)(this.children);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.stencilRef=a.key.level+1}}catch(s){i.e(s)}finally{i.f()}}else(0,Y.Z)((0,X.Z)(r.prototype),"setStencilReference",this).call(this,e)}},{key:"hasLabels",get:function(){if("sublayers"in this._layer)return this._layer.sublayers.some((function(e){var t;return!(null===(t=e.labelingInfo)||void 0===t||!t.length)&&e.labelsVisible}));var e=this._layer.featureReduction,t=e&&"labelingInfo"in e&&e.labelsVisible&&e.labelingInfo&&e.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!t}},{key:"prepareRenderPasses",value:function(e){var t=this,n=(0,Y.Z)((0,X.Z)(r.prototype),"prepareRenderPasses",this).call(this,e),i=e.registerRenderPass({name:"label",brushes:[be.U.label],target:function(){return t.hasLabels?t.children:null},drawPhase:ee.jx.LABEL|ee.jx.LABEL_ALPHA});if((0,v.Z)("featurelayer-force-marker-text-draw-order")){var a=e.registerRenderPass({name:"geometry",brushes:[be.U.fill,be.U.dotDensity,be.U.line,be.U.heatmap,be.U.pieChart],target:function(){return t.children},forceDrawByDisplayOrder:!0,enableDefaultDraw:function(){return!t._layerView.featureEffectView.hasEffects},effects:[{apply:e.effects.outsideEffect,enable:function(){return t._layerView.featureEffectView.hasEffects},args:function(){return t._layerView.featureEffectView.excludedEffects}},{apply:e.effects.insideEffect,enable:function(){return t._layerView.featureEffectView.hasEffects},args:function(){return t._layerView.featureEffectView.includedEffects}},{apply:e.effects.hittest,enable:function(){return!!t._hitTestsRequests.length},args:function(){return t._hitTestsRequests}}]});n.push(a)}else{var s=e.registerRenderPass({name:"geometry",brushes:[be.U.fill,be.U.dotDensity,be.U.line,be.U.marker,be.U.heatmap,be.U.pieChart,be.U.text],target:function(){return t.children},enableDefaultDraw:function(){return!t._layerView.featureEffectView.hasEffects},effects:[{apply:e.effects.outsideEffect,enable:function(){return t._layerView.featureEffectView.hasEffects},args:function(){return t._layerView.featureEffectView.excludedEffects}},{apply:e.effects.insideEffect,enable:function(){return t._layerView.featureEffectView.hasEffects},args:function(){return t._layerView.featureEffectView.includedEffects}},{apply:e.effects.hittest,enable:function(){return!!t._hitTestsRequests.length},args:function(){return t._hitTestsRequests}}]});n.push(s)}var u=e.registerRenderPass({name:"highlight",brushes:[be.U.fill,be.U.dotDensity,be.U.line,be.U.marker,be.U.pieChart,be.U.text],target:function(){return t.children},drawPhase:ee.jx.HIGHLIGHT,enableDefaultDraw:function(){return!1},effects:[{apply:e.effects.highlight,enable:function(){return!!t._layerView.hasHighlight()}}]});return n.push(u),n.push(i),n}}]),r}(ke.T),Ze=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).type="symbol",e}return(0,u.Z)(r,[{key:"install",value:function(e){var t=this,r=new xe(this.tileInfoView,this.layerView,this.layer,(function(){return t.notifyChange("updating")}));this.featuresView=r,e.addChild(r)}},{key:"uninstall",value:function(e){e.removeChild(this.featuresView),this.featuresView=(0,Z.SC)(this.featuresView)}},{key:"fetchResource",value:function(e,t){var r=e.url,n=this.featuresView.stage;try{return n.resourceManager.fetchResource(r,{signal:t.signal})}catch(i){return(0,R.D_)(i)?Promise.resolve({width:0,height:0}):Promise.reject(i)}}},{key:"isUpdating",value:function(){var e,t=(0,Y.Z)((0,X.Z)(r.prototype),"isUpdating",this).call(this),n=!this.featuresView||this.featuresView.isUpdating(),i=null===(e=this.featuresView)||void 0===e?void 0:e.hasEmptyAttributeView(),a=t||n||t&&i;return(0,v.Z)("esri-2d-log-updating")&&console.log("Updating SymbolTileRenderer ".concat(a,"\n  -> updatingTiles ").concat(t,"\n  -> hasFeaturesView ").concat(!!this.featuresView,"\n  -> updatingFeaturesView ").concat(n)),a}},{key:"hitTest",value:function(e){return this.featuresView.hitTest(e)}},{key:"supportsRenderer",value:function(e){return null!=e&&["simple","class-breaks","unique-value","dot-density","dictionary","heatmap","pie-chart"].includes(e.type)}},{key:"onConfigUpdate",value:function(e){var t=null;if(e&&"visualVariables"in e){var r=((0,_e.aR)(e).visualVariables||[]).map((function(e){var t=e.clone();return"normalizationField"in e&&(t.normalizationField=null),e.valueExpression&&"$view.scale"!==e.valueExpression&&(t.valueExpression=null,t.field="nop"),t}));t=(0,me.I)(r)}this.featuresView.setRendererInfo(e,t,this.layerView.featureEffect)}},{key:"onTileData",value:function(e){var t=this.tiles.get(e.tileKey);t&&e.data&&this.featuresView.onTileData(t,e.data),this.layerView.view.labelManager.requestUpdate()}},{key:"onTileError",value:function(e){var t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileError(t)}},{key:"forceAttributeTextureUpload",value:function(){this.featuresView.attributeView.forceTextureUpload()}},{key:"lockGPUUploads",value:function(){this.featuresView.attributeView.lockTextureUpload(),this.tiles.forEach((function(e){return e.lock()}))}},{key:"unlockGPUUploads",value:function(){this.featuresView.attributeView.unlockTextureUpload(),this.tiles.forEach((function(e){return e.unlock()}))}},{key:"getMaterialItems",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.featuresView.getMaterialItems(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"invalidateLabels",value:function(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()}},{key:"createTile",value:function(e){var t=this,r=this.tileInfoView.getTileBounds((0,K.Ue)(),e),n=this.tileInfoView.getTileResolution(e.level),i=this.featuresView.attributeView;return new ge(e,n,r[0],r[3],i,(function(){return t.layerView.view.labelManager.requestUpdate()}))}},{key:"disposeTile",value:function(e){this.featuresView.removeChild(e),e.destroy(),this.layerView.view.labelManager.requestUpdate()}}]),r}(G);Ze=(0,h._)([(0,g.j)("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],Ze);var Re=r(20478),Se=r(38164);function Ce(e){return e.some((function(e){return e.globalId}))}function Ee(e){return e.filter((function(e){return!e.error})).map((function(e){var t;return null!==(t=e.objectId)&&void 0!==t?t:e.globalId})).filter((function(e){return null!=e}))}function Ie(e,t){var r,n=new Set(e),i=(0,f.Z)(t.values());try{for(i.s();!(r=i.n()).done;){var a=r.value;n.add(a)}}catch(s){i.e(s)}finally{i.f()}return n}function Te(e,t){var r,n=new Set(e),i=(0,f.Z)(t.values());try{for(i.s();!(r=i.n()).done;){var a=r.value;n.delete(a)}}catch(s){i.e(s)}finally{i.f()}return n}var Ve=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e))._hasGlobalIds=!1,n._notifyUpdating=function(){n.notifyChange("updating")},n}return(0,u.Z)(r,[{key:"normalizeCtorArgs",value:function(e){return this._queueProcessor=new Se.e({concurrency:1,process:e.process}),{}}},{key:"destroy",value:function(){this.clear()}},{key:"updating",get:function(){return this._queueProcessor.length>0}},{key:"clear",value:function(){this._queueProcessor.clear()}},{key:"push",value:function(e){var t=this._queueProcessor,r=t.last();switch(e.type){case"update":case"refresh":if((null===r||void 0===r?void 0:r.type)===e.type)return;t.push(e).then(this._notifyUpdating,this._notifyUpdating);break;case"edit":var n="processed-edit"===(null===r||void 0===r?void 0:r.type)?r:null;n&&t.popLast();var i,a=this._mergeEdits(n,e),s=(0,f.Z)(a);try{for(s.s();!(i=s.n()).done;){var u=i.value;u&&t.push(u).then(this._notifyUpdating,this._notifyUpdating)}}catch(o){s.e(o)}finally{s.f()}}this.notifyChange("updating")}},{key:"_mergeEdits",value:function(e,t){var r,n,i=t.edits,a=i.addedFeatures,s=i.deletedFeatures,u=i.updatedFeatures;if(this._hasGlobalIds=this._hasGlobalIds||Ce(a)||Ce(u)||Ce(s),this._hasGlobalIds)return[e,{type:"processed-edit",edits:{addOrModified:[].concat((0,c.Z)(a),(0,c.Z)(u)),removed:s}}];var o=new Set(Ee(null!==(r=null===e||void 0===e?void 0:e.edits.addOrModified)&&void 0!==r?r:[])),l=new Set(Ee(null!==(n=null===e||void 0===e?void 0:e.edits.removed)&&void 0!==n?n:[])),f=new Set([].concat((0,c.Z)(Ee(a)),(0,c.Z)(Ee(u)))),h=new Set(Ee(s));return[{type:"processed-edit",edits:{addOrModified:Array.from(Ie(Te(o,h),f)).map((function(e){return{objectId:e}})),removed:Array.from(Ie(Te(l,f),h)).map((function(e){return{objectId:e}}))}}]}}]),r}(E.Z);(0,h._)([(0,p.Cb)({readOnly:!0})],Ve.prototype,"updating",null),(0,h._)([(0,p.Cb)()],Ve.prototype,"process",void 0);var Fe=Ve=(0,h._)([(0,g.j)("esri.views.2d.layers.support.FeatureCommandQueue")],Ve),qe=r(67426),Ue=r(31009);function Oe(e){return Array.isArray(e)}var Ae=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e))._startupResolver=(0,R.hh)(),n.isReady=!1,n}return(0,u.Z)(r,[{key:"initialize",value:function(){this._controller=new AbortController,this.addResolvingPromise(this._startWorker(this._controller.signal))}},{key:"destroy",value:function(){this._controller.abort(),this._connection&&this._connection.close()}},{key:"tileRenderer",set:function(e){this.client.tileRenderer=e}},{key:"closed",get:function(){return this._connection.closed}},{key:"startup",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a){var s,u,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.when();case 2:return s=this._controller.signal,u=Oe(n.source)?{transferList:n.source,signal:s}:void 0,o={service:n,config:r,tileInfo:t.tileInfo.toJSON(),tiles:a},e.next=5,this._connection.invoke("startup",o,u);case 5:this._startupResolver.resolve(),this._set("isReady",!0);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"updateTiles",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",(0,R.R8)(this._connection.invoke("updateTiles",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={config:t},e.next=3,this._startupResolver.promise;case 3:return e.abrupt("return",this._connection.invoke("update",r));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"applyUpdate",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("applyUpdate",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setHighlight",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",(0,R.R8)(this._connection.invoke("controller.setHighlight",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stop",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:if(this.closed){e.next=4;break}return e.abrupt("return",(0,R.R8)(this._connection.invoke("stop")));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",(0,R.R8)(this._connection.invoke("controller.refresh",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"querySummaryStatistics",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.querySummaryStatistics",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateSummaryStatistics",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryAggregateSummaryStatistics",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryUniqueValues",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryUniqueValues",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateUniqueValues",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryAggregateUniqueValues",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryClassBreaks",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryClassBreaks",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateClassBreaks",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryAggregateClassBreaks",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryHistogram",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryHistogram",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateHistogram",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryAggregateHistogram",{query:t.toJSON(),params:r},n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatures",null===t||void 0===t?void 0:t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryVisibleFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryVisibleFeatures",null===t||void 0===t?void 0:t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryObjectIds",null===t||void 0===t?void 0:t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryFeatureCount",null===t||void 0===t?void 0:t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._connection.invoke("controller.queryExtent",t.toJSON(),r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryLatestObservations",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryLatestObservations",t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryStatistics",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryStatistics",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryAggregates",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryAggregates",null===t||void 0===t?void 0:t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryAggregateCount",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryAggregateCount",null===t||void 0===t?void 0:t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryAggregateIds",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.queryAggregateIds",null===t||void 0===t?void 0:t.toJSON(),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getObjectId",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getObjectId",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDisplayId",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getDisplayId",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getFeatures",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAggregates",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregates"));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAggregateValueRanges",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.getAggregateValueRanges"));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"mapValidDisplayIds",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",this._connection.invoke("controller.mapValidDisplayIds",t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEdits",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",(0,R.R8)(this._connection.invoke("controller.onEdits",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enableEvent",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",(0,R.R8)(this._connection.invoke("controller.enableEvent",{name:t,value:r})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"pauseStream",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",(0,R.R8)(this._connection.invoke("controller.pauseStream")));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resumeStream",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",(0,R.R8)(this._connection.invoke("controller.resumeStream")));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessageToSocket",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",(0,R.R8)(this._connection.invoke("controller.sendMessageToSocket",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMessageToClient",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",(0,R.R8)(this._connection.invoke("controller.sendMessageToClient",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateCustomParameters",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._startupResolver.promise;case 2:return e.abrupt("return",(0,R.R8)(this._connection.invoke("controller.updateCustomParameters",t)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_startWorker",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,Ue.bA)("Pipeline",{client:this.client,strategy:"dedicated",signal:t});case 3:this._connection=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),(0,R.H9)(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(qe.D);(0,h._)([(0,p.Cb)()],Ae.prototype,"isReady",void 0),(0,h._)([(0,p.Cb)({constructOnly:!0})],Ae.prototype,"client",void 0),(0,h._)([(0,p.Cb)()],Ae.prototype,"tileRenderer",null);var Pe=Ae=(0,h._)([(0,g.j)("esri.views.2d.layers.support.FeatureLayerProxy")],Ae),Le=r(31666),ze=r(16889),Be=r(49229),Ne=r(80724),je=Math.PI;function Me(e,t){switch(t.transformationType){case Ne.hL.Additive:return function(e,t){return e+(De(t.minSize,e)||t.minDataValue)}(e,t);case Ne.hL.Constant:return function(e,t){var r=e.stops,n=r&&r.length&&r[0].size;return null==n&&(n=e.minSize),De(n,t)}(t,e);case Ne.hL.ClampedLinear:return function(e,t){var r=t.minDataValue,n=t.maxDataValue,i=(e-r)/(n-r),a=De(t.minSize,e),s=De(t.maxSize,e);return e<=r?a:e>=n?s:a+i*(s-a)}(e,t);case Ne.hL.Proportional:return function(e,t){var r=e/t.minDataValue,n=De(t.minSize,e),i=De(t.maxSize,e),a=null;return a=r*n,(0,ze.uZ)(a,n,i)}(e,t);case Ne.hL.Stops:return function(e,t){var r=function(e,t){if(!t)return;var r=0,n=t.length-1;return t.some((function(t,i){return e<t?(n=i,!0):(r=i,!1)})),[r,n,(e-t[r])/(t[n]-t[r])]}(e,t.cache.ipData),n=(0,se.Z)(r,3),i=n[0],a=n[1],s=n[2];if(i===a)return De(t.stops[i].size,e);var u=De(t.stops[i].size,e);return u+(De(t.stops[a].size,e)-u)*s}(e,t);case Ne.hL.RealWorldSize:return function(e,t){var r=Be.a[t.valueUnit],n=De(t.minSize,e),i=De(t.maxSize,e),a=t.valueRepresentation,s=null;return s="area"===a?2*Math.sqrt(e/je)/r:"radius"===a||"distance"===a?2*e/r:e/r,(0,ze.uZ)(s,n,i)}(e,t);case Ne.hL.Identity:return e;case Ne.hL.Unknown:return null}}function De(e,t){return"number"==typeof e?e:Me(t,e)}var Je=r(48790),Ge=r(73828),He=function(){function e(t){(0,s.Z)(this,e),this._tiles=new Map,this.buffer=0,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this.buffer=t.buffer}return(0,u.Z)(e,[{key:"destroy",value:function(){}},{key:"clear",value:function(){var e=this;this._tiles.forEach((function(t){return e._releaseTile(t)}))}},{key:"tileKeys",value:function(){var e=[];return this._tiles.forEach((function(t,r){return e.push(r)})),e}},{key:"update",value:function(e){var t,r=this,n=this.tileInfoView.getTileCoverage(e.state,this.buffer,!0,"closest"),i=n.spans,a=n.lodInfo,s=a.level,u=[],o=[],l=new Set,c=new Set,h=(0,f.Z)(i);try{for(h.s();!(t=h.n()).done;)for(var d=t.value,p=d.row,y=d.colFrom,v=d.colTo,g=y;g<=v;g++){var _=Ge.Z.getId(s,p,a.normalizeCol(g),a.getWorldForColumn(g)),m=this._getOrAcquireTile(u,_);l.add(_),m.isReady?m.visible=!0:c.add(m.key)}}catch(b){h.e(b)}finally{h.f()}return c.forEach((function(e){return r._addPlaceholders(l,e)})),this._tiles.forEach((function(e){l.has(e.key.id)||(o.push(e.key.id),r._releaseTile(e))})),Je.Z.pool.release(n),{hasMissingTiles:c.size>0,added:u,removed:o}}},{key:"_getOrAcquireTile",value:function(e,t){if(!this._tiles.has(t)){var r=this.acquireTile(new Ge.Z(t));e.push(t),this._tiles.set(t,r),r.visible=!1}return this._tiles.get(t)}},{key:"_getTile",value:function(e){return this._tiles.get(e)}},{key:"_releaseTile",value:function(e){this._tiles.delete(e.key.id),this.releaseTile(e)}},{key:"_addPlaceholders",value:function(e,t){var r=this._addPlaceholderChildren(e,t);Math.abs(1-r)<1e-6||this._addPlaceholderParent(e,t)||(this._getTile(t.id).visible=!0)}},{key:"_addPlaceholderChildren",value:function(e,t){var r=this,n=0;return this._tiles.forEach((function(i){n+=r._addPlaceholderChild(e,i,t)})),n}},{key:"_addPlaceholderChild",value:function(e,t,r){return t.key.level<=r.level||!t.hasData||!r.contains(t.key)?0:(t.visible=!0,e.add(t.key.id),1/(1<<2*(t.key.level-r.level)))}},{key:"_addPlaceholderParent",value:function(e,t){for(var r=t.getParentKey(),n=0,i=null;null!=r;){if(e.has(r.id))return!0;var a=this._getTile(r.id);if(null!==a&&void 0!==a&&a.isReady){var s,u=(0,f.Z)(e);try{for(u.s();!(s=u.n()).done;){var o=s.value,l=this._getTile(o);l&&r.contains(l.key)&&(l.visible=!1)}}catch(c){u.e(c)}finally{u.f()}return a.visible=!0,e.add(a.key.id),!0}null!==a&&void 0!==a&&a.hasData&&a.patchCount>n&&(n=a.patchCount,i=a),r=r.getParentKey()}return!!i&&(i.visible=!0,e.add(i.key.id),!0)}}]),e}(),Qe=r(45948),Ye=r(83444),Xe=r(37270),Ke=r(87072),We=r(819),$e=r(24405),et="esri.views.layers.FeatureLayerView",tt=x.Z.getLogger(et),rt=r(67581),nt=r(13107),it=r(90316),at=r(53866);function st(e){return e&&"openPorts"in e}function ut(e){return function(t){return(0,C.F2)(Me(t,e))}}var ot=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments))._pipelineIsUpdating=!0,e._commandsQueue=new Fe({process:function(t){switch(t.type){case"processed-edit":return e._doEdit(t);case"refresh":return e._doRefresh(t.dataChanged);case"update":return e._doUpdate()}}}),e._visibilityOverrides=new Set,e._highlightIds=new Map,e._updateHighlight=(0,R.Ds)((0,a.Z)((0,i.Z)().mark((function t(){return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._proxy.setHighlight(Array.from(e._highlightIds.keys())));case 1:case"end":return t.stop()}}),t)})))),e._uploadsLocked=!1,e._needsClusterSizeUpdate=!1,e.featureEffectView=new V,e._lastDefinitionExpression=null,e}return(0,u.Z)(r,[{key:"destroy",value:function(){var e;(0,Z.yw)(this._updateClusterSizeTask,(function(e){return e.remove()})),null!==(e=this._proxy)&&void 0!==e&&e.destroy(),this._commandsQueue.destroy()}},{key:"initialize",value:function(){var e=this;this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.addHandles([this.on("valueRangesChanged",(function(t){e._set("_aggregateValueRanges",t.valueRanges)})),(0,S.YP)((function(){return e.featureEffect}),(function(t){e.featureEffectView.featureEffect=t}),S.tX)],"constructor"),this.featureEffectView.endTransitions()}},{key:"_initProxy",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("isTable"in(r=this.layer))||!r.isTable){e.next=3;break}throw new k.Z("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});case 3:if("feature"!==r.type&&"subtype-group"!==r.type||null!==(t=(0,q.S1)(r))&&void 0!==t&&t.operations.supportsQuery){e.next=5;break}throw new k.Z("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:r});case 5:return this._proxy&&this._proxy.destroy(),n=this._createClientOptions(),e.abrupt("return",(this._set("_proxy",new Pe({client:n})),this._proxy.when()));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initServiceOptions",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._createServiceOptions();case 3:return e.t1=e.sent,e.t0._set.call(e.t0,"_serviceOptions",e.t1),e.abrupt("return",this._serviceOptions);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_effectiveFeatureReduction",get:function(){if(!("featureReduction"in this.layer))return null;var e=this.layer.featureReduction;return e&&(!("maxScale"in e)||!e.maxScale||e.maxScale<this.view.scale)?e:null}},{key:"orderByFields",get:function(){var e,t;return"stream"!==(null===(e=this._serviceOptions)||void 0===e?void 0:e.type)?null===(t=this._serviceOptions)||void 0===t?void 0:t.orderByFields:void 0}},{key:"labelsVisible",get:function(){var e="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&e.some((function(e){return e.labelingInfo&&e.labelsVisible}))}},{key:"labelingCollisionInfos",get:function(){var e=this.tileRenderer,t=this.layer;if(null==e)return null;var r="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer],n=t.geometryType,i=!function(e){var t,r=(0,f.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,i="featureReduction"in n&&n.featureReduction&&"labelingInfo"in n.featureReduction?n.featureReduction:void 0,a=[].concat((0,c.Z)(n.labelingInfo||[]),(0,c.Z)((null===i||void 0===i?void 0:i.labelingInfo)||[]));if(n.labelsVisible&&a.length&&a.some((function(e){return"none"===e.deconflictionStrategy})))return!0}}catch(s){r.e(s)}finally{r.f()}return!1}(r),a={};if("subtype-group"!==t.type){if("heatmap"===(null===e||void 0===e?void 0:e.type))return null;var s=function(e){var t=null!=e&&"visualVariables"in e&&e.visualVariables;if(!t)return null;var r,n=(0,f.Z)(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;if("size"===i.type)return ut(i)}}catch(a){n.e(a)}finally{n.f()}return null}(t.renderer);a[0]=s}return[{tileRenderer:e,vvEvaluators:a,deconflictionEnabled:i,geometryType:n,visible:!this.suspended}]}},{key:"queryMode",get:function(){var e;return null===(e=this._serviceOptions)||void 0===e?void 0:e.type}},{key:"renderingConfigHash",get:function(){var e,t;if(!this.layer)return null;var r=this.availableFields,n=this.layer,i=this.view.floors,a=n.definitionExpression,s="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,u="renderer"in n&&n.renderer,o="gdbVersion"in n?n.gdbVersion:void 0,l="historicMoment"in n?null===(e=n.historicMoment)||void 0===e?void 0:e.getTime():void 0,c=this.timeExtent,f="customParameters"in n?JSON.stringify(n.customParameters):void 0,h="apiKey"in n?n.apiKey:void 0,d="stream"===n.type?"".concat(JSON.stringify(n.geometryDefinition)).concat(n.definitionExpression):null,p=JSON.stringify(this.clips),y=null===(t=this._effectiveFeatureReduction)||void 0===t?void 0:t.toJSON(),v="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),g="sublayers"in this.layer&&this.layer.sublayers.items.reduce((function(e,t){return e+"".concat(t.visible?1:0,".").concat(JSON.stringify(t.renderer),".").concat(t.labelsVisible,"\n.").concat(JSON.stringify(t.labelingInfo))}),""),_="subtypeCode"in this.layer&&this.layer.subtypeCode;return JSON.stringify({orderBy:v,sublayerHash:g,subtypeCode:_,filterHash:null!=this.filter&&this.filter.toJSON(),effectHash:null!=this.featureEffect&&this.featureEffect.toJSON(),streamFilter:d,gdbVersion:o,definitionExpression:a,historicMoment:l,availableFields:r,renderer:u,labelingInfo:s,timeExtent:c,floors:i,clipsHash:p,featureReduction:y,customParameters:f,apiKey:h})}},{key:"highlight",value:function(e){var t,r,n=this;e instanceof d.Z?r=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?r=[e]:b.Z.isCollection(e)&&e.length>0?r=e.map((function(e){return null===e||void 0===e?void 0:e.getObjectId()})).toArray():Array.isArray(e)&&e.length>0&&(r="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((function(e){return null===e||void 0===e?void 0:e.getObjectId()})));var i=null===(t=r)||void 0===t?void 0:t.filter(y.pC);return i&&i.length?(this._addHighlight(i),{remove:function(){return n._removeHighlight(i)}}):{remove:function(){}}}},{key:"hasHighlight",value:function(){return!!this._highlightIds.size}},{key:"hitTest",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,u,o=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tileRenderer){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.tileRenderer.hitTest(r);case 4:if(0!==(n=e.sent).length){e.next=7;break}return e.abrupt("return",null);case 7:return(0,v.Z)("featurelayer-force-marker-text-draw-order")&&n.sort((function(e,t){return e-t})),e.next=10,this._proxy.getFeatures(n);case 10:return a=e.sent,s=a.features,u=a.aggregates,e.abrupt("return",[].concat((0,c.Z)(u.map((function(e){return o._createGraphicHit(t,m.fromJSON(e))}))),(0,c.Z)(s.map((function(e){return o._createGraphicHit(t,d.Z.fromJSON(e))})))));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryStatistics",value:function(){return this._proxy.queryStatistics()}},{key:"querySummaryStatistics",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,n.Z)((0,n.Z)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.querySummaryStatistics(this._cleanUpQuery(t),s,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateSummaryStatistics",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,n.Z)((0,n.Z)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.queryAggregateSummaryStatistics(this._cleanUpAggregateQuery(t),s,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryUniqueValues",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,n.Z)((0,n.Z)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.queryUniqueValues(this._cleanUpQuery(t),s,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateUniqueValues",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,n.Z)((0,n.Z)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.queryAggregateUniqueValues(this._cleanUpAggregateQuery(t),s,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryClassBreaks",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,n.Z)((0,n.Z)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.queryClassBreaks(this._cleanUpQuery(t),s,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateClassBreaks",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,n.Z)((0,n.Z)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.queryAggregateClassBreaks(this._cleanUpAggregateQuery(t),s,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryHistogram",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,n.Z)((0,n.Z)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.queryHistogram(this._cleanUpQuery(t),s,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateHistogram",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,n.Z)((0,n.Z)({},r),{},{scale:this.view.scale}),e.abrupt("return",this._proxy.queryAggregateHistogram(this._cleanUpAggregateQuery(t),s,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(e,t){var r=this;return this.queryFeaturesJSON(e,t).then((function(e){var t=O.Z.fromJSON(e);return t.features.forEach((function(e){return r._setLayersForFeature(e)})),t}))}},{key:"queryVisibleFeatures",value:function(e,t){var r=this;return this._proxy.queryVisibleFeatures(this._cleanUpQuery(e),t).then((function(e){var t=O.Z.fromJSON(e);return t.features.forEach((function(e){return r._setLayersForFeature(e)})),t}))}},{key:"queryAggregates",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._proxy.queryAggregates(this._cleanUpAggregateQuery(t),r);case 2:return n=e.sent,a=L.fromJSON(n),e.abrupt("return",(a.features.forEach((function(e){return s._setLayersForFeature(e)})),a));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryAggregateIds",value:function(e,t){return this._proxy.queryAggregateIds(this._cleanUpAggregateQuery(e),t)}},{key:"queryAggregateCount",value:function(e,t){return this._proxy.queryAggregateCount(this._cleanUpAggregateQuery(e),t)}},{key:"queryAggregateJSON",value:function(e,t){return this._proxy.queryAggregates(this._cleanUpAggregateQuery(e),t)}},{key:"queryFeaturesJSON",value:function(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}},{key:"queryObjectIds",value:function(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}},{key:"queryFeatureCount",value:function(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}},{key:"queryExtent",value:function(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((function(e){return{count:e.count,extent:at.Z.fromJSON(e.extent)}}))}},{key:"setVisibility",value:function(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}},{key:"update",value:function(e){if(this._tileStrategy&&this.tileRenderer){var t=this._tileStrategy.update(e),r=t.hasMissingTiles,n=t.added,i=t.removed;(n.length||i.length)&&this._proxy.updateTiles({added:n,removed:i}),r&&this.requestUpdate(),this.notifyChange("updating")}}},{key:"attach",value:function(){var e=this;this.view.timeline.record("".concat(this.layer.title," (FeatureLayer) Attach")),this._tileStrategy=new He({acquireTile:function(t){return e._acquireTile(t)},releaseTile:function(t){return e._releaseTile(t)},tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.addAttachHandles((0,S.YP)((function(){return e.renderingConfigHash}),(function(){return e._update()}),S.nn)),"stream"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",(function(t){return e._edit(t)})))}},{key:"detach",value:function(){var e,t;this._commandsQueue.clear(),null!==(e=this._proxy)&&void 0!==e&&e.stop(),this.container.removeAllChildren(),null!==(t=this.tileRenderer)&&void 0!==t&&t.uninstall(this.container),this.tileRenderer=null,this._tileStrategy=(0,Z.SC)(this._tileStrategy),this._tileRendererHash=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"isUpdating",value:function(){var e,t="renderer"in this.layer&&null!=this.layer.renderer,r=this._commandsQueue.updating,n=null!=this._updatingRequiredFieldsPromise,i=!this._proxy||!this._proxy.isReady,a=this._pipelineIsUpdating,s=null==this.tileRenderer||(null===(e=this.tileRenderer)||void 0===e?void 0:e.updating),u=t&&(r||n||i||a||s);return(0,v.Z)("esri-2d-log-updating")&&console.log("Updating FLV2D (".concat(this.layer.id,"): ").concat(u,"\n  -> hasRenderer ").concat(t,"\n  -> hasPendingCommand ").concat(r,"\n  -> updatingRequiredFields ").concat(n,"\n  -> updatingProxy ").concat(i,"\n  -> updatingPipeline ").concat(a,"\n  -> updatingTileRenderer ").concat(s,"\n")),u}},{key:"_createClientOptions",value:function(){var e=this;return{setUpdating:function(t){e._set("_pipelineIsUpdating",t)},emitEvent:function(t){e.emit(t.name,t.event)}}}},{key:"_detectQueryMode",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,u,o,l,c,f,h,d,p,y,g,_;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="path"in t,a=this.layer,s="editingInfo"in a&&(null===(r=a.editingInfo)||void 0===r?void 0:r.lastEditDate),u="refreshInterval"in a&&!!a.refreshInterval,o=!s&&u,l=(0,q.S1)(a),!n||"feature"!==a.type&&"subtype-group"!==a.type||"point"!==a.geometryType||null===l||void 0===l||!l.query.supportsPagination||null!==l&&void 0!==l&&l.operations.supportsEditing||o||!(0,v.Z)("featurelayer-snapshot-enabled")){e.next=16;break}return e.prev=2,e.next=5,a.queryFeatureCount();case 5:if(!((c=e.sent)<=(0,v.Z)("featurelayer-snapshot-point-min-threshold"))){e.next=8;break}return e.abrupt("return",{mode:"snapshot",featureCount:c});case 8:if(f=(0,v.Z)("featurelayer-snapshot-point-max-threshold"),h=(0,v.Z)("featurelayer-snapshot-point-coverage"),d=this.view.extent,p=a.fullExtent,y=null===p||void 0===p?void 0:p.clone().intersection(d),g=null!=y?y.width*y.height:0,_=(null===p||void 0===p?void 0:p.width)*(null===p||void 0===p?void 0:p.height),!(c<=f&&(0===_?0:g/_)>=h)){e.next=11;break}return e.abrupt("return",{mode:"snapshot",featureCount:c});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),x.Z.getLogger(this).warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:e.t0});case 16:return e.abrupt("return",{mode:"on-demand"});case 17:case"end":return e.stop()}}),e,this,[[2,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_createServiceOptions",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,a,s,u,o,l,c,f,h,d,p,y,v,g,_,m,b,k,x,Z;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"!==(s=this.layer).type){e.next=3;break}return e.abrupt("return",null);case 3:if(u=(0,q.S1)(s),o=s.capabilities,l=s.objectIdField,c=s.fields.map((function(e){return e.toJSON()})),f=null!=s.fullExtent?s.fullExtent.toJSON():null,h=(0,Le.oq)(s.geometryType),d="timeInfo"in s&&s.timeInfo&&s.timeInfo.toJSON()||null,p=s.spatialReference?s.spatialReference.toJSON():null,y="feature"===s.type?s.globalIdField:null,"ogc-feature"!==s.type){e.next=8;break}v=s.source.getSource(),e.next=15;break;case 8:if(!st(s.source)){e.next=14;break}return e.next=11,s.source.openPorts();case 11:v=e.sent,e.next=15;break;case 14:s.parsedUrl&&(v=(0,w.d9)(s.parsedUrl),"dynamicDataSource"in s&&s.dynamicDataSource&&(v.query={layer:JSON.stringify({source:s.dynamicDataSource})}));case 15:return g="datesInUnknownTimezone"in this.layer&&this.layer.datesInUnknownTimezone,_=null!==(t="subtypeField"in this.layer?this.layer.subtypeField:null)&&void 0!==t?t:null,e.next=19,this._detectQueryMode(v);case 19:return m=e.sent,b=m.mode,k=m.featureCount,x=this.layer.objectIdField,"feature"===this.layer.type&&null!=this.layer.orderBy&&this.layer.orderBy.length&&(Z=!this.layer.orderBy[0].valueExpression&&this.layer.orderBy[0].field)&&(x=Z),e.abrupt("return",{type:b,timeReferenceUnknownClient:g,subtypeField:_,featureCount:k,globalIdField:y,maxRecordCount:o.query.maxRecordCount,tileMaxRecordCount:o.query.tileMaxRecordCount,capabilities:o,effectiveCapabilities:u,fields:c,fullExtent:f,geometryType:h,objectIdField:l,source:v,timeInfo:d,spatialReference:p,orderByFields:x,datesInUnknownTimezone:g,dateFieldsTimeReference:("dateFieldsTimeReference"in this.layer?null===(r=this.layer.dateFieldsTimeReference)||void 0===r?void 0:r.toJSON():null)||null,preferredTimeReference:("preferredTimeReference"in this.layer?null===(n=this.layer.preferredTimeReference)||void 0===n?void 0:n.toJSON():null)||null,editFieldsInfo:"editFieldsInfo"in this.layer?null===(a=this.layer.editFieldsInfo)||void 0===a?void 0:a.toJSON():null});case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createMemoryServiceOptions",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.openPorts();case 2:return r=e.sent,e.abrupt("return",(0,n.Z)((0,n.Z)({},this._createServiceOptions()),{},{type:"memory",source:r}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_cleanUpQuery",value:function(e){var t=z.Z.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}},{key:"_cleanUpAggregateQuery",value:function(e){var t=z.Z.from(e)||this.createAggregateQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}},{key:"_update",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._commandsQueue.push({type:"update"}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_edit",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.suspended){e.next=2;break}return e.abrupt("return",void this._clearTiles());case 2:return e.abrupt("return",this._validateEdit(t)?this._commandsQueue.push({type:"edit",edits:t}):void 0);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"doRefresh",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.attached||!this._tileStrategy.tileKeys().length){e.next=2;break}return e.abrupt("return",this.suspended&&t?void this._clearTiles():this._commandsQueue.push({type:"refresh",dataChanged:t}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_clearTiles",value:function(){this._tileStrategy.tileKeys().length&&(this._proxy.updateTiles({added:[],removed:this._tileStrategy.tileKeys()}),this._tileStrategy.clear(),this.requestUpdate(),this._commandsQueue.clear(),this._update())}},{key:"_validateEdit",value:function(e){var t="globalIdField"in this.layer&&this.layer.globalIdField,r=e.deletedFeatures.some((function(e){return-1===e.objectId||!e.objectId})),n=t&&this.availableFields.includes(t);return r&&!n?(x.Z.getLogger(this).error(new k.Z("mapview-apply-edits","Editing the specified service requires the layer's globalIdField, ".concat(t," to be included the layer's outFields for updates to be reflected on the map"))),null):e}},{key:"_doUpdate",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,a,s,u,o,l,c,f,h,d,p,y,g;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.destroyed&&this._hasRequiredSupport(this.layer)&&this._tileStrategy){e.next=3;break}return e.abrupt("return");case 3:return t=this.featureEffectView,r=this.filter,e.next=6,this._updateRequiredFields();case 6:if(!this.destroyed){e.next=8;break}return e.abrupt("return");case 8:if(n=this._getEffectiveRenderer(),a=n.renderer,this._set("_effectiveRenderer",a),s=this._createSchemaConfig(),u=this._createConfiguration(s,r,t.filter),o=this._lastDefinitionExpression!==u.schema.source.definitionExpression,this._lastDefinitionExpression=u.schema.source.definitionExpression,l=u.schema.tileRenderer,c=this._createTileRendererHash(l),"snapshot"===this._serviceOptions.type&&(u.schema.source.initialFeatureCount=this._serviceOptions.featureCount),c===this._tileRendererHash){e.next=46;break}if(this._initTileRenderer(l,a),"stream"!==(f=this.layer).type){e.next=22;break}return e.next=19,this._initServiceOptions();case 19:e.t0=e.sent,e.next=23;break;case 22:e.t0=this._serviceOptions;case 23:if(h=e.t0,this.tileRenderer.onConfigUpdate(a),e.t1="stream"!==f.type&&st(f.source),!e.t1){e.next=30;break}return e.next=29,f.source.openPorts();case 29:h.source=e.sent;case 30:return d={added:this._tileStrategy.tileKeys(),removed:[]},(0,v.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Proxy startup"),e.next=34,this._proxy.startup(this.view.featuresTilingScheme,u,h,d);case 34:if((0,v.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished proxy startup"),e.t2=this.hasHighlight(),!e.t2){e.next=41;break}return(0,v.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Updating highlight"),e.next=40,this._proxy.setHighlight(Array.from(this._highlightIds.keys()));case 40:(0,v.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished highlight update");case 41:(0,v.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: onConfigUpdate start"),this.tileRenderer.onConfigUpdate(a),(0,v.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: onConfigUpdate end"),e.next=67;break;case 46:if(e.t3="snapshot"===this._serviceOptions.type&&o,!e.t3){e.next=51;break}return e.next=50,this.layer.queryFeatureCount();case 50:u.schema.source.changedFeatureCount=e.sent;case 51:return(0,v.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Updating proxy"),e.next=54,this._proxy.update(u);case 54:return g=e.sent,(0,v.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished proxy update"),(g.mesh||(null===(p=g.targets)||void 0===p?void 0:p.aggregate))&&((0,v.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Locking GPU Uploads"),this._lockGPUUploads()),e.prev=56,(0,v.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Applying update to proxy"),e.next=60,this._proxy.applyUpdate(g);case 60:(0,v.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D: Finished applying update to proxy"),e.next=66;break;case 63:e.prev=63,e.t4=e.catch(56),(0,R.D_)(e.t4)||x.Z.getLogger(this).error(e.t4);case 66:(g.mesh||null!==(y=g.targets)&&void 0!==y&&y.aggregate)&&this._unlockGPUUploads(),this.tileRenderer.onConfigUpdate(a),this._updateClusterSizeVariable(),this._forceAttributeTextureUpload();case 67:this._tileRendererHash=c,this.tileRenderer.invalidateLabels(),this.requestUpdate(),e.next=72;break;case 70:e.prev=70,e.t5=e.catch(0);case 72:case"end":return e.stop()}}),e,this,[[0,70],[56,63]])})));return function(){return e.apply(this,arguments)}}()},{key:"_doEdit",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._proxy.onEdits(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,R.D_)(e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_doRefresh",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._lockGPUUploads(),e.prev=1,e.t0=t&&"snapshot"===this.queryMode&&"queryFeatureCount"in this.layer,!e.t0){e.next=7;break}return e.next=6,this.layer.queryFeatureCount();case 6:r=e.sent;case 7:return e.next=9,this._proxy.refresh({dataChanged:t,featureCount:r});case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(1),(0,R.D_)(e.t1);case 14:this._unlockGPUUploads(),this._effectiveFeatureReduction&&this._updateClusterSizeVariable();case 15:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateClusterSizeVariable",value:function(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}},{key:"_createUpdateClusterSizeTask",value:function(e,t){var r=this;return(0,S.YP)((function(){return r._aggregateValueRanges}),(function(n){r._updateClusterEffectiveRendererSizeVariable(e,t,n),r._needsClusterSizeUpdate=!0,r._uploadsLocked||r._updateClusterSizeVariable()}))}},{key:"_updateClusterEffectiveRendererSizeVariable",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.dynamicClusterSize&&"visualVariables"in t&&t.visualVariables&&null!=(a=(0,Re.os)(t.visualVariables))&&"cluster_count"===a.field&&(s=t.visualVariables.indexOf(a),t.visualVariables[s]=(0,Re.aV)(r,n),(u=t.clone()).dynamicClusterSize=!0,this._set("_effectiveRenderer",u));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_getEffectiveRenderer",value:function(){var e,t=this.layer,r="renderer"in t?t.renderer:null,n=this._effectiveFeatureReduction;if(this._updateClusterSizeTask=(0,Z.hw)(this._updateClusterSizeTask),n&&"renderer"in n&&n.renderer&&(null===(e=n.renderer.authoringInfo)||void 0===e||!e.isAutoGenerated)){var i=n.fields;if("cluster"===n.type){var a=(0,Re.st)(n.renderer,n,this._aggregateValueRanges),s=a.renderer;return a.didInject&&(this._updateClusterSizeTask=this._createUpdateClusterSizeTask(s,n)),{renderer:s,aggregateFields:i,featureReduction:n}}return{renderer:n.renderer,aggregateFields:i,featureReduction:n}}if(n&&"cluster"===n.type&&r&&(0,Re.yR)(r)){var u=n,o=[],l=(0,Re.S1)(o,r,u,this._aggregateValueRanges,!0);return this._updateClusterSizeTask=this._createUpdateClusterSizeTask(l,u),{renderer:l,aggregateFields:o,featureReduction:n}}return{renderer:r,aggregateFields:[],featureReduction:null}}},{key:"_acquireTile",value:function(e){var t=this,r=this.tileRenderer.acquireTile(e);return r.once("attach",(function(){t.requestUpdate()})),r}},{key:"_releaseTile",value:function(e){this.tileRenderer.releaseTile(e)}},{key:"_initTileRenderer",value:function(e,t){var r=function(e,t){if(!e)return null;switch(e.type){case"symbol":return new Ze(t);case"heatmap":return new Q(t)}}(e,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});return this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer=(0,Z.SC)(this.tileRenderer)),this.destroyed?null:(this._proxy.tileRenderer=r,this._set("tileRenderer",r),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(t),this.requestUpdate(),this.tileRenderer)}},{key:"_createTileRendererHash",value:function(e){return"".concat(e.type)}},{key:"hasFilter",get:function(){var e=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||e||!!this._visibilityOverrides.size||!!this.timeExtent}},{key:"_injectOverrides",value:function(e){var t=null!=e?e.timeExtent:null,r=null!=this.timeExtent&&null!=t?this.timeExtent.intersection(t):this.timeExtent||t,n=null,i="floorInfo"in this.layer&&this.layer.floorInfo;if(i){var a=null!=e?e.where:null;n=this._addFloorFilterClause(a)}if(!this._visibilityOverrides.size&&!r&&!i)return null!=e?e.toJSON():null;(e=null!=e&&e.clone()||new F.Z).timeExtent=r,n&&(e.where=n);var s=e.toJSON();return s.hiddenIds=Array.from(this._visibilityOverrides),s}},{key:"_addFloorFilterClause",value:function(e){var t=this.layer,r=e||"";if("floorInfo"in t&&t.floorInfo){var n,i=this.view.floors;if(!i||!i.length)return r;(null===(n=t.floorInfo.viewAllLevelIds)||void 0===n?void 0:n.length)&&(i=t.floorInfo.viewAllLevelIds);var a=i.filter((function(e){return""!==e})).map((function(e){return"'"+e+"'"}));a.push("''");var s=t.floorInfo.floorField,u="("+s+" IN ({ids}) OR "+s+" IS NULL)";if(u=u.replace("{ids}",a.join(", ")),null!=r&&r.includes(s)){var o=new RegExp("AND \\("+s+".*NULL\\)","g");r=r.replace(o,""),o=new RegExp("\\("+s+".*NULL\\)","g"),r=(r=r.replace(o,"")).replaceAll(/\s+/g," ").trim()}r=""!==r?"("+r+") AND "+u:u}return""!==r?r:null}},{key:"_createConfiguration",value:function(e,t,r){var n,i="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,a="feature"===this.layer.type&&null!==(n=this.layer.gdbVersion)&&void 0!==n?n:void 0,s=new Array(B.m4),u=this._injectOverrides(t);s[0]=u,s[1]=null!=r?r.toJSON():null;var o=(0,j.Ew)(e);if(null==o)return null;var l=(0,it.hc)("2d");return{availableFields:this.availableFields,gdbVersion:a,historicMoment:i,devicePixelRatio:window.devicePixelRatio||1,filters:s,schema:o,supportsTextureFloat:l.supportsTextureFloat,maxTextureSize:l.maxTextureSize}}},{key:"_hasRequiredSupport",value:function(e){return!("renderer"in e)||(0,_e.TT)(e.renderer)}},{key:"_lockGPUUploads",value:function(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())}},{key:"_unlockGPUUploads",value:function(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}},{key:"_forceAttributeTextureUpload",value:function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}},{key:"_createSchemaConfig",value:function(){var e,t=this.layer;return{renderer:"renderer"in t?t.renderer:null,spatialReference:t.spatialReference,timeExtent:"timeExtent"in t?t.timeExtent:null,definitionExpression:t.definitionExpression,featureReduction:this._effectiveFeatureReduction,fields:t.fields,geometryType:t.geometryType,historicMoment:"historicMoment"in t?t.historicMoment:null,labelsVisible:"labelsVisible"in t&&t.labelsVisible,labelingInfo:"labelingInfo"in t?t.labelingInfo:null,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:"gdbVersion"in t?t.gdbVersion:null,pixelBuffer:0,orderBy:"orderBy"in t&&t.orderBy?t.orderBy:null,customParameters:(0,n.Z)((0,n.Z)({},"customParameters"in t?t.customParameters:void 0),{},{token:"apiKey"in t&&null!==(e=t.apiKey)&&void 0!==e?e:void 0}),subtypeCode:"subtypeCode"in t?t.subtypeCode:void 0,subtypeField:"subtypeField"in t?t.subtypeField:void 0}}},{key:"_addHighlight",value:function(e){var t,r=this,n=(0,f.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(this._highlightIds.has(i)){var a=this._highlightIds.get(i);this._highlightIds.set(i,a+1)}else this._highlightIds.set(i,1)}}catch(s){n.e(s)}finally{n.f()}this._updateHighlight().catch((function(e){(0,R.D_)(e)||x.Z.getLogger(r).error(e)}))}},{key:"_removeHighlight",value:function(e){var t,r=this,n=(0,f.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(this._highlightIds.has(i)){var a=this._highlightIds.get(i)-1;0===a?this._highlightIds.delete(i):this._highlightIds.set(i,a)}}}catch(s){n.e(s)}finally{n.f()}this._updateHighlight().catch((function(e){(0,R.D_)(e)||x.Z.getLogger(r).error(e)}))}},{key:"_setLayersForFeature",value:function(e){var t=this.layer;e.layer=t,e.sourceLayer=t}},{key:"_createGraphicHit",value:function(e,t){return this._setLayersForFeature(t),null!=t.geometry&&(t.geometry.spatialReference=this.view.spatialReference),{type:"graphic",graphic:t,layer:this.layer,mapPoint:e}}}]),r}(function(e){var t=function(e){(0,o.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;(0,s.Z)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i)))._updatingRequiredFieldsPromise=null,e.filter=null,e.timeExtent=null,e.layer=null,e.requiredFields=[],e.view=null,e}return(0,u.Z)(r,[{key:"initialize",value:function(){var e=this;this.handles.add([(0,S.YP)((function(){var t,r=e.layer;return[null===r||void 0===r||null===(t=r.elevationInfo)||void 0===t?void 0:t.featureExpressionInfo,r&&"displayField"in r?r.displayField:null,r&&"timeInfo"in r&&r.timeInfo,r&&"renderer"in r&&r.renderer,r&&"labelingInfo"in r&&r.labelingInfo,r&&"floorInfo"in r&&r.floorInfo,e.filter,e.featureEffect,e.timeExtent]}),(function(){return e._handleRequiredFieldsChange()}),S.tX),(0,S.on)((function(){var t;return null===(t=e.view)||void 0===t?void 0:t.floors}),"change",(function(){return e._handleRequiredFieldsChange()})),(0,S.on)((function(){var t=e.layer;return t&&"sublayers"in t?t.sublayers:null}),"change",(function(){return e._handleRequiredFieldsChange()}))])}},{key:"availableFields",get:function(){var e=this.layer,t=this.layer.fieldsIndex,r=this.requiredFields;return"outFields"in e&&e.outFields?(0,Xe.Q0)(t,[].concat((0,c.Z)((0,Xe.Lk)(t,e.outFields)),(0,c.Z)(r))):(0,Xe.Q0)(t,r)}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(e){this._override("featureEffect",e)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(e){tt.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"highlight",value:function(e){throw new Error("missing implementation")}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=null!=this.filter?this.filter.createQuery(e):new z.Z(e);if("feature"===this.layer.type){var r=(0,Ke.c)(this);null!=r&&(t.where=t.where?"(".concat(t.where,") AND (").concat(r,")"):r)}return null!=this.timeExtent&&(t.timeExtent=null!=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}},{key:"createAggregateQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return new z.Z(e)}},{key:"queryFeatures",value:function(e,t){throw new Error("missing implementation")}},{key:"queryObjectIds",value:function(e,t){throw new Error("missing implementation")}},{key:"queryFeatureCount",value:function(e,t){throw new Error("missing implementation")}},{key:"queryExtent",value:function(e,t){throw new Error("missing implementation")}},{key:"fetchPopupFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.validateFetchPopupFeatures(r))){e.next=3;break}throw n;case 3:return e.abrupt("return",this.fetchClientPopupFeatures(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_loadArcadeModules",value:function(e){return e.get("expressionInfos.length")||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type}))?(0,We.LC)():Promise.resolve()}},{key:"_handleRequiredFieldsChange",value:function(){var e=this,t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then((function(){e._updatingRequiredFieldsPromise===t&&e._set("_updatingRequiredFieldsPromise",null)}))}},{key:"_updateRequiredFields",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,a,s,u,o,l,c,h,d,p,y,v,g;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer&&this.view){e.next=2;break}return e.abrupt("return");case 2:return t="3d"===this.view.type,r=this.layer,n=this.layer,a=n.fieldsIndex,s=n.objectIdField,u="renderer"in r&&r.renderer,o="orderBy"in r&&r.orderBy,l="featureReduction"in r?r.featureReduction:null,c=new Set,e.next=13,(0,R.as)([u?u.collectRequiredFields(c,a):null,(0,Xe.Mu)(c,r),t?(0,Xe.vl)(c,r):null,null!=this.filter?(0,Xe.Ll)(c,r,this.filter):null,null!=this.featureEffect?(0,Xe.Ll)(c,r,this.featureEffect.filter):null,l?(0,Xe.ZV)(c,r,l):null,o?(0,Xe.Qj)(c,r,o):null]);case 13:if(h=e.sent,"timeInfo"in r&&r.timeInfo&&this.timeExtent&&(0,Xe.gd)(c,r.fieldsIndex,[r.timeInfo.startField,r.timeInfo.endField]),"feature"===r.type&&(r.floorInfo&&(0,Xe.gd)(c,r.fieldsIndex,[r.floorInfo.floorField]),t&&null!=r.infoFor3D&&(null==r.globalIdField&&tt.error("globalIdField missing on 3DObjectFeatureLayer"),(0,Xe.gd)(c,r.fieldsIndex,[r.globalIdField]))),"subtype-group"!==r.type){e.next=19;break}return(0,Xe.AB)(c,a,r.subtypeField),d=r.sublayers.map((function(e){var t;return Promise.all([null===(t=e.renderer)||void 0===t?void 0:t.collectRequiredFields(c,a),(0,Xe.Mu)(c,e)])})),e.next=19,(0,R.as)(d);case 19:p=(0,f.Z)(h);try{for(p.s();!(y=p.n()).done;)(v=y.value).error&&tt.error(v.error)}catch(i){p.e(i)}finally{p.f()}(0,Xe.AB)(c,a,s),t&&"displayField"in r&&r.displayField&&(0,Xe.AB)(c,a,r.displayField),g=Array.from(c).sort(),this._set("requiredFields",g);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"validateFetchPopupFeatures",value:function(e){var t;if(null==e)return null;var r,n=(0,f.Z)(null!==(t=e.clientGraphics)&&void 0!==t?t:[]);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=i.layer;if("popupEnabled"in a&&!a.popupEnabled)return new k.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:a});if(i.isAggregate){var s="featureReduction"in a?a.featureReduction:null;if(!(s&&"popupTemplate"in s&&s.popupEnabled&&s.popupTemplate))return new k.Z("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:a})}else if("popupTemplate"in a&&!(0,$e.V5)(a,e))return new k.Z("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:a})}}catch(u){n.e(u)}finally{n.f()}}},{key:"fetchClientPopupFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,u,o,l,c,h,d,p,y,v,g,_,m,b;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=null!=t?t.clientGraphics:null)&&0!==r.length){e.next=3;break}return e.abrupt("return",[]);case 3:return n=new Array(r.length),a=new Map,e.next=7,this.createPopupQuery(t);case 7:s=e.sent,u=0;case 9:if(!(u<r.length)){e.next=27;break}if(!(o=r[u]).isAggregate){e.next=14;break}return n[u]=o,e.abrupt("continue",24);case 14:if("popupEnabled"in(l=o.layer)){e.next=17;break}return e.abrupt("continue",24);case 17:if(c=(0,Xe.Lk)(this.layer.fieldsIndex,s.outFields),null!=(h=(0,$e.V5)(l,t))){e.next=20;break}return e.abrupt("continue",24);case 20:return e.next=22,this._loadArcadeModules(h);case 22:(d=e.sent)&&d.arcadeUtils.hasGeometryOperations(h)||!(0,Xe.R9)(c,o)?a.set(o.getObjectId(),{graphic:o,index:u}):n[u]=o;case 24:u++,e.next=9;break;case 27:if("stream"!==this.layer.type&&0!==a.size){e.next=29;break}return e.abrupt("return",n.filter(Boolean));case 29:return s.objectIds=Array.from(a.keys()),e.prev=30,e.next=33,this.layer.queryFeatures(s);case 33:p=e.sent,y=(0,f.Z)(p.features);try{for(y.s();!(v=y.n()).done;)g=v.value,_=a.get(g.getObjectId()),m=_.graphic.geometry,b=_.index,g.geometry||(g.geometry=m),n[b]=g}catch(i){y.e(i)}finally{y.f()}e.next=40;break;case 38:e.prev=38,e.t0=e.catch(30);case 40:return e.abrupt("return",n.filter(Boolean));case 41:case"end":return e.stop()}}),e,this,[[30,38]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createPopupQuery",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,u,o,l,c,h,d,p,y,v,g,_;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.layer.createQuery(),n=new Set,a=!1,s=null!=t&&t.clientGraphics?t.clientGraphics.map((function(e){return e.layer})):[this.layer],u=(0,f.Z)(s),e.prev=4,u.s();case 6:if((o=u.n()).done){e.next=25;break}if("popupEnabled"in(l=o.value)){e.next=10;break}return e.abrupt("continue",23);case 10:if(null!=(c=(0,$e.V5)(l,t))){e.next=13;break}return e.abrupt("continue",23);case 13:return e.next=15,this._loadArcadeModules(c);case 15:return h=e.sent,d=h&&h.arcadeUtils.hasGeometryOperations(c),a=!("point"!==this.layer.geometryType&&!d),e.next=20,(0,$e.e7)(this.layer,c);case 20:p=e.sent,y=(0,f.Z)(p);try{for(y.s();!(v=y.n()).done;)g=v.value,n.add(g)}catch(i){y.e(i)}finally{y.f()}case 23:e.next=6;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(4),u.e(e.t0);case 30:return e.prev=30,u.f(),e.finish(30);case 33:return r.returnGeometry=a,r.returnZ=a,r.returnM=a,r.outFields=Array.from(n),r.outSpatialReference=this.view.spatialReference,"feature"===this.layer.type&&null!=(_=(0,Ke.c)(this))&&(r.where=r.where?"(".concat(r.where,") AND (").concat(_,")"):_),e.abrupt("return",r);case 35:case"end":return e.stop()}}),e,this,[[4,27,30,33]])})));return function(t){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){return!!(0,Y.Z)((0,X.Z)(r.prototype),"canResume",this).call(this)&&(null==this.timeExtent||!this.timeExtent.isEmpty)}}]),r}(e);return(0,h._)([(0,p.Cb)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),(0,h._)([(0,p.Cb)({readOnly:!0})],t.prototype,"availableFields",null),(0,h._)([(0,p.Cb)({type:Ye.Z})],t.prototype,"featureEffect",null),(0,h._)([(0,p.Cb)({type:F.Z})],t.prototype,"filter",void 0),(0,h._)([(0,p.Cb)(Qe.qG)],t.prototype,"timeExtent",void 0),(0,h._)([(0,p.Cb)()],t.prototype,"layer",void 0),(0,h._)([(0,p.Cb)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),(0,h._)([(0,p.Cb)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),(0,h._)([(0,p.Cb)({readOnly:!0})],t.prototype,"requiredFields",void 0),(0,h._)([(0,p.Cb)()],t.prototype,"suspended",void 0),(0,h._)([(0,p.Cb)()],t.prototype,"view",void 0),t=(0,h._)([(0,g.j)(et)],t),t}((0,nt.Z)((0,N.y)(rt.Z))));(0,h._)([(0,p.Cb)()],ot.prototype,"_serviceOptions",void 0),(0,h._)([(0,p.Cb)()],ot.prototype,"_proxy",void 0),(0,h._)([(0,p.Cb)()],ot.prototype,"_pipelineIsUpdating",void 0),(0,h._)([(0,p.Cb)()],ot.prototype,"_effectiveRenderer",void 0),(0,h._)([(0,p.Cb)()],ot.prototype,"_effectiveFeatureReduction",null),(0,h._)([(0,p.Cb)()],ot.prototype,"_aggregateValueRanges",void 0),(0,h._)([(0,p.Cb)()],ot.prototype,"_commandsQueue",void 0),(0,h._)([(0,p.Cb)()],ot.prototype,"featureEffectView",void 0),(0,h._)([(0,p.Cb)()],ot.prototype,"labelsVisible",null),(0,h._)([(0,p.Cb)()],ot.prototype,"labelingCollisionInfos",null),(0,h._)([(0,p.Cb)({readOnly:!0})],ot.prototype,"queryMode",null),(0,h._)([(0,p.Cb)()],ot.prototype,"renderingConfigHash",null),(0,h._)([(0,p.Cb)()],ot.prototype,"tileRenderer",void 0),(0,h._)([(0,p.Cb)()],ot.prototype,"updating",void 0);var lt=ot=(0,h._)([(0,g.j)("esri.views.2d.layers.FeatureLayerView2D")],ot)},24405:function(e,t,r){r.d(t,{V5:function(){return l},e7:function(){return u}});var n=r(74165),i=r(93433),a=r(15861),s=r(37270);function u(e){return o.apply(this,arguments)}function o(){return o=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,u,o,l,c,f,h,d,p,y,v=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(u=v.length>1&&void 0!==v[1]?v[1]:t.popupTemplate)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,u.getRequiredFields(t.fieldsIndex);case 5:if(o=e.sent,l=u.lastEditInfoEnabled,c=t.objectIdField,f=t.typeIdField,h=t.globalIdField,d=t.relationships,!o.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!l){e.next=19;break}return e.next=16,(0,s.CH)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return p=e.t0,y=(0,s.Q0)(t.fieldsIndex,[].concat((0,i.Z)(o),(0,i.Z)(p))),e.abrupt("return",(f&&y.push(f),y&&c&&null!==(r=t.fieldsIndex)&&void 0!==r&&r.has(c)&&!y.includes(c)&&y.push(c),y&&h&&null!==(a=t.fieldsIndex)&&void 0!==a&&a.has(h)&&!y.includes(h)&&y.push(h),d&&d.forEach((function(e){var r,n=e.keyField;y&&n&&(null===(r=t.fieldsIndex)||void 0===r?void 0:r.has(n))&&!y.includes(n)&&y.push(n)})),y));case 23:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function l(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=6685.47047512.chunk.js.map