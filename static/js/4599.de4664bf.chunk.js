"use strict";(self.webpackChunkgis_dashboard=self.webpackChunkgis_dashboard||[]).push([[4599],{70116:function(e,t,i){var n;i.d(t,{Y:function(){return n}}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(n||(n={}))},16054:function(e,t,i){i.d(t,{z:function(){return s}});var n=i(15671),r=i(43144),a=i(18759),s=function(){function e(t,i){(0,n.Z)(this,e),this._storage=new a.WJ,this.id="",this.name="",this.size=0,this._storage.maxSize=t,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}return(0,r.Z)(e,[{key:"destroy",value:function(){this._storage.deregister(this),this._storage.destroy()}},{key:"put",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._storage.put(this,e,t,i,1)}},{key:"pop",value:function(e){return this._storage.pop(this,e)}},{key:"get",value:function(e){return this._storage.get(this,e)}},{key:"clear",value:function(){this._storage.clearAll()}},{key:"maxSize",get:function(){return this._storage.maxSize},set:function(e){this._storage.maxSize=e}},{key:"resetHitRate",value:function(){}}]),e}()},18759:function(e,t,i){i.d(t,{WJ:function(){return c},Xq:function(){return u}});var n,r,a=i(29439),s=i(37762),o=i(15671),l=i(43144),h=i(27546);(r=n||(n={}))[r.ALL=0]="ALL",r[r.SOME=1]="SOME";var u=function(){function e(t,i,n){(0,o.Z)(this,e),this.name=t,this._storage=i,this.id=f+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),n&&(this._storage.registerRemoveFunc(this.id,n),this._removeFunc=!0)}return(0,l.Z)(e,[{key:"destroy",value:function(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}},{key:"hitRate",get:function(){return this._hit/(this._hit+this._miss)}},{key:"sizeAll",get:function(){return this._storage.size}},{key:"resetHitRate",value:function(){this._hit=this._miss=0}},{key:"put",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._storage.put(this,e,t,i,n)}},{key:"get",value:function(e){var t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}},{key:"pop",value:function(e){var t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}},{key:"updateSize",value:function(e,t,i){this._storage.updateSize(this,e,t,i)}},{key:"clear",value:function(){this._storage.clear(this)}},{key:"clearAll",value:function(){this._storage.clearAll()}},{key:"performanceInfo",get:function(){return this._storage.performanceInfo}},{key:"resetStats",value:function(){this._storage.resetStats()}}]),e}(),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10485760;(0,o.Z)(this,e),this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new h.Z,this._users=new h.Z}return(0,l.Z)(e,[{key:"size",get:function(){return this._size}},{key:"destroy",value:function(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}},{key:"register",value:function(e){this._users.push(e)}},{key:"deregister",value:function(e){this._users.removeUnordered(e)}},{key:"registerRemoveFunc",value:function(e,t){this._removeFuncs.push([e,t])}},{key:"deregisterRemoveFunc",value:function(e){this._removeFuncs.filterInPlace((function(t){return t[0]!==e}))}},{key:"maxSize",get:function(){return this._maxSize},set:function(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}},{key:"put",value:function(e,t,i,r,a){t=e.id+t;var s=this._db.get(t);if(s&&(this._size-=s.size,e.size-=s.size,this._db.delete(t),s.entry!==i&&this._notifyRemove(t,s.entry,n.ALL)),r>this._maxSize)this._notifyRemove(t,i,n.ALL);else if(void 0!==i)if(!r||r<0)console.warn("Refusing to cache entry with invalid size "+r);else{var o=1+Math.max(a,-3)- -3;this._db.set(t,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,e.size+=r,this._checkSizeLimits()}else console.warn("Refusing to cache undefined entry ")}},{key:"updateSize",value:function(e,t,i,r){t=e.id+t;var a=this._db.get(t);if(a&&a.entry===i){for(this._size-=a.size,e.size-=a.size;r>this._maxSize;){var s=this._notifyRemove(t,i,n.SOME);if(!(null!=s&&s>0))return void this._db.delete(t);r=s}a.size=r,this._size+=r,e.size+=r,this._checkSizeLimits()}}},{key:"pop",value:function(e,t){t=e.id+t;var i=this._db.get(t);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}},{key:"get",value:function(e,t){t=e.id+t;var i=this._db.get(t);if(void 0!==i)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}},{key:"performanceInfo",get:function(){var e=this,t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},n=new Array;this._db.forEach((function(t,r){var a=t.lifetime;n[a]=(n[a]||0)+t.size,e._users.forAll((function(e){var n=e.id,a=e.name;if(r.startsWith(n)){var s=i[a]||0;i[a]=s+t.size}}))}));var r={};this._users.forAll((function(e){var t=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){var n=i[t]||0;i[t]=n,r[t]=Math.round(100*e.hitRate)+"%"}else r[t]="0%"}));var a=Object.keys(i);a.sort((function(e,t){return i[t]-i[e]})),a.forEach((function(e){return t[e]=Math.round(i[e]/Math.pow(2,20))+"MB / "+r[e]}));for(var s=n.length-1;s>=0;--s){var o=n[s];o&&(t["Priority "+(s+-3-1)]=Math.round(o/this._size*100)+"%")}return t}},{key:"resetStats",value:function(){this._hit=this._miss=0,this._users.forAll((function(e){return e.resetHitRate()}))}},{key:"clear",value:function(e){var t=this,i=e.id;this._db.forEach((function(e,r){r.startsWith(i)&&(t._size-=e.size,t._db.delete(r),t._notifyRemove(r,e.entry,n.ALL))})),e.size=0}},{key:"clearAll",value:function(){var e=this;this._db.forEach((function(t,i){return e._notifyRemove(i,t.entry,n.ALL)})),this._users.forEach((function(e){return e.size=0})),this._size=0,this._db.clear()}},{key:"_getHitRate",value:function(){return this._hit/(this._hit+this._miss)}},{key:"_notifyRemove",value:function(e,t,i){var n;return this._removeFuncs.some((function(r){if(e.startsWith(r[0])){var a=r[1](t,i);return"number"==typeof a&&(n=a),!0}return!1})),n}},{key:"_checkSizeLimits",value:function(){var e=this;if(this._size>this._maxSize){var t,i=(0,s.Z)(this._db);try{for(i.s();!(t=i.n()).done;){var n=(0,a.Z)(t.value,2),r=n[0],o=n[1];if(this._purgeItem(r,o),this._size<=.9*this.maxSize)return}}catch(l){i.e(l)}finally{i.f()}}this._users.forEach((function(t){if(t.maxSize>0&&t.size>t.maxSize){var i,n=(0,s.Z)(e._db);try{for(n.s();!(i=n.n()).done;){var r=(0,a.Z)(i.value,2),o=r[0],h=r[1];if(o.startsWith(t.id)&&(e._purgeItem(o,h,t),t.size<=.9*t.maxSize))return}}catch(l){n.e(l)}finally{n.f()}}}))}},{key:"_purgeItem",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._users.find((function(t){return e.startsWith(t.id)}));if(this._db.delete(e),t.lives<=1){this._size-=t.size,i&&(i.size-=t.size);var r=this._notifyRemove(e,t.entry,n.SOME);null!=r&&r>0&&(this._size+=r,i&&(i.size+=r),t.lives=t.lifetime,t.size=r,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}]),e}(),f=0},11936:function(e,t,i){i.d(t,{Y:function(){return f}});var n=i(15671),r=i(43144),a=i(60136),s=i(29388),o=i(27366),l=i(32718),h=i(49861),u=(i(25243),i(63780),i(93169),i(69912)),c=i(25899),f=function(e){var t=function(e){(0,a.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,n.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"title",get:function(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){var e=(0,c.Qc)(this.url);if(null!=e&&e.title)return e.title}return this._get("title")||""},set:function(e){this._set("title",e)}},{key:"url",set:function(e){this._set("url",(0,c.Nm)(e,l.Z.getLogger(this)))}}]),i}(e);return(0,o._)([(0,h.Cb)()],t.prototype,"title",null),(0,o._)([(0,h.Cb)({type:String})],t.prototype,"url",null),t=(0,o._)([(0,u.j)("esri.layers.mixins.ArcGISService")],t)}},34810:function(e,t,i){i.d(t,{y:function(){return R}});var n=i(74165),r=i(15861),a=i(1413),s=i(15671),o=i(43144),l=i(60136),h=i(29388),u=i(27366),c=i(76200),f=i(7138),v=i(70116),_=i(10064),d=i(42537),m=i(16054),y=i(27546),p=i(66978),g=i(94172),b=i(99346),z=i(35995),k=i(49861),w=(i(25243),i(63780)),S=(i(93169),i(69912)),Z=i(87960),A=i(84652),x=i(18722);var L,O=function(){function e(t){(0,s.Z)(this,e),this._validateJSON(t);var i=t.location,n=t.data;this.location=Object.freeze((0,A.d9)(i));for(var r=this.location.width,a=this.location.height,o=!0,l=!0,h=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=x.DB?t?new Array(e).fill(0):new Array(e):new Uint32Array(e)}(Math.ceil(r*a/32)),u=0,c=0;c<n.length;c++){var f=c%32;n[c]?(l=!1,h[u]|=1<<f):o=!1,31===f&&++u}l?(this._availability="unavailable",this.byteSize=40):o?(this._availability="available",this.byteSize=40):(this._availability=h,this.byteSize=40+(0,x.Xw)(h))}return(0,o.Z)(e,[{key:"getAvailability",value:function(e,t){if("unavailable"===this._availability||"available"===this._availability)return this._availability;var i=(e-this.location.top)*this.location.width+(t-this.location.left),n=i%32,r=i>>5,a=this._availability;return r<0||r>a.length?"unknown":a[r]&1<<n?"available":"unavailable"}},{key:"_validateJSON",value:function(e){if(!e||!e.location)throw new _.Z("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new _.Z("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new _.Z("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new _.Z("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new _.Z("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}],[{key:"fromDefinition",value:function(t,i){var n=t.service.request||c.default,r=t.row,s=t.col,o=t.width,l=t.height,h={query:{f:"json"}};return i=i?(0,a.Z)((0,a.Z)({},h),i):h,n(function(e){var t,i;if(null!==(t=e.service.tileServers)&&void 0!==t&&t.length){var n=e.service.tileServers;i="".concat(n&&n.length?n[e.row%n.length]:e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}else i="".concat(e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height);var r=e.service.query;return r&&(i="".concat(i,"?").concat(r)),i}(t),i).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:r,left:s,width:o,height:l},valid:!0,data:(0,w.a9)(o*l,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==r||t.location.left!==s||t.location.width!==o||t.location.height!==l))throw new _.Z("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:r,left:s,width:o,height:l}});return e.fromJSON(t)}))}},{key:"fromJSON",value:function(t){return Object.freeze(new e(t))}}]),e}();function M(e){return"".concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var R=L=function(e){(0,l.Z)(i,e);var t=(0,h.Z)(i);function i(e){var n;return(0,s.Z)(this,i),(n=t.call(this,e))._pendingTilemapRequests={},n.request=c.default,n.size=32,n._prefetchingEnabled=!0,n}return(0,o.Z)(i,[{key:"initialize",value:function(){var e=this;this._tilemapCache=new m.z(2*v.Y.MEGABYTES),this.addHandles([(0,g.YP)((function(){var t=e.layer;return[null===t||void 0===t?void 0:t.parsedUrl,null===t||void 0===t?void 0:t.tileServers,null===t||void 0===t?void 0:t.apiKey,null===t||void 0===t?void 0:t.customParameters]}),(function(){return e._initializeTilemapDefinition()}),g.nn)])}},{key:"effectiveMinLOD",get:function(){var e;return null!==(e=this.minLOD)&&void 0!==e?e:this.layer.tileInfo.lods[0].level}},{key:"effectiveMaxLOD",get:function(){var e;return null!==(e=this.maxLOD)&&void 0!==e?e:this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}},{key:"fetchTilemap",value:function(e,t,i,n){var r=this;if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return Promise.reject(new _.Z("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")));var s=this._tmpTilemapDefinition,o=this._tilemapFromCache(e,t,i,s);if(o)return Promise.resolve(o);var l=n&&n.signal;return n=(0,a.Z)((0,a.Z)({},n),{},{signal:null}),new Promise((function(e,t){(0,p.fu)(l,(function(){return t((0,p.zE)())}));var i=M(s),a=r._pendingTilemapRequests[i];if(!a){a=O.fromDefinition(s,n).then((function(e){return r._tilemapCache.put(i,e,e.byteSize),e}));var o=function(){return delete r._pendingTilemapRequests[i]};r._pendingTilemapRequests[i]=a,a.then(o,o)}a.then(e,t)}))}},{key:"getAvailability",value:function(e,t,i){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return"unavailable";var n=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return n?n.getAvailability(t,i):"unknown"}},{key:"fetchAvailability",value:function(e,t,i,n){return!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD?Promise.reject(new _.Z("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):this.fetchTilemap(e,t,i,n).catch((function(e){return e})).then((function(n){if(n instanceof O){var r=n.getAvailability(t,i);if("unavailable"===r)throw new _.Z("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i});return r}if((0,p.D_)(n))throw n;return"unknown"}))}},{key:"fetchAvailabilityUpsample",value:function(e,t,i,n,r){var a=this;n.level=e,n.row=t,n.col=i;var s=this.layer.tileInfo;s.updateTileInfo(n);var o=this.fetchAvailability(e,t,i,r).catch((function(e){if((0,p.D_)(e))throw e;if(s.upsampleTile(n))return a.fetchAvailabilityUpsample(n.level,n.row,n.col,n,r);throw e}));return this._fetchAvailabilityUpsamplePrefetch(n.id,e,t,i,r,o),o}},{key:"_fetchAvailabilityUpsamplePrefetch",value:function(){var e=(0,r.Z)((0,n.Z)().mark((function e(t,i,r,s,o,l){var h,u,c,f,v,_,m,y,g=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._prefetchingEnabled&&null!=t){e.next=2;break}return e.abrupt("return");case 2:if(h="prefetch-".concat(t),!this.hasHandles(h)){e.next=5;break}return e.abrupt("return");case 5:return u=new AbortController,l.then((function(){return u.abort()}),(function(){return u.abort()})),c=!1,f=(0,d.kB)((function(){c||(c=!0,u.abort())})),this.addHandles(f,h),e.next=12,(0,b.MU)(10,u.signal).catch((function(){}));case 12:if(c||(c=!0,this.removeHandles(h)),!(0,p.Hc)(u)){e.next=15;break}return e.abrupt("return");case 15:v=new Z.f(t,i,r,s),_=(0,a.Z)((0,a.Z)({},o),{},{signal:u.signal}),m=this.layer.tileInfo,y=(0,n.Z)().mark((function e(){var t,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=g.fetchAvailability(v.level,v.row,v.col,_),L._prefetches.push(t),i=function(){L._prefetches.removeUnordered(t)},t.then(i,i);case 4:case"end":return e.stop()}}),e)})),0;case 18:if(!(L._prefetches.length<L._maxPrefetch&&m.upsampleTile(v))){e.next=23;break}return e.delegateYield(y(),"t0",20);case 20:e.next=18;break;case 23:case"end":return e.stop()}}),e,this)})));return function(t,i,n,r,a,s){return e.apply(this,arguments)}}()},{key:"_initializeTilemapDefinition",value:function(){var e;if(this.layer.parsedUrl){var t=this.layer,i=t.parsedUrl,n=t.apiKey,r=t.customParameters;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:i.path,query:(0,z.B7)((0,a.Z)((0,a.Z)((0,a.Z)({},i.query),r),{},{token:null!==n&&void 0!==n?n:null===(e=i.query)||void 0===e?void 0:e.token})),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}}},{key:"_tilemapFromCache",value:function(e,t,i,n){n.level=e,n.row=t-t%this.size,n.col=i-i%this.size;var r=M(n);return this._tilemapCache.get(r)}},{key:"test",get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,i,n){return!!e._tilemapFromCache(t,i,n,e._tmpTilemapDefinition)}}}}]),i}(f.Z);R._maxPrefetch=4,R._prefetches=new y.Z({initialSize:L._maxPrefetch}),(0,u._)([(0,k.Cb)({constructOnly:!0})],R.prototype,"layer",void 0),(0,u._)([(0,k.Cb)({constructOnly:!0})],R.prototype,"minLOD",void 0),(0,u._)([(0,k.Cb)({constructOnly:!0})],R.prototype,"maxLOD",void 0),(0,u._)([(0,k.Cb)({constructOnly:!0})],R.prototype,"request",void 0),(0,u._)([(0,k.Cb)({constructOnly:!0})],R.prototype,"size",void 0),R=L=(0,u._)([(0,S.j)("esri.layers.support.TilemapCache")],R)}}]);
//# sourceMappingURL=4599.de4664bf.chunk.js.map