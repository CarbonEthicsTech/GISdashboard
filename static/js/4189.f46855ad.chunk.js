"use strict";(self.webpackChunkgis_dashboard=self.webpackChunkgis_dashboard||[]).push([[4189],{87072:function(e,t,r){function n(e){var t,r=e.layer;return"floorInfo"in r&&null!==(t=r.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?a(e.view.floors,r.floorInfo.floorField):null}function i(e,t){var r;return"floorInfo"in t&&null!==(r=t.floorInfo)&&void 0!==r&&r.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(null===e||void 0===e||!e.length)return null;var r=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return r.push("''"),"".concat(t," IN (").concat(r.join(","),") OR ").concat(t," IS NULL")}r.d(t,{c:function(){return n},f:function(){return i}})},58132:function(e,t,r){r.d(t,{FN:function(){return o},QV:function(){return a},ac:function(){return l}});var n=r(37762),i=r(25265);function a(e,t,r){return t.flatten((function(e){return e.sublayers})).length!==e.length||(!!e.some((function(e){return e.originIdOf("minScale")>r||e.originIdOf("maxScale")>r||e.originIdOf("renderer")>r||e.originIdOf("labelingInfo")>r||e.originIdOf("opacity")>r||e.originIdOf("labelsVisible")>r||e.originIdOf("source")>r}))||!u(e,t))}function o(e,t,r){return!!e.some((function(e){var t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&(null==t.gdbVersion||t.gdbVersion===r))||e.originIdOf("renderer")>i.s3.SERVICE||e.originIdOf("labelingInfo")>i.s3.SERVICE||e.originIdOf("opacity")>i.s3.SERVICE||e.originIdOf("labelsVisible")>i.s3.SERVICE}))||!u(e,t)}function u(e,t){if(!e||!e.length||null==t)return!0;var r=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>r.length)return!1;var i,a=0,o=r.length,u=(0,n.Z)(e);try{for(u.s();!(i=u.n()).done;){for(var l=i.value.id;a<o&&r[a]!==l;)a++;if(a>=o)return!1}}catch(s){u.e(s)}finally{u.f()}return!0}function l(e){return!!e&&e.some((function(e){return null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale}))}},83978:function(e,t,r){r.d(t,{Z:function(){return h}});var n=r(15671),i=r(43144),a=r(11752),o=r(61120),u=r(60136),l=r(29388),s=r(27366),c=(r(32718),r(25243),r(63780),r(93169),r(10064),r(69912)),p=r(80613),f=r(82022),d=r(8548),y=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"doRender",value:function(e){e.drawPhase===p.jx.HIGHLIGHT&&(0,a.Z)((0,o.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"renderChildren",value:function(e){if(this.attributeView.update(),this.children.some((function(e){return e.hasData}))){this.attributeView.bindTextures(e.context),(0,a.Z)((0,o.Z)(r.prototype),"renderChildren",this).call(this,e);var t=e.painter.effects.highlight;t.bind(e),e.context.setColorMask(!0,!0,!0,!0),e.context.clear(d.lk.COLOR_BUFFER_BIT),this._renderChildren(e,t.defines.concat(["highlightAll"])),t.draw(e),t.unbind()}}}]),r}(f.Z),h=y=(0,s._)([(0,c.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],y)},32645:function(e,t,r){r.d(t,{VF:function(){return se},Uf:function(){return le}});var n=r(1413),i=r(93433),a=r(29439),o=r(37762),u=r(74165),l=r(15861),s=r(15671),c=r(43144),p=r(60136),f=r(29388),d=r(27366),y=r(52639),h=r(7138),v=r(63780),m=r(40281),g=r(10064),b=r(42537),x=r(93169),w=r(77427),Z=r(66978),k=r(94172),I=r(68860),_=r(49861),F=r(25243),C=r(69912),O=r(53866),S=r(82582),E=r(37270),R=r(87072),j=r(96669),V=r(76200),N=r(91340),P=r(23084),G=r(76672),T=r(77981),A=r(58132),L=function(e){return e.spatialReference.wkid||JSON.stringify(e.spatialReference)};function U(e,t){var r=e.toJSON(),n=r.dpi,i=r.gdbVersion,a=r.geometry,o=r.geometryPrecision,u=r.height,l=r.layerOption,s=r.mapExtent,c=r.maxAllowableOffset,p=r.returnFieldName,f=r.returnGeometry,d=r.returnUnformattedValues,y=r.returnZ,h=r.spatialReference,v=r.timeExtent,m=r.tolerance,g=r.width,b=H(e),x=b.dynamicLayers,w=b.layerDefs,Z=b.layerIds,k=t&&null!=t.geometry?t.geometry:null,I={geometryPrecision:o,maxAllowableOffset:c,returnFieldName:p,returnGeometry:f,returnUnformattedValues:d,returnZ:y,tolerance:m},_=k&&k.toJSON()||a;if(I.imageDisplay="".concat(g,",").concat(u,",").concat(n),i&&(I.gdbVersion=i),_&&(delete _.spatialReference,I.geometry=JSON.stringify(_),I.geometryType=(0,T.Ji)(_)),h?I.sr=h.wkid||JSON.stringify(h):_&&_.spatialReference?I.sr=L(_):s&&s.spatialReference&&(I.sr=L(s)),I.time=v?[v.start,v.end].join(","):null,s){var F=s.xmin,C=s.ymin,O=s.xmax,S=s.ymax;I.mapExtent="".concat(F,",").concat(C,",").concat(O,",").concat(S)}return w&&(I.layerDefs=w),x&&!w&&(I.dynamicLayers=x),I.layers="popup"===l?"visible":l,Z&&!x&&(I.layers+=":".concat(Z.join(","))),I}function H(e){var t,r=e.mapExtent,n=e.floors,i=e.width,a=e.sublayers,u=e.layerIds,l=e.layerOption,s=e.gdbVersion,c=null===a||void 0===a||null===(t=a.find((function(e){return null!=e.layer})))||void 0===t||null===(t=t.layer)||void 0===t?void 0:t.serviceSublayers,p="popup"===l,f={},d=(0,S.yZ)({extent:r,width:i,spatialReference:null===r||void 0===r?void 0:r.spatialReference}),y=[];if(null!==a&&void 0!==a&&a.forEach((function e(t){var r=0===d,n=0===t.minScale||d<=t.minScale,i=0===t.maxScale||d>=t.maxScale;if(t.visible&&(r||n&&i))if(t.sublayers)t.sublayers.forEach(e);else{if(!1===(null===u||void 0===u?void 0:u.includes(t.id))||p&&(!t.popupTemplate||!t.popupEnabled))return;y.unshift(t)}})),a&&!y.length)f.layerIds=[];else{var h=(0,A.FN)(y,c,s),v=y.map((function(e){var t=(0,R.f)(n,e);return e.toExportImageJSON(t)}));if(h)f.dynamicLayers=JSON.stringify(v);else{if(a){var m=y.map((function(e){return e.id}));u&&(m=m.filter((function(e){return u.includes(e)}))),f.layerIds=m}else(null===u||void 0===u?void 0:u.length)&&(f.layerIds=u);var g=function(e,t){var r=!(null===e||void 0===e||!e.length),n=t.filter((function(e){return null!=e.definitionExpression||r&&null!=e.floorInfo}));return n.length?n.map((function(t){var r=(0,R.f)(e,t),n=(0,G._)(r,t.definitionExpression);return{id:t.id,definitionExpression:null!==n&&void 0!==n?n:void 0}})):null}(n,y);if(null!=g&&g.length){var b,x={},w=(0,o.Z)(g);try{for(w.s();!(b=w.n()).done;){var Z=b.value;Z.definitionExpression&&(x[Z.id]=Z.definitionExpression)}}catch(k){w.e(k)}finally{w.f()}Object.keys(x).length&&(f.layerDefs=JSON.stringify(x))}}}return f}var J,M=r(59486),Q=r(62044),q=r(46784),B=r(78952),D=J=function(e){(0,p.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).dpi=96,n.floors=null,n.gdbVersion=null,n.geometry=null,n.geometryPrecision=null,n.height=400,n.layerIds=null,n.layerOption="top",n.mapExtent=null,n.maxAllowableOffset=null,n.returnFieldName=!0,n.returnGeometry=!1,n.returnM=!1,n.returnUnformattedValues=!0,n.returnZ=!1,n.spatialReference=null,n.sublayers=null,n.timeExtent=null,n.tolerance=null,n.width=400,n}return(0,c.Z)(r,null,[{key:"from",value:function(e){return(0,F.TJ)(J,e)}}]),r}(q.wq);(0,d._)([(0,_.Cb)({type:Number,json:{write:!0}})],D.prototype,"dpi",void 0),(0,d._)([(0,_.Cb)()],D.prototype,"floors",void 0),(0,d._)([(0,_.Cb)({type:String,json:{write:!0}})],D.prototype,"gdbVersion",void 0),(0,d._)([(0,_.Cb)({types:M.qM,json:{read:T.im,write:!0}})],D.prototype,"geometry",void 0),(0,d._)([(0,_.Cb)({type:Number,json:{write:!0}})],D.prototype,"geometryPrecision",void 0),(0,d._)([(0,_.Cb)({type:Number,json:{write:!0}})],D.prototype,"height",void 0),(0,d._)([(0,_.Cb)({type:[Number],json:{write:!0}})],D.prototype,"layerIds",void 0),(0,d._)([(0,_.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],D.prototype,"layerOption",void 0),(0,d._)([(0,_.Cb)({type:O.Z,json:{write:!0}})],D.prototype,"mapExtent",void 0),(0,d._)([(0,_.Cb)({type:Number,json:{write:!0}})],D.prototype,"maxAllowableOffset",void 0),(0,d._)([(0,_.Cb)({type:Boolean,json:{write:!0}})],D.prototype,"returnFieldName",void 0),(0,d._)([(0,_.Cb)({type:Boolean,json:{write:!0}})],D.prototype,"returnGeometry",void 0),(0,d._)([(0,_.Cb)({type:Boolean,json:{write:!0}})],D.prototype,"returnM",void 0),(0,d._)([(0,_.Cb)({type:Boolean,json:{write:!0}})],D.prototype,"returnUnformattedValues",void 0),(0,d._)([(0,_.Cb)({type:Boolean,json:{write:!0}})],D.prototype,"returnZ",void 0),(0,d._)([(0,_.Cb)({type:B.Z,json:{write:!0}})],D.prototype,"spatialReference",void 0),(0,d._)([(0,_.Cb)()],D.prototype,"sublayers",void 0),(0,d._)([(0,_.Cb)({type:Q.Z,json:{write:!0}})],D.prototype,"timeExtent",void 0),(0,d._)([(0,_.Cb)({type:Number,json:{write:!0}})],D.prototype,"tolerance",void 0),(0,d._)([(0,_.Cb)({type:Number,json:{write:!0}})],D.prototype,"width",void 0);var z=D=J=(0,d._)([(0,C.j)("esri.rest.support.IdentifyParameters")],D),W=r(38511),X=r(31201),Y=r(27823),K=function(e){(0,p.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).displayFieldName=null,n.feature=null,n.layerId=null,n.layerName=null,n}return(0,c.Z)(r,[{key:"readFeature",value:function(e,t){return y.Z.fromJSON({attributes:(0,n.Z)({},t.attributes),geometry:(0,n.Z)({},t.geometry)})}},{key:"writeFeature",value:function(e,t){if(e){var r=e.attributes,i=e.geometry;r&&(t.attributes=(0,n.Z)({},r)),null!=i&&(t.geometry=i.toJSON(),t.geometryType=Y.P.toJSON(i.type))}}}]),r}(q.wq);(0,d._)([(0,_.Cb)({type:String,json:{write:!0}})],K.prototype,"displayFieldName",void 0),(0,d._)([(0,_.Cb)({type:y.Z})],K.prototype,"feature",void 0),(0,d._)([(0,W.r)("feature",["attributes","geometry"])],K.prototype,"readFeature",null),(0,d._)([(0,X.c)("feature")],K.prototype,"writeFeature",null),(0,d._)([(0,_.Cb)({type:Number,json:{write:!0}})],K.prototype,"layerId",void 0),(0,d._)([(0,_.Cb)({type:String,json:{write:!0}})],K.prototype,"layerName",void 0);var $=K=(0,d._)([(0,C.j)("esri.rest.support.IdentifyResult")],K);function ee(e,t,r){return te.apply(this,arguments)}function te(){return te=(0,l.Z)((0,u.Z)().mark((function e(t,r,i){var a,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(u=r,r=u=z.from(u)).geometry?[r.geometry]:[],o=(0,P.en)(t),e.abrupt("return",(o.path+="/identify",(0,N.aX)(a).then((function(e){var t=U(r,{geometry:e&&e[0]}),a=(0,P.cv)((0,n.Z)((0,n.Z)({},o.query),{},{f:"json"},t)),u=(0,P.lA)(a,i);return(0,V.default)(o.path,u).then(re).then((function(e){return ne(e,r.sublayers)}))}))));case 2:case"end":return e.stop()}var u}),e)}))),te.apply(this,arguments)}function re(e){var t=e.data;return t.results=t.results||[],t.exceededTransferLimit=Boolean(t.exceededTransferLimit),t.results=t.results.map((function(e){return $.fromJSON(e)})),t}function ne(e,t){if(null===t||void 0===t||!t.length)return e;var r=new Map;t.forEach((function e(t){r.set(t.id,t),t.sublayers&&t.sublayers.forEach(e)}));var n,i=(0,o.Z)(e.results);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.feature.sourceLayer=r.get(a.layerId)}}catch(u){i.e(u)}finally{i.f()}return e}var ie=r(819),ae=r(16072),oe=r(24405),ue=null;function le(e,t){return"tile"===t.type||"map-image"===t.type}var se=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e))._featuresResolutions=new WeakMap,r.highlightGraphics=null,r.highlightGraphicUpdated=null,r.updateHighlightedFeatures=(0,Z.Ds)(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.destroyed||r.updatingHandles.addPromise(r._updateHighlightedFeaturesGeometries(t).catch((function(){})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=this,t=function(t){e.updatingHandles.addPromise(e._updateHighlightedFeaturesSymbols(t).catch((function(){}))),e.updateHighlightedFeatures(e._highlightGeometriesResolution)};this.addHandles([(0,k.on)((function(){return e.highlightGraphics}),"change",(function(e){return t(e.added)}),{onListenerAdd:function(e){return t(e)}})])}},{key:"fetchPopupFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r){var n,i,a,o,l,s,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.layerView,o=a.layer,l=a.view.scale,t){e.next=3;break}throw new g.Z("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:o});case 3:if((s=ce(o.sublayers,l,r)).length){e.next=6;break}return e.abrupt("return",[]);case 6:return e.next=8,fe(o,s);case 8:if(c=e.sent,(null===(n=null===(i=o.capabilities)||void 0===i||null===(i=i.operations)||void 0===i?void 0:i.supportsIdentify)||void 0===n||n)&&o.version>=10.5||c){e.next=11;break}throw new g.Z("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:o});case 11:return e.abrupt("return",c?this._fetchPopupFeaturesUsingQueries(t,s,r):this._fetchPopupFeaturesUsingIdentify(t,s,r));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"clearHighlights",value:function(){var e;null===(e=this.highlightGraphics)||void 0===e||e.removeAll()}},{key:"highlight",value:function(e){var t,r=this.highlightGraphics;if(!r)return{remove:function(){}};var n=null;if(e instanceof y.Z?n=[e]:m.Z.isCollection(e)&&e.length>0?n=e.toArray():Array.isArray(e)&&e.length>0&&(n=e),!(n=null===(t=n)||void 0===t?void 0:t.filter(v.pC))||!n.length)return(0,b.kB)();var i,a=(0,o.Z)(n);try{for(a.s();!(i=a.n()).done;){var u=i.value,l=u.sourceLayer;null!=l&&"geometryType"in l&&"point"===l.geometryType&&(u.visible=!1)}}catch(s){a.e(s)}finally{a.f()}return r.addMany(n),{remove:function(){var e;r.removeMany(null!==(e=n)&&void 0!==e?e:[])}}}},{key:"_updateHighlightedFeaturesSymbols",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var n,i,a,s,c,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.layerView.view,i=this.highlightGraphics,a=this.highlightGraphicUpdated,!i||!a){e.next=18;break}s=(0,o.Z)(t),e.prev=3,p=(0,u.Z)().mark((function e(){var t,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=c.value,o=t.sourceLayer&&"renderer"in t.sourceLayer&&t.sourceLayer.renderer,t.sourceLayer&&"geometryType"in t.sourceLayer&&"point"===t.sourceLayer.geometryType&&o&&"getSymbolAsync"in o&&o.getSymbolAsync(t).then(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(l){var s,c,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l||(l=new ae.Z),c=null,p="visualVariables"in o?null===(s=o.visualVariables)||void 0===s?void 0:s.find((function(e){return"size"===e.type})):void 0,e.t0=p,!e.t0){e.next=11;break}if(e.t1=ue,e.t1){e.next=10;break}return e.next=9,Promise.resolve().then(r.bind(r,56011));case 9:ue=e.sent.getSize;case 10:c=ue(p,t,{view:n.type,scale:n.scale,shape:"simple-marker"===l.type?l.style:null});case 11:c||(c="width"in l&&"height"in l&&null!=l.width&&null!=l.height?Math.max(l.width,l.height):"size"in l?l.size:16),i.includes(t)&&(t.symbol=new ae.Z({style:"square",size:c,xoffset:"xoffset"in l?l.xoffset:0,yoffset:"yoffset"in l?l.yoffset:0}),a(t,"symbol"),t.visible=!0);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})),s.s();case 6:if((c=s.n()).done){e.next=10;break}return e.delegateYield(p(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),s.e(e.t1);case 15:return e.prev=15,s.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[3,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateHighlightedFeaturesGeometries",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r,n,l,s,c,p,f,d,y,h,v,m,g,b,x,Z,k,I,_,F,C;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.layerView,n=r.layer,l=r.view,s=this.highlightGraphics,c=this.highlightGraphicUpdated,this._highlightGeometriesResolution=t,c&&null!==s&&void 0!==s&&s.length&&n.capabilities.operations.supportsQuery){e.next=3;break}return e.abrupt("return");case 3:p=this._getTargetResolution(t),f=new Map,d=(0,o.Z)(s);try{for(d.s();!(y=d.n()).done;)h=y.value,(!this._featuresResolutions.has(h)||this._featuresResolutions.get(h)>p)&&(v=h.sourceLayer,(0,w.s1)(f,v,(function(){return new Map})).set(h.getObjectId(),h))}catch(u){d.e(u)}finally{d.f()}return m=Array.from(f,(function(e){var t=(0,a.Z)(e,2),r=t[0],n=t[1],o=r.createQuery();return o.objectIds=(0,i.Z)(n.keys()),o.outFields=[r.objectIdField],o.returnGeometry=!0,o.maxAllowableOffset=p,o.outSpatialReference=l.spatialReference,r.queryFeatures(o)})),e.next=9,Promise.all(m);case 9:if(g=e.sent,!this.destroyed){b=(0,o.Z)(g);try{for(b.s();!(x=b.n()).done;){Z=x.value.features,k=(0,o.Z)(Z);try{for(k.s();!(I=k.n()).done;)_=I.value,F=_.sourceLayer,(C=f.get(F).get(_.getObjectId()))&&s.includes(C)&&(C.geometry=_.geometry,c(C,"geometry"),this._featuresResolutions.set(C,p))}catch(u){k.e(u)}finally{k.f()}}}catch(u){b.e(u)}finally{b.f()}}case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getTargetResolution",value:function(e){var t=e*(0,I.c9)(this.layerView.view.spatialReference),r=t/16;return r<=10?0:e/t*r}},{key:"_fetchPopupFeaturesUsingIdentify",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var i,a,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._createIdentifyParameters(t,r,n);case 2:if(null!=(i=e.sent)){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,ee(this.layerView.layer.parsedUrl,i);case 7:return a=e.sent,o=a.results,e.abrupt("return",o.map((function(e){return e.feature})));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_createIdentifyParameters",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var i,a,o,l,s,c,p,f,d,y,h,v,m;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layerView,a=i.floors,o=i.layer,l=i.timeExtent,s=i.view,c=s.spatialReference,p=s.scale,f=null!=n?n.event:null,r.length){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,Promise.all(r.map((function(e){return e.sublayer.load().catch((function(){}))})));case 5:return d=Math.min((0,x.Z)("mapservice-popup-identify-max-tolerance"),o.allSublayers.reduce((function(e,t){return t.renderer?(0,j.k)({renderer:t.renderer,event:f}):e}),2)),y=this.createFetchPopupFeaturesQueryGeometry(t,d),h=(0,S.dp)(p,c),v=Math.round(y.width/h),m=new O.Z({xmin:y.center.x-h*v,ymin:y.center.y-h*v,xmax:y.center.x+h*v,ymax:y.center.y+h*v,spatialReference:y.spatialReference}),e.abrupt("return",new z({floors:a,gdbVersion:"gdbVersion"in o?o.gdbVersion:void 0,geometry:t,height:v,layerOption:"popup",mapExtent:m,returnGeometry:!0,spatialReference:c,sublayers:o.sublayers,timeExtent:l,tolerance:d,width:v}));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_fetchPopupFeaturesUsingQueries",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var s,c,p,f,d,y=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.layerView,c=s.floors,p=s.timeExtent,f=null!=n?n.event:null,d=r.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var n,i,l,s,d,h,v,m,g,b,x,w,Z,k,I,_,F,C,O,S,V,N;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.sublayer,l=r.popupTemplate,e.next=3,i.load().catch((function(){}));case 3:if(!i.capabilities||i.capabilities.operations.supportsQuery){e.next=5;break}return e.abrupt("return",[]);case 5:return s=i.createQuery(),d=(0,j.k)({renderer:i.renderer,event:f}),h=y.createFetchPopupFeaturesQueryGeometry(t,d),v=new Set,e.next=11,Promise.all([(0,oe.e7)(i,l),null===(n=i.renderer)||void 0===n?void 0:n.collectRequiredFields(v,i.fieldsIndex)]);case 11:return m=e.sent,g=(0,a.Z)(m,1),b=g[0],(0,E.gd)(v,i.fieldsIndex,b),x=Array.from(v).sort(),s.geometry=h,s.outFields=x,s.timeExtent=p,c&&(w=c.clone(),null!=(Z=(0,R.f)(w,i))&&(s.where=s.where?"(".concat(s.where,") AND (").concat(Z,")"):Z)),k=y._getTargetResolution(h.width/d),e.next=20,pe(l);case 20:return I=e.sent,(_="point"===i.geometryType||I&&I.arcadeUtils.hasGeometryOperations(l))||(s.maxAllowableOffset=k),e.next=25,i.queryFeatures(s);case 25:return F=e.sent,C=F.features,O=_?0:k,e.next=30,ye(i,C);case 30:C=e.sent,S=(0,o.Z)(C);try{for(S.s();!(V=S.n()).done;)N=V.value,y._featuresResolutions.set(N,O)}catch(u){S.e(u)}finally{S.f()}return e.abrupt("return",C);case 34:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,(0,Z.as)(d);case 3:return e.abrupt("return",e.sent.reverse().reduce((function(e,t){return t.value?[].concat((0,i.Z)(e),(0,i.Z)(t.value)):e}),[]).filter(v.pC));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),n}(h.Z);function ce(e,t,r){var i,a=[];return(null!==(i=null===e||void 0===e?void 0:e.toArray())&&void 0!==i?i:[]).reverse().map((function e(i){var o=0===i.minScale||t<=i.minScale,u=0===i.maxScale||t>=i.maxScale;if(i.visible&&o&&u)if(i.sublayers)i.sublayers.forEach(e);else if(i.popupEnabled){var l=(0,oe.V5)(i,(0,n.Z)((0,n.Z)({},r),{},{defaultPopupTemplateEnabled:!1}));null!=l&&a.unshift({sublayer:i,popupTemplate:l})}})),a}function pe(e){var t;return null!==(t=e.expressionInfos)&&void 0!==t&&t.length||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type}))?(0,ie.LC)():Promise.resolve()}function fe(e,t){return de.apply(this,arguments)}function de(){return(de=(0,l.Z)((0,u.Z)().mark((function e(t,r){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=t.capabilities)||void 0===n||null===(n=n.operations)||void 0===n||!n.supportsQuery){e.next=2;break}return e.abrupt("return",!0);case 2:return e.prev=2,e.next=5,Promise.any(r.map((function(e){var t=e.sublayer;return t.load().then((function(){return t.capabilities.operations.supportsQuery}))})));case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function ye(e,t){return he.apply(this,arguments)}function he(){return(he=(0,l.Z)((0,u.Z)().mark((function e(t,r){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.renderer,e.t0=n&&"defaultSymbol"in n&&!n.defaultSymbol,!e.t0){e.next=11;break}if(!n.valueExpression){e.next=9;break}return e.next=6,Promise.all(r.map((function(e){return n.getSymbolAsync(e).then((function(t){return t?e:null}))}))).then((function(e){return e.filter((function(e){return null!=e}))}));case 6:e.t1=e.sent,e.next=10;break;case 9:e.t1=r.filter((function(e){return null!=n.getSymbol(e)}));case 10:r=e.t1;case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,d._)([(0,_.Cb)({constructOnly:!0})],se.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,d._)([(0,_.Cb)({constructOnly:!0})],se.prototype,"layerView",void 0),(0,d._)([(0,_.Cb)({constructOnly:!0})],se.prototype,"highlightGraphics",void 0),(0,d._)([(0,_.Cb)({constructOnly:!0})],se.prototype,"highlightGraphicUpdated",void 0),(0,d._)([(0,_.Cb)({constructOnly:!0})],se.prototype,"updatingHandles",void 0),se=(0,d._)([(0,C.j)("esri.views.layers.support.MapService")],se)},24405:function(e,t,r){r.d(t,{V5:function(){return s},e7:function(){return u}});var n=r(74165),i=r(93433),a=r(15861),o=r(37270);function u(e){return l.apply(this,arguments)}function l(){return l=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,u,l,s,c,p,f,d,y,h,v=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(u=v.length>1&&void 0!==v[1]?v[1]:t.popupTemplate)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,u.getRequiredFields(t.fieldsIndex);case 5:if(l=e.sent,s=u.lastEditInfoEnabled,c=t.objectIdField,p=t.typeIdField,f=t.globalIdField,d=t.relationships,!l.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!s){e.next=19;break}return e.next=16,(0,o.CH)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return y=e.t0,h=(0,o.Q0)(t.fieldsIndex,[].concat((0,i.Z)(l),(0,i.Z)(y))),e.abrupt("return",(p&&h.push(p),h&&c&&null!==(r=t.fieldsIndex)&&void 0!==r&&r.has(c)&&!h.includes(c)&&h.push(c),h&&f&&null!==(a=t.fieldsIndex)&&void 0!==a&&a.has(f)&&!h.includes(f)&&h.push(f),d&&d.forEach((function(e){var r,n=e.keyField;h&&n&&(null===(r=t.fieldsIndex)||void 0===r?void 0:r.has(n))&&!h.includes(n)&&h.push(n)})),h));case 23:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function s(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=4189.f46855ad.chunk.js.map