"use strict";(self.webpackChunkgis_dashboard=self.webpackChunkgis_dashboard||[]).push([[1231],{44041:function(e,t,i){i.d(t,{R:function(){return v}});var r=i(1413),n=i(15671),a=i(43144),s=i(60136),o=i(29388),l=i(27366),u=i(7138),h=i(41691),y=i(76672),c=i(49861),p=(i(25243),i(63780),i(93169),i(69912)),f=i(45948),d=i(87072),m=i(58132),g={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},v=function(e){(0,s.Z)(i,e);var t=(0,o.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).floors=null,r.scale=0,r}return(0,a.Z)(i,[{key:"destroy",value:function(){this.layer=null}},{key:"dynamicLayers",get:function(){var e=this;if(!this.hasDynamicLayers)return null;var t=this.visibleSublayers.map((function(t){var i=(0,d.f)(e.floors,t);return t.toExportImageJSON(i)}));return t.length?JSON.stringify(t):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&(0,m.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}},{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(g[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var e,t=this,i=!(null===(e=this.floors)||void 0===e||!e.length),r=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression||i&&null!=e.floorInfo}));return r.length?JSON.stringify(r.reduce((function(e,i){var r=(0,d.f)(t.floors,i),n=(0,y._)(r,i.definitionExpression);return null!=n&&(e[i.id]=n),e}),{})):null}},{key:"version",get:function(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");var e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){var e=this,t=[];if(!this.layer)return t;var i=this.layer.sublayers;i&&i.forEach((function i(r){var n=e.scale,a=0===n,s=0===r.minScale||n<=r.minScale,o=0===r.maxScale||n>=r.maxScale;r.visible&&(a||s&&o)&&(r.sublayers?r.sublayers.forEach(i):t.unshift(r))}));var r=this._get("visibleSublayers");return!r||r.length!==t.length||r.some((function(e,i){return t[i]!==e}))?t:r}},{key:"toJSON",value:function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=(0,r.Z)((0,r.Z)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}}]),i}((0,h.p)(u.Z));(0,l._)([(0,c.Cb)({readOnly:!0})],v.prototype,"dynamicLayers",null),(0,l._)([(0,c.Cb)()],v.prototype,"floors",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],v.prototype,"hasDynamicLayers",null),(0,l._)([(0,c.Cb)()],v.prototype,"layer",null),(0,l._)([(0,c.Cb)({readOnly:!0})],v.prototype,"layers",null),(0,l._)([(0,c.Cb)({readOnly:!0})],v.prototype,"layerDefs",null),(0,l._)([(0,c.Cb)({type:Number})],v.prototype,"scale",void 0),(0,l._)([(0,c.Cb)(f.qG)],v.prototype,"timeExtent",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],v.prototype,"version",null),(0,l._)([(0,c.Cb)({readOnly:!0})],v.prototype,"visibleSublayers",null),v=(0,l._)([(0,p.j)("esri.layers.mixins.ExportImageParameters")],v)},45948:function(e,t,i){i.d(t,{qG:function(){return _},PV:function(){return m},id:function(){return S},iR:function(){return p},rn:function(){return d},rT:function(){return k},u1:function(){return I},rO:function(){return Z},Oh:function(){return b},bT:function(){return w},C_:function(){return c},Lx:function(){return g},vg:function(){return x},YI:function(){return y},HQ:function(){return f}});var r=i(1413),n=i(62044),a=i(53866),s=i(78952),o=i(53283),l=(i(63780),i(66978),i(86710));var u=i(64575),h=i(81219),y={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},c={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:function(e,t){return!t.disablePopup}},write:{enabled:!0,writer:function(e,t,i){t[i]=!e}}}},p={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},f={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:o.w}}},d={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},m={value:null,type:u.Z,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function g(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}var v={write:!0,read:!0},b={type:Number,json:{origins:{"web-document":v,"portal-item":{write:!0}}}},w=(0,r.Z)((0,r.Z)({},b),{},{json:(0,r.Z)((0,r.Z)({},b.json),{},{origins:{"web-document":(0,r.Z)((0,r.Z)({},v),{},{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:function(e,t,i){return i&&"service"!==i.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,h.b)(t.layerDefinition.drawingInfo.transparency):void 0:(0,h.b)(t.drawingInfo.transparency)}}})}),_={type:n.Z,readOnly:!0,get:function(){var e,t;if(null===(e=this.layer)||void 0===e||!e.timeInfo)return null;var i=this.layer,r=i.datesInUnknownTimezone,a=i.timeOffset,s=i.useViewTime,o=null===(t=this.view)||void 0===t?void 0:t.timeExtent,u=this.layer.timeExtent;r&&(u=function(e){if(!e)return e;var t=e.start,i=e.end;return new n.Z({start:null!=t?(0,l.Nm)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,l.Nm)(i,i.getTimezoneOffset(),"minutes"):i})}(u));var h=s?o&&u?o.intersection(u):o||u:u;if(!h||h.isEmpty||h.isAllTime)return h;a&&(h=h.offset(-a.value,a.unit)),r&&(h=function(e){if(!e)return e;var t=e.start,i=e.end;return new n.Z({start:null!=t?(0,l.Nm)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,l.Nm)(i,-i.getTimezoneOffset(),"minutes"):i})}(h));var y=this._get("timeExtent");return h.equals(y)?y:h}},x={type:a.Z,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:function(e,t){var i=a.Z.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(i.spatialReference=s.Z.fromJSON(t.spatialReference)),i}}}},read:!1}},S={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},Z={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},I={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},k={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}}},91231:function(e,t,i){i.r(t),i.d(t,{default:function(){return E}});var r=i(1413),n=i(74165),a=i(15861),s=i(15671),o=i(43144),l=i(60136),u=i(29388),h=i(27366),y=i(32718),c=i(66978),p=i(94172),f=i(49861),d=(i(25243),i(63780),i(93169),i(69912)),m=i(78983),g=i(90110),v=i(95986),b=i(77318),w=i(83978),_=i(9229),x=i(67581),S=i(11752),Z=i(61120),I=i(45948),k=i(44041),C=i(13107),D=i(84848),O=i(45008),P=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,s.Z)(this,i),(e=t.apply(this,arguments))._highlightGraphics=new m.J,e._updateHash="",e}return(0,o.Z)(i,[{key:"fetchPopupFeatures",value:function(e,t){return this._popupHighlightHelper.fetchPopupFeatures(e,t)}},{key:"update",value:function(e){var t=this,i="".concat(this.exportImageVersion,"/").concat(e.state.id,"/").concat(e.pixelRatio,"/").concat(e.stationary);this._updateHash!==i&&(this._updateHash=i,this.strategy.update(e).catch((function(e){(0,c.D_)(e)||y.Z.getLogger(t).error(e)})),e.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(e.state.resolution)),this._highlightView.processUpdate(e)}},{key:"attach",value:function(){var e=this,t=this.layer,i=t.imageMaxWidth,r=t.imageMaxHeight,n=t.version,a=n>=10.3,s=n>=10;this._bitmapContainer=new g.c,this.container.addChild(this._bitmapContainer),this._highlightView=new b.Z({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:function(){return e.requestUpdate()},container:new w.Z(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new D.VF({createFetchPopupFeaturesQueryGeometry:function(t,i){return(0,O.K)(t,i,e.view)},highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:function(t,i){e._highlightView.graphicUpdateHandler({graphic:t,property:i})},layerView:this,updatingHandles:this.updatingHandles}),this.strategy=new _.Z({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:i,imageMaxHeight:r,imageRotationSupported:a,imageNormalizationSupported:s,hidpi:!0}),this.addAttachHandles((0,p.YP)((function(){return e.exportImageVersion}),(function(){return e.requestUpdate()}))),this.requestUpdate()}},{key:"detach",value:function(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"supportsSpatialReference",value:function(e){return this.layer.serviceSupportsSpatialReference(e)}},{key:"doRefresh",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._updateHash="",this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"fetchImage",value:function(e,t,i,n){return this.layer.fetchImage(e,t,i,(0,r.Z)({timeExtent:this.timeExtent,floors:this.floors},n))}},{key:"fetchImageBitmap",value:function(e,t,i,n){return this.layer.fetchImageBitmap(e,t,i,(0,r.Z)({timeExtent:this.timeExtent,floors:this.floors},n))}},{key:"highlight",value:function(e){return this._popupHighlightHelper.highlight(e)}}]),i}(function(e){var t=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){return(0,s.Z)(this,i),t.apply(this,arguments)}return(0,o.Z)(i,[{key:"initialize",value:function(){this.exportImageParameters=new k.R({layer:this.layer})}},{key:"destroy",value:function(){this.exportImageParameters.destroy(),this.exportImageParameters=null}},{key:"floors",get:function(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.floors)&&void 0!==e?e:null}},{key:"exportImageVersion",get:function(){var e;return null!==(e=this.exportImageParameters)&&void 0!==e&&e.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}},{key:"canResume",value:function(){var e;return!!(0,S.Z)((0,Z.Z)(i.prototype),"canResume",this).call(this)&&!(null!==(e=this.timeExtent)&&void 0!==e&&e.isEmpty)}}]),i}(e);return(0,h._)([(0,f.Cb)()],t.prototype,"exportImageParameters",void 0),(0,h._)([(0,f.Cb)({readOnly:!0})],t.prototype,"floors",null),(0,h._)([(0,f.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,h._)([(0,f.Cb)()],t.prototype,"layer",void 0),(0,h._)([(0,f.Cb)()],t.prototype,"suspended",void 0),(0,h._)([(0,f.Cb)(I.qG)],t.prototype,"timeExtent",void 0),t=(0,h._)([(0,d.j)("esri.views.layers.MapImageLayerView")],t)}((0,C.Z)((0,v.y)(x.Z))));(0,h._)([(0,f.Cb)()],P.prototype,"strategy",void 0),(0,h._)([(0,f.Cb)()],P.prototype,"updating",void 0);var E=P=(0,h._)([(0,d.j)("esri.views.2d.layers.MapImageLayerView2D")],P)}}]);
//# sourceMappingURL=1231.f93b7e77.chunk.js.map