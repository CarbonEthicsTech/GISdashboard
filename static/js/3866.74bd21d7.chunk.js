"use strict";(self.webpackChunkgis_dashboard=self.webpackChunkgis_dashboard||[]).push([[3866],{28554:function(e,t,r){r.d(t,{K3:function(){return a},Rx:function(){return o}});var n=r(93169),a=function(){return!!(0,n.Z)("enable-feature:force-wosr")},i=function(){return n.Z.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0)},s=function(){return n.Z.add("enable-i3s-patching",!1,!0,!0)},o=function(){return!!(0,n.Z)("enable-feature:SceneLayer-editing")};!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"i3s-patching";switch(s(),i(),n.Z.add("enable-feature:SceneLayer-editing",!0,!0,!0),e){case"feature-layer-view":n.Z.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0);break;case"i3s-patching":n.Z.add("enable-i3s-patching",!0,!0,!0)}}("i3s-patching")},42283:function(e,t,r){r.d(t,{im:function(){return x},cW:function(){return _},vX:function(){return k}});var n=r(51508),a=r(10064),i=r(37933),s=r(67140),o=r(80045),u=r(62554),l=r(16851),c=r(31655),f=r(16072),d=r(91946),y=r(61459),h=r(16915),p=r(1030),v=r(58009),m=r(24931),b={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b;if(!e)return{symbol:null};var r=t.retainId,i=void 0===r?b.retainId:r,s=t.ignoreDrivers,g=void 0===s?b.ignoreDrivers:s,_=t.hasLabelingContext,k=void 0===_?b.hasLabelingContext:_,w=t.retainCIM,Z=void 0===w?b.retainCIM:w,x=null;if((0,n.dU)(e)||e instanceof o.Z)x=e.clone();else if("cim"===e.type){var S,C=null===(S=e.data)||void 0===S||null===(S=S.symbol)||void 0===S?void 0:S.type;if("CIMPointSymbol"!==C)return{error:new a.Z("symbol-conversion:unsupported-cim-symbol","CIM symbol of type '".concat(C||"unknown","' is unsupported in 3D"),{symbol:e})};x=Z?e.clone():u.Z.fromCIMSymbol(e)}else if(e instanceof l.Z)x=c.Z.fromSimpleLineSymbol(e);else if(e instanceof f.Z)x=u.Z.fromSimpleMarkerSymbol(e);else if(e instanceof d.Z)x=u.Z.fromPictureMarkerSymbol(e);else if(e instanceof y.Z)x=t.geometryType&&"mesh"===t.geometryType?h.Z.fromSimpleFillSymbol(e):p.Z.fromSimpleFillSymbol(e);else{if(!(e instanceof v.Z))return{error:new a.Z("symbol-conversion:unsupported-2d-symbol","2D symbol of type '".concat(e.type||e.declaredClass,"' is unsupported in 3D"),{symbol:e})};x=k?m.Z.fromTextSymbol(e):u.Z.fromTextSymbol(e)}return i&&x&&"cim"!==x.type&&(x.id=e.id),g&&(0,n.dU)(x)&&x.symbolLayers.forEach((function(e){return e.ignoreDrivers=!0})),{symbol:x}}function _(e,t,r,n){var a=Z(e,{},{context:n,isLabelSymbol:!1});null!=a&&(t[r]=a)}function k(e,t,r,n){var a=Z(e,{},{context:n,isLabelSymbol:!0});null!=a&&(t[r]=a)}function w(e){return e instanceof s.Z||e instanceof o.Z}function Z(e,t,r){if(null==e)return null;var n=r.context,s=r.isLabelSymbol,o=null===n||void 0===n?void 0:n.origin,u=null===n||void 0===n?void 0:n.messages;if("web-scene"===o&&!w(e)){var l=g(e,{retainCIM:!0,hasLabelingContext:s});return null!=l.symbol?l.symbol.write(t,n):(null!==u&&void 0!==u&&u.push(new a.Z("symbol:unsupported","Symbols of type '".concat(e.declaredClass,"' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView"),{symbol:e,context:n,error:l.error})),null)}return("web-map"===o||"portal-item"===o&&!(0,i.A2)(null===n||void 0===n?void 0:n.layer))&&w(e)?(null!==u&&void 0!==u&&u.push(new a.Z("symbol:unsupported","Symbols of type '".concat(e.declaredClass,"' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView"),{symbol:e,context:n})),null):e.write(t,n)}function x(e,t){return(0,n.S9)(e,null,t)}},38048:function(e,t,r){r.d(t,{EJ:function(){return _},KV:function(){return b},n2:function(){return m},v9:function(){return g},wm:function(){return Z}});var n=r(74165),a=r(1413),i=r(37762),s=r(15861),o=r(76200),u=r(10064),l=r(66978),c=r(35995),f=r(7575),d=r(65694),y=r(28554),h={};function p(){return(p=(0,s.Z)((0,n.Z)().mark((function e(t,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_(t,r);case 3:return e.t0=e.sent.data,e.t1=(0,c.Yd)(t),e.t2=t,e.abrupt("return",{data:e.t0,baseUrl:e.t1,styleUrl:e.t2});case 9:return e.prev=9,e.t3=e.catch(0),e.abrupt("return",((0,l.r9)(e.t3),null));case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function v(e,t,r){var n,a=null!=t.portal?t.portal:f.Z.getDefault(),s="".concat(a.url," - ").concat(a.user&&a.user.username," - ").concat(e);return h[s]||(h[s]=function(e,t,r){return t.load(r).then((function(){var n=new d.Z({disableExtraQuery:!0,query:"owner:".concat(k," AND type:").concat(w,' AND typekeywords:"').concat(e,'"')});return t.queryItems(n,r)})).then((function(t){var n=t.results,a=null,s=e.toLowerCase();if(n&&Array.isArray(n)){var o,l=(0,i.Z)(n);try{for(l.s();!(o=l.n()).done;){var c,f=o.value,d=null===(c=f.typeKeywords)||void 0===c?void 0:c.some((function(e){return e.toLowerCase()===s}));if(d&&f.type===w&&f.owner===k){a=f;break}}}catch(y){l.e(y)}finally{l.f()}}if(!a)throw new u.Z("symbolstyleutils:style-not-found","The style '".concat(e,"' could not be found"),{styleName:e});return a.load(r)}))}(e,a,r).then((function(e){return n=e,e.fetchData()})).then((function(t){var r;return{data:t,baseUrl:null!==(r=n.itemUrl)&&void 0!==r?r:"",styleName:e}}))),h[s]}function m(e,t,r){return e&&null!=e.styleUrl?function(e,t){return p.apply(this,arguments)}(e.styleUrl,r):e&&null!=e.styleName?v(e.styleName,t,r):Promise.reject(new u.Z("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function b(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function g(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["gltf"];if("cimRef"===t)return e.cimRef;if(e.formatInfos&&!(0,y.K3)()){var n,a=(0,i.Z)(r);try{var s,o=function(){var t=n.value,r=e.formatInfos.find((function(e){return e.type===t}));if(r)return{v:r.href}};for(a.s();!(n=a.n()).done;)if(s=o())return s.v}catch(u){a.e(u)}finally{a.f()}}return e.webRef}function _(e,t){var r=(0,a.Z)({responseType:"json",query:{f:"json"}},t);return(0,o.default)((0,c.Fv)(e),r)}var k="esri_en",w="Style",Z="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},81735:function(e,t,r){r.d(t,{Z:function(){return d}});var n=r(15671),a=r(43144),i=r(60136),s=r(29388),o=r(27366),u=r(41691),l=r(49861),c=(r(25243),r(63780),r(93169),r(69912)),f=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"initialize",value:function(){}},{key:"destroy",value:function(){}},{key:"supportsTileUpdates",get:function(){return!1}},{key:"spatialReference",get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}}]),r}(u.r);(0,o._)([(0,l.Cb)({readOnly:!0})],f.prototype,"supportsTileUpdates",null),(0,o._)([(0,l.Cb)({constructOnly:!0})],f.prototype,"remoteClient",void 0),(0,o._)([(0,l.Cb)({constructOnly:!0})],f.prototype,"service",void 0),(0,o._)([(0,l.Cb)()],f.prototype,"spatialReference",null),(0,o._)([(0,l.Cb)({constructOnly:!0})],f.prototype,"tileInfo",void 0),(0,o._)([(0,l.Cb)({constructOnly:!0})],f.prototype,"tileStore",void 0);var d=f=(0,o._)([(0,c.j)("esri.views.2d.layers.features.processors.BaseProcessor")],f)},3561:function(e,t,r){r.r(t),r.d(t,{default:function(){return T}});var n=r(37762),a=r(74165),i=r(15861),s=r(15671),o=r(43144),u=r(60136),l=r(29388),c=r(27366),f=r(75746),d=(r(10064),r(93169),r(32718),r(92026)),y=r(66978),h=(r(25243),r(63780),r(69912)),p=r(48732),v=r(78952),m=r(84328),b=r(80613),g=r(72774),_=r(74017),k=r(61909),w=r(69813),Z=r(27301),x=r(81735),S=r(1413),C=function(){function e(t){(0,s.Z)(this,e),this._remoteClient=t,this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}return(0,o.Z)(e,[{key:"destroy",value:function(){}},{key:"fetchResource",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,s,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._resourceMap,!(i=n.get(t))){e.next=3;break}return e.abrupt("return",i);case 3:if(!(s=this._inFlightResourceMap.get(t))){e.next=6;break}return e.abrupt("return",s);case 6:e.prev=6,s=this._remoteClient.invoke("tileRenderer.fetchResource",{url:t},(0,S.Z)({},r)),this._inFlightResourceMap.set(t,s),s.then((function(e){return o._inFlightResourceMap.delete(t),n.set(t,e),e})),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(6),e.abrupt("return",(0,y.D_)(e.t0)?null:{width:0,height:0});case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getResource",value:function(e){var t;return null!==(t=this._resourceMap.get(e))&&void 0!==t?t:null}},{key:"loadFont",value:function(e){return Promise.resolve(null)}}]),e}();function I(e,t){return(!e.minScale||e.minScale>=t)&&(!e.maxScale||e.maxScale<=t)}function M(e){var t=e.message,r={message:{data:{},tileKey:t.tileKey,tileKeyOrigin:t.tileKeyOrigin,version:t.version},transferList:new Array};for(var n in t.data){var a=n,i=t.data[a];if(r.message.data[a]=null,null!=i){var s=i.stride,o=i.indices.slice(0),u=i.vertices.slice(0),l=i.records.slice(0),c={stride:s,indices:o,vertices:u,records:l,metrics:(0,d.yw)(i.metrics,(function(e){return e.slice(0)}))};r.transferList.push(o,u,l),r.message.data[a]=c}}return r}var D=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).type="symbol",e._matchers={feature:null,aggregate:null},e._bufferData=new Map,e._bufferIds=new Map,e}return(0,o.Z)(r,[{key:"initialize",value:function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._resourceManagerProxy=new C(this.remoteClient)}},{key:"destroy",value:function(){this._resourceManagerProxy.destroy()}},{key:"supportsTileUpdates",get:function(){return!0}},{key:"forEachBufferId",value:function(e){this._bufferIds.forEach((function(t){t.forEach(e)}))}},{key:"update",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("symbol"===(i=r.schema.processors[0]).type){e.next=3;break}return e.abrupt("return");case 3:s=(0,p.Hg)(this._schema,i),((0,p.uD)(s,"mesh")||(0,p.uD)(s,"target"))&&(t.mesh=!0,null!==(n=t.why)&&void 0!==n&&n.mesh.push("Symbology changed"),this._schema=i,this._factory=this._createFactory(i),this._factory.update(i,this.tileStore.tileScheme.tileInfo));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"onTileMessage",value:function(e,t,r,n){return(0,y.k_)(n),this._onTileData(e,t,r,n)}},{key:"onTileClear",value:function(e,t){var r={clear:!0,end:t};return this._bufferData.delete(e.key.id),this._bufferIds.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:r})}},{key:"onTileError",value:function(e,t,r){var n=r.signal,a={tileKey:e.id,error:t};return this.remoteClient.invoke("tileRenderer.onTileError",a,{signal:n})}},{key:"onTileUpdate",value:function(e){var t,r=this,a=(0,n.Z)(e.removed);try{for(a.s();!(t=a.n()).done;){var i=t.value;this._bufferData.has(i.key.id)&&this._bufferData.delete(i.key.id),this._bufferIds.has(i.key.id)&&this._bufferIds.delete(i.key.id)}}catch(l){a.e(l)}finally{a.f()}var s,o=(0,n.Z)(e.added);try{var u=function(){var e=s.value;r._bufferData.forEach((function(t){var a,i=(0,n.Z)(t);try{for(i.s();!(a=i.n()).done;){var s=a.value;s.message.tileKey===e.id&&r._updateTileMesh("append",e,M(s),[],!1,!1,null)}}catch(l){i.e(l)}finally{i.f()}}))};for(o.s();!(s=o.n()).done;)u()}catch(l){o.e(l)}finally{o.f()}}},{key:"_addBufferData",value:function(e,t){var r;this._bufferData.has(e)||this._bufferData.set(e,[]),null===(r=this._bufferData.get(e))||void 0===r||r.push(M(t))}},{key:"_createFactory",value:function(e){var t=this,r=this.service,n=r.geometryType,a=r.objectIdField,i={geometryType:n,fields:r.fields,spatialReference:v.Z.fromJSON(this.spatialReference)},s=new k.Wr((function(e,r){return t.remoteClient.invoke("tileRenderer.getMaterialItems",e,r)}),this.tileStore.tileScheme.tileInfo),o=e.mesh,u=o.matcher,l=o.aggregateMatcher;return this._store=s,this._matchers.feature=(0,w.fL)(u,s,i,this._resourceManagerProxy),this._matchers.aggregate=(0,d.yw)(l,(function(e){return(0,w.fL)(e,s,i,t._resourceManagerProxy)})),new _.j(n,a,s)}},{key:"_onTileData",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,i,s){var o,u,l,c,f,d,h,p,v,m,b,g,_,k,w,Z,x,S,C,I,M,D,T,R,L=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,y.k_)(s),u=r.type,l=r.addOrUpdate,c=r.remove,f=r.clear,d=r.end,h=!!this._schema.mesh.sortKey,l){e.next=5;break}return p={type:u,addOrUpdate:null,remove:c,clear:f,end:d,sort:h},e.abrupt("return",this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:p},s));case 5:return v=this._processFeatures(t,l,i,s,null===(o=r.status)||void 0===o?void 0:o.version),e.prev=6,e.next=9,v;case 9:if(null!=(m=e.sent)){e.next=13;break}return b={type:u,addOrUpdate:null,remove:c,clear:f,end:d,sort:h},e.abrupt("return",this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:b},s));case 13:g=[],_=(0,n.Z)(m),e.prev=15,_.s();case 17:if((k=_.n()).done){e.next=41;break}if(w=k.value,Z=!1,x=w.message.bufferIds,S=t.key.id,C=w.message.tileKey,S===C||null==x){e.next=38;break}if(this.tileStore.get(C)){e.next=25;break}return this._addBufferData(S,w),g.push(w),e.abrupt("continue",39);case 25:(I=this._bufferIds.get(C))||(I=new Set,this._bufferIds.set(C,I)),M=Array.from(x),D=0,T=M;case 29:if(!(D<T.length)){e.next=38;break}if(R=T[D],!I.has(R)){e.next=34;break}return Z=!0,e.abrupt("break",38);case 34:I.add(R);case 35:D++,e.next=29;break;case 38:Z||(this._addBufferData(S,w),g.push(w));case 39:e.next=17;break;case 41:e.next=46;break;case 43:e.prev=43,e.t0=e.catch(15),_.e(e.t0);case 46:return e.prev=46,_.f(),e.finish(46);case 49:return e.next=51,Promise.all(g.map((function(e){var n=t.key.id===e.message.tileKey,a=n?r.remove:[],i=n&&r.end;return L._updateTileMesh(u,t,e,a,i,!!r.clear,s.signal)})));case 51:e.next=56;break;case 53:e.prev=53,e.t1=e.catch(6),this._handleError(t,e.t1,s);case 56:case"end":return e.stop()}}),e,this,[[6,53],[15,43,46,49]])})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"_updateTileMesh",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,n,i,s,o,u){var l,c,f,h,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=t,c=n.message.tileKey,f=!!this._schema.mesh.sortKey,c!==r.key.id&&(s=!1),h={type:l,addOrUpdate:(0,d.yw)(n,(function(e){return e.message})),remove:i,clear:o,end:s,sort:f},p={transferList:(0,d.yw)(n,(function(e){return e.transferList}))||[]||0,signal:u},e.abrupt("return",((0,y.k_)(p),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:c,data:h},p)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i,s,o){return e.apply(this,arguments)}}()},{key:"_processFeatures",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,n,i,s){var o,u,l,c,f,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.hasFeatures){e.next=2;break}return e.abrupt("return",null);case 2:return o={transform:t.transform,hasZ:!1,hasM:!1},u=this._factory,l={viewingMode:"",scale:t.scale},e.next=7,this._matchers.feature;case 7:return c=e.sent,e.next=10,this._matchers.aggregate;case 10:return f=e.sent,(0,y.k_)(i),d=this._getLabelInfos(t,r),e.next=15,u.analyze(r.getCursor(),this._resourceManagerProxy,c,f,o,l);case 15:return(0,y.k_)(i),e.abrupt("return",this._writeFeatureSet(t,r,o,d,u,n,s));case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_writeFeatureSet",value:function(e,t,r,n,a,i,s){for(var o=t.getSize(),u=this._schema.mesh.matcher.symbologyType,l=new g._(e.key.id,{features:o,records:o,metrics:0},u,i,u!==b.mD.HEATMAP,s),c={viewingMode:"",scale:e.scale},f=t.getCursor();f.next();)try{var d=f.getDisplayId(),y=null!=n?n.get(d):null;a.writeCursor(l,f,r,c,e.level,y,this._resourceManagerProxy)}catch(p){}var h=e.tileInfoView.tileInfo.isWrappable;return l.serialize(h)}},{key:"_handleError",value:function(e,t,r){if(!(0,y.D_)(t)){var n={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",n,{signal:r.signal})}return Promise.resolve()}},{key:"_getLabelingSchemaForScale",value:function(e){var t=this._schema.mesh.labels;if(null==t)return null;if("subtype"===t.type){var r={type:"subtype",classes:{}},n=!1;for(var a in t.classes){var i=t.classes[a].filter((function(t){return I(t,e.scale)}));n=n||!!i.length,r.classes[a]=i}return n?r:null}var s=t.classes.filter((function(t){return I(t,e.scale)}));return s.length?{type:"simple",classes:s}:null}},{key:"_getLabels",value:function(e,t){if("subtype"===t.type){var r,n=this.service.subtypeField,a=(0,d.s3)(n,"Expected to find subtype Field"),i=e.readAttribute(a);return null==i?[]:null!==(r=t.classes[i])&&void 0!==r?r:[]}return t.classes}},{key:"_getLabelInfos",value:function(e,t){var r=this,a=this._getLabelingSchemaForScale(e);if(null==a)return null;for(var i=new Map,s=t.getCursor(),o=function(){var e,t=s.getDisplayId(),o=[],u=(0,m.nE)(t),l=u&&1!==s.readAttribute("cluster_count")?"aggregate":"feature",c=r._getLabels(s,a),d=(0,n.Z)(c);try{var y=function(){var n=e.value;if(n.target!==l)return 0;var a=s.getStorage(),i=u&&"feature"===l?a.getComputedStringAtIndex(s.readAttribute("referenceId"),n.fieldIndex):a.getComputedStringAtIndex(t,n.fieldIndex);if(!i)return 0;var c=(0,f.E)(i.toString()),d=c[0],y=c[1];r._store.getMosaicItem(n.symbol,(0,Z._)(d)).then((function(e){var t;o[n.index]={glyphs:null!==(t=e.glyphMosaicItems)&&void 0!==t?t:[],rtl:y,index:n.index}}))};for(d.s();!(e=d.n()).done;)y()}catch(h){d.e(h)}finally{d.f()}i.set(t,o)};s.next();)o();return i}}]),r}(x.Z),T=D=(0,c._)([(0,h.j)("esri.views.2d.layers.features.processors.SymbolProcessor")],D)}}]);
//# sourceMappingURL=3866.74bd21d7.chunk.js.map