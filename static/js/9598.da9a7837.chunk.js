"use strict";(self.webpackChunkgis_dashboard=self.webpackChunkgis_dashboard||[]).push([[9598],{29598:function(e,t,r){r.d(t,{I:function(){return C}});var n=r(1413),a=r(74165),i=r(15861),s=r(15671),u=r(43144),l=r(11752),o=r(61120),c=r(60136),p=r(29388),d=r(27366),f=r(42265),h=r(19545),v=r(76200),y=r(14921),m=r(10064),b=r(32718),g=r(92026),k=r(66978),x=r(35995),I=r(49861),Z=(r(25243),r(63780),r(93169),r(38511)),w=r(69912),E=r(31201),_=r(37933),P=r(7575),S=r(98995),U=r(79437),H=r(73117),C=function(e){var t=function(e){(0,c.Z)(d,e);var t=(0,p.Z)(d);function d(){var e;return(0,s.Z)(this,d),(e=t.apply(this,arguments)).resourceReferences={portalItem:null,paths:[]},e.userHasEditingPrivileges=!0,e.userHasFullEditingPrivileges=!1,e.userHasUpdateItemPrivileges=!1,e}return(0,u.Z)(d,[{key:"destroy",value:function(){this.portalItem=(0,g.SC)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}},{key:"portalItem",set:function(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}},{key:"readPortalItem",value:function(e,t,r){if(t.itemId)return new S.default({id:t.itemId,portal:r&&r.portal})}},{key:"writePortalItem",value:function(e,t){e&&e.id&&(t.itemId=e.id)}},{key:"loadFromPortal",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){var i,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.portalItem||!this.portalItem.id){e.next=15;break}return e.prev=1,e.next=4,r.e(3388).then(r.bind(r,33388));case 4:return i=e.sent,s=i.load,(0,k.k_)(n),e.next=9,s({instance:this,supportedTypes:t.supportedTypes,validateItem:t.validateItem,supportsData:t.supportsData,layerModuleTypeMap:t.layerModuleTypeMap},n);case 9:return e.abrupt("return",e.sent);case 12:throw e.prev=12,e.t0=e.catch(1),(0,k.D_)(e.t0)||b.Z.getLogger(this).warn("Failed to load layer (".concat(this.title,", ").concat(this.id,") portal item (").concat(this.portalItem.id,")\n  ").concat(e.t0)),e.t0;case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"finishLoadEditablePortalLayer",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._fetchUserHasEditingPrivileges(t).catch((function(e){return(0,k.r9)(e),!0}));case 3:e.t1=e.sent,e.t0._set.call(e.t0,"userHasEditingPrivileges",e.t1);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setUserPrivileges",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,s,u,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f.Z.userPrivilegesApplied){e.next=2;break}return e.abrupt("return",this.finishLoadEditablePortalLayer(r));case 2:if(!this.url){e.next=17;break}return e.prev=3,e.next=6,this._fetchUserPrivileges(t,r);case 6:n=e.sent,i=n.features,s=i.edit,u=i.fullEdit,l=n.content.updateItem,this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",u),this._set("userHasUpdateItemPrivileges",l),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),(0,k.r9)(e.t0);case 17:case"end":return e.stop()}}),e,this,[[3,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchUserPrivileges",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r){var n,i,s,u,l,o,c,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.portalItem,t&&n&&n.loaded&&!n.sourceUrl){e.next=3;break}return e.abrupt("return",this._fetchFallbackUserPrivileges(r));case 3:if(!(i=t===n.id)||!n.portal.user){e.next=6;break}return e.abrupt("return",(0,H.Ss)(n));case 6:if(!i){e.next=10;break}s=n.portal.url,e.next=19;break;case 10:return e.prev=10,e.next=13,(0,_.oP)(this.url,r);case 13:s=e.sent,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(10),(0,k.r9)(e.t0);case 19:if(s&&(0,x.Zo)(s,n.portal.url)){e.next=21;break}return e.abrupt("return",this._fetchFallbackUserPrivileges(r));case 21:return e.prev=21,l=null!=r?r.signal:null,e.next=25,null===h.id||void 0===h.id?void 0:h.id.getCredential("".concat(s,"/sharing"),{prompt:!1,signal:l});case 25:u=e.sent,e.next=31;break;case 28:e.prev=28,e.t1=e.catch(21),(0,k.r9)(e.t1);case 31:if(o=!0,c=!1,p=!1,u){e.next=34;break}return e.abrupt("return",{features:{edit:o,fullEdit:c},content:{updateItem:p}});case 34:if(e.prev=34,!i){e.next=40;break}return e.next=38,n.reload();case 38:e.next=43;break;case 40:return n=new S.default({id:t,portal:{url:s}}),e.next=43,n.load(r);case 43:if(!n.portal.user){e.next=45;break}return e.abrupt("return",(0,H.Ss)(n));case 45:e.next=50;break;case 47:e.prev=47,e.t2=e.catch(34),(0,k.r9)(e.t2);case 50:return e.abrupt("return",{features:{edit:o,fullEdit:c},content:{updateItem:p}});case 51:case"end":return e.stop()}}),e,this,[[10,16],[21,28],[34,47]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchFallbackUserPrivileges",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!0,e.prev=1,e.next=4,this._fetchUserHasEditingPrivileges(t);case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),(0,k.r9)(e.t0);case 10:return e.abrupt("return",{features:{edit:r,fullEdit:!1},content:{updateItem:!1}});case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchUserHasEditingPrivileges",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.url?null===h.id||void 0===h.id?void 0:h.id.findCredential(this.url):null){e.next=3;break}return e.abrupt("return",!0);case 3:if(T.credential!==r){e.next=7;break}e.t0=T.user,e.next=10;break;case 7:return e.next=9,this._fetchEditingUser(t);case 9:e.t0=e.sent;case 10:return n=e.t0,e.abrupt("return",(T.credential=r,T.user=n,null==n||null==n.privileges||n.privileges.includes("features:user:edit")));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchEditingUser",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var r,n,i,s,u,l,o,c,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=null===(r=this.portalItem)||void 0===r||null===(r=r.portal)||void 0===r?void 0:r.user)){e.next=3;break}return e.abrupt("return",i);case 3:if(null!==(s=h.id.findServerInfo(null!==(n=this.url)&&void 0!==n?n:""))&&void 0!==s&&s.owningSystemUrl){e.next=6;break}return e.abrupt("return",null);case 6:if(u="".concat(s.owningSystemUrl,"/sharing/rest"),!(l=P.Z.getDefault())||!l.loaded||(0,x.Fv)(l.restUrl)!==(0,x.Fv)(u)){e.next=9;break}return e.abrupt("return",l.user);case 9:return o="".concat(u,"/community/self"),c=null!=t?t.signal:null,e.next=13,(0,y.q6)((0,v.default)(o,{authMode:"no-prompt",query:{f:"json"},signal:c}));case 13:return p=e.sent,e.abrupt("return",p.ok?U.default.fromJSON(p.value.data):null);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"read",value:function(e,t){t&&(t.layer=this),(0,l.Z)((0,o.Z)(d.prototype),"read",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=t&&t.portal,a=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||P.Z.getDefault());return r&&a&&!(0,x.tm)(a.restUrl,r.restUrl)?(t.messages&&t.messages.push(new m.Z("layer:cross-portal","The layer '".concat(this.title," (").concat(this.id,")' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer"),{layer:this})),null):(0,l.Z)((0,o.Z)(d.prototype),"write",this).call(this,e,(0,n.Z)((0,n.Z)({},t),{},{layer:this}))}}]),d}(e);return(0,d._)([(0,I.Cb)({type:S.default})],t.prototype,"portalItem",null),(0,d._)([(0,Z.r)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,d._)([(0,E.c)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,d._)([(0,I.Cb)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,d._)([(0,I.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),(0,d._)([(0,I.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasFullEditingPrivileges",void 0),(0,d._)([(0,I.Cb)({type:Boolean,readOnly:!0})],t.prototype,"userHasUpdateItemPrivileges",void 0),t=(0,d._)([(0,w.j)("esri.layers.mixins.PortalLayer")],t)},T={credential:null,user:null}},73117:function(e,t,r){r.d(t,{$o:function(){return v},Fj:function(){return f},Kz:function(){return m},Ss:function(){return b},_$:function(){return d},ck:function(){return h},qj:function(){return p}});var n=r(37762),a=r(74165),i=r(15861),s=r(52587),u=r(78952),l=r(81753);function o(e){return c.apply(this,arguments)}function c(){return c=(0,i.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t.spatialReference).isWGS84){e.next=3;break}return e.abrupt("return",t.clone());case 3:if(!r.isWebMercator){e.next=5;break}return e.abrupt("return",(0,l.Sx)(t));case 5:return n=u.Z.WGS84,e.next=8,(0,s.initializeProjection)(r,n);case 8:return e.abrupt("return",(0,s.project)(t,n));case 9:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function p(e,t){if(!d(e,t)){var r=e.typeKeywords;r?r.push(t):e.typeKeywords=[t]}}function d(e,t){var r;return!(null===(r=e.typeKeywords)||void 0===r||!r.includes(t))}function f(e){return d(e,m.HOSTED_SERVICE)}function h(e,t){var r=e.typeKeywords;if(r){var n=r.indexOf(t);n>-1&&r.splice(n,1)}}function v(e){return y.apply(this,arguments)}function y(){return(y=(0,i.Z)((0,a.Z)().mark((function e(t){var r,i,s,u,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.clone().normalize()).length>1){s=(0,n.Z)(r);try{for(s.s();!(u=s.n()).done;)l=u.value,i?l.width>i.width&&(i=l):i=l}catch(a){s.e(a)}finally{s.f()}}else i=r[0];return e.abrupt("return",o(i));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service"};function b(e){var t,r=e.portal,n=e.isOrgItem,a=e.itemControl,i=null===(t=r.user)||void 0===t?void 0:t.privileges,s=!i||i.includes("features:user:edit"),u=!!n&&!(null===i||void 0===i||!i.includes("features:user:fullEdit")),l="update"===a||"admin"===a;return l?u=s=!0:u&&(s=!0),{features:{edit:s,fullEdit:u},content:{updateItem:l}}}}}]);
//# sourceMappingURL=9598.da9a7837.chunk.js.map